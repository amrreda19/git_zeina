<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1994970196400389"
     crossorigin="anonymous"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ديكورات متنوعة | Zeina Events</title>
    <meta name="description" content="ديكورات متنوعة للمناسبات والأفراح مع تشكيلة واسعة من المنتجات.">
    <meta name="title" content="ديكورات متنوعة | Zeina Events">
    <link rel="canonical" href="https://zeinaevents.com/pages/category-other.html">
    <link rel="icon" type="image/png" href="../assets/images/zeina.jpeg">
    
    <!-- Schema.org markup for Google -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "CollectionPage",
      "name": "ديكورات متنوعة",
      "description": "ديكورات متنوعة للمناسبات والأفراح مع تشكيلة واسعة من المنتجات.",
      "url": "https://zeinaevents.com/pages/category-other.html",
      "mainEntity": {
        "@type": "ItemList",
        "name": "ديكورات متنوعة",
        "description": "مجموعة متنوعة من الديكورات للمناسبات المختلفة"
      },
      "publisher": {
        "@type": "Organization",
        "name": "Zeina Events",
        "url": "https://zeinaevents.com"
      }
    }
    </script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" as="script">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../js/supabase-config.js?v=2025-08-22-1"></script>
    <script src="../js/product-service.js?v=2025-08-22-1"></script>
    <script src="../js/auth-service.js?v=2025-08-22-1"></script>
    <script src="../js/advertising-service.js?v=2025-08-22-1"></script>
    <script src="../js/common-utils.js?v=2025-08-22-1"></script>

    <style>
        :root {
            --primary-pink: #f8d7e4;
            --primary-green: #d8e9d6;
            --primary-beige: #f5f0e6;
            --gold: #d4af37;
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f9f9f9;
            /* ضمان عمل التمرير */
            overflow-x: hidden;
            overflow-y: auto;
            /* تحسين التمرير على الأجهزة المحمولة */
            -webkit-overflow-scrolling: touch;
            /* منع التمرير الأفقي غير المرغوب */
            max-width: 100vw;
        }
        
        /* تحسين التمرير في HTML */
        html {
            scroll-behavior: smooth;
            /* دعم التمرير على iOS */
            -webkit-overflow-scrolling: touch;
            /* منع التمرير الأفقي */
            overflow-x: hidden;
        }
        
        /* تحسين التمرير على الأجهزة المحمولة */
        @media (max-width: 768px) {
            body {
                /* تحسين التمرير على الأجهزة المحمولة */
                -webkit-overflow-scrolling: touch;
                /* منع التمرير الأفقي */
                overflow-x: hidden;
            }
            
            html {
                /* تحسين التمرير على الأجهزة المحمولة */
                -webkit-overflow-scrolling: touch;
                scroll-behavior: auto; /* تمرير فوري على الأجهزة المحمولة */
            }
        }
        
        .product-card {
            transition: all 0.3s ease;
            box-shadow: 0 2px 15px rgba(0,0,0,0.05);
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
                                                                                            .product-card img {
                                    image-rendering: -webkit-optimize-contrast;
                                    image-rendering: crisp-edges;
                                    backface-visibility: hidden;
                                    -webkit-backface-visibility: hidden;
                                    object-fit: cover;
                                    object-position: center;
                                    width: 100%;
                                    height: 100%;
                                    transition: transform 0.3s ease;
                                    transform: scale(1.0);
                                }
        
        .product-card .image-container {
            position: relative;
            width: 100%;
            height: 384px; /* نفس ارتفاع صفحة التفاصيل */
            overflow: hidden;
            border-radius: 8px;
            background-color: #f8f9fa;
        }
        
        /* تحسينات للشاشات الصغيرة */
        @media (max-width: 640px) {
            .product-card .image-container {
                height: 280px; /* ارتفاع أطول للشاشات الصغيرة مع عمودين */
            }
            
            .product-card {
                font-size: 0.875rem; /* حجم خط أصغر للشاشات الصغيرة */
            }
            
            .product-card h3 {
                font-size: 1rem; /* حجم عنوان أصغر */
                line-height: 1.2;
            }
            
            .product-card .price {
                font-size: 0.9rem; /* حجم السعر أصغر */
            }
            
            .product-card .location {
                font-size: 0.8rem; /* حجم الموقع أصغر */
            }
            
            /* تحسين عرض علامات الموقع على الشاشات الصغيرة */
            .product-card .flex.flex-col.items-end.gap-1 span {
                font-size: 0.7rem;
                padding: 0.25rem 0.5rem;
                line-height: 1;
            }
            
            /* تحسين عرض التصنيفات الفرعية على الشاشات الصغيرة */
            .product-card .flex.flex-wrap.gap-1 span {
                font-size: 0.7rem !important;
                padding: 0.2rem 0.4rem !important;
                line-height: 1.2;
                max-width: 100px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
        }
        
        @media (min-width: 641px) and (max-width: 768px) {
            .product-card .image-container {
                height: 280px; /* ارتفاع للشاشات المتوسطة */
            }
            
            /* تحسين عرض علامات الموقع على الشاشات المتوسطة */
            .product-card .flex.flex-col.items-end.gap-1 span {
                font-size: 0.75rem;
                padding: 0.3rem 0.6rem;
                line-height: 1.1;
            }
            
            /* تحسين عرض التصنيفات الفرعية على الشاشات المتوسطة */
            .product-card .flex.flex-wrap.gap-1 span {
                font-size: 0.75rem !important;
                padding: 0.25rem 0.5rem !important;
                line-height: 1.2;
                max-width: 120px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            .product-card .image-container {
                height: 320px; /* ارتفاع للشاشات الكبيرة */
            }
            
            /* تحسين عرض علامات الموقع على الشاشات الكبيرة */
            .product-card .flex.flex-col.items-end.gap-1 span {
                font-size: 0.8rem;
                padding: 0.4rem 0.8rem;
                line-height: 1.2;
            }
            
            /* تحسين عرض التصنيفات الفرعية على الشاشات الكبيرة */
            .product-card .flex.flex-wrap.gap-1 span {
                font-size: 0.8rem !important;
                padding: 0.3rem 0.6rem !important;
                line-height: 1.2;
                max-width: 140px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
        }
        
        /* الشاشات الكبيرة تحتفظ بالارتفاع الأصلي 384px */
        @media (min-width: 1025px) {
            /* تحسين عرض علامات الموقع على الشاشات الكبيرة جداً */
            .product-card .flex.flex-col.items-end.gap-1 span {
                font-size: 0.875rem;
                padding: 0.5rem 1rem;
                line-height: 1.3;
            }
            
            /* تحسين عرض التصنيفات الفرعية على الشاشات الكبيرة جداً */
            .product-card .flex.flex-wrap.gap-1 span {
                font-size: 0.875rem !important;
                padding: 0.4rem 0.8rem !important;
                line-height: 1.3;
                max-width: 160px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }
        }
        
        .product-card:hover img {
            transform: scale(1.05);
        }
        
        .gold-border {
            border: 1px solid var(--gold);
        }
        
        .gold-text {
            color: var(--gold);
            font-weight: bold;
        }
        
        .category-badge {
            background: linear-gradient(135deg, var(--gold) 0%, #b8941f 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.875rem;
        }
        
        .filter-btn.active {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--gold) 0%, #b8941f 100%);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.3);
        }
        
        .btn-secondary {
            background: transparent;
            color: #666;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            border-color: #999;
            color: #333;
        }

        .filter-section {
            background: white;
            border-radius: 12px;
            padding: 0.75rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            position: relative;
            z-index: 50;
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.95);
            transition: all 0.3s ease;
        }
        
        .filter-section.scrolled {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            margin: 0;
            border-radius: 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            background-color: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(15px);
            z-index: 100;
        }
        
        @media (min-width: 640px) {
            .filter-section {
                padding: 1rem;
                margin-bottom: 1.5rem;
            }
        }
        
        @media (min-width: 768px) {
            .filter-section {
                padding: 1.5rem;
            }
        }

        .filter-title {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        @media (min-width: 640px) {
            .filter-title {
                font-size: 1.1rem;
                margin-bottom: 1rem;
            }
        }



        .clear-filters-btn {
            background: #ef4444;
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 8px;
            font-size: 0.8rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        @media (min-width: 640px) {
            .clear-filters-btn {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }
        }

        .clear-filters-btn:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }


        .active-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
            margin-top: 0.75rem;
        }
        
        @media (min-width: 640px) {
            .active-filters {
                gap: 0.5rem;
                margin-top: 1rem;
            }
        }

        .active-filter-tag {
            background: #3b82f6;
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        
        @media (min-width: 640px) {
            .active-filter-tag {
                padding: 0.25rem 0.75rem;
                font-size: 0.875rem;
                gap: 0.5rem;
            }
        }

        .remove-filter {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            border-radius: 50%;
            width: 1rem;
            height: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
        }
        
        @media (min-width: 640px) {
            .remove-filter {
                width: 1.25rem;
                height: 1.25rem;
                font-size: 0.75rem;
            }
        }

        /* Toggle button styles */
        .toggle-filters-btn {
            background: none;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            font-weight: 600;
            color: #374151;
            transition: all 0.3s ease;
            padding: 0.5rem;
            border-radius: 8px;
        }
        
        @media (min-width: 640px) {
            .toggle-filters-btn {
                font-size: 0.9rem;
            }
        }

        .toggle-filters-btn:hover {
            background-color: #f3f4f6;
            color: #1f2937;
        }

        .toggle-icon {
            transition: transform 0.3s ease;
        }

        .toggle-icon.rotated {
            transform: rotate(180deg);
        }



        .filter-btn {
            padding: 10px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            color: #374151;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            min-width: 120px;
            text-align: center;
        }

        .filter-btn:hover {
            border-color: #d4af37;
            background: #fefbf0;
            transform: translateY(-1px);
        }

        .filter-btn.active {
            background: #d4af37;
            border-color: #d4af37;
            color: white;
            box-shadow: 0 2px 8px rgba(212, 175, 55, 0.3);
        }

        /* إخفاء شريط التمرير للإعلانات المميزة */
        .scrollbar-hide {
            -ms-overflow-style: none;  /* Internet Explorer 10+ */
            scrollbar-width: none;  /* Firefox */
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;  /* Safari and Chrome */
        }

        /* تحسين عرض الإعلانات المميزة */
        #featured-ads-container {
            scroll-behavior: auto;
            scroll-snap-type: x mandatory;
            /* تحسين التمرير على الأجهزة المحمولة */
            -webkit-overflow-scrolling: touch;
            /* منع التمرير العمودي */
            overflow-y: hidden;
        }
        
        /* تحسين التمرير في جميع العناصر */
        * {
            /* ضمان عمل التمرير */
            scroll-behavior: auto;
        }
        
        /* تحسين التمرير على المتصفحات المختلفة */
        @supports (scroll-behavior: auto) {
            html {
                scroll-behavior: auto;
            }
        }
        
        /* دعم التمرير على Safari */
        @supports (-webkit-appearance: none) {
            html, body {
                -webkit-overflow-scrolling: touch;
            }
        }
        
        /* تحسين التمرير في النوافذ المنبثقة */
        .modal, .popup {
            -webkit-overflow-scrolling: touch;
            overflow-y: auto;
        }
        
        /* تحسين التمرير في القوائم */
        .dropdown-content, .mobile-menu {
            -webkit-overflow-scrolling: touch;
            overflow-y: auto;
        }
        
        /* تحسين القائمة الرئيسية للهاتف المحمول */
        #mobile-menu {
            /* منع التمرير في الصفحة الرئيسية عند فتح القائمة */
            overscroll-behavior: contain;
            /* تحسين التمرير باللمس */
            -webkit-overflow-scrolling: touch;
            /* إخفاء شريط التمرير */
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        #mobile-menu::-webkit-scrollbar {
            display: none;
        }
        
        #mobile-menu > div {
            /* تحديد ارتفاع أقصى للقائمة */
            max-height: 80vh;
            /* تفعيل التمرير العمودي */
            overflow-y: auto;
            /* منع التمرير الأفقي */
            overflow-x: hidden;
        }
        
        /* تحسين التمرير على الأجهزة المحمولة */
        @media (max-width: 768px) {
            #mobile-menu > div {
                /* تحسين التمرير على الأجهزة المحمولة */
                -webkit-overflow-scrolling: touch;
                /* منع التمرير في الصفحة الرئيسية */
                overscroll-behavior: contain;
                /* تحسين الأداء */
                will-change: scroll-position;
            }
        }

        #featured-ads-container > div {
            transition: all 0.3s ease;
            scroll-snap-align: start;
            /* إزالة scroll-snap-align لمنع مشاكل التمرير */
        }

        #featured-ads-container > div:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        

        .filter-btn.active:hover {
            background: #b8941f;
            border-color: #b8941f;
        }

        @media (max-width: 640px) {
            .filter-btn {
                min-width: 100px;
                padding: 8px 12px;
                font-size: 14px;
            }
        }



        /* Slider Controls */
        .slider-btn { position: absolute; top: 50%; transform: translateY(-50%); background: rgba(255,255,255,0.9); border: none; width: 32px; height: 32px; border-radius: 9999px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 10; }
        .slider-prev { right: 8px; }
        .slider-next { left: 8px; }





        .slider-dots { position: absolute; bottom: 8px; left: 0; right: 0; display: flex; gap: 6px; justify-content: center; z-index: 10; }
        .slider-dot { width: 6px; height: 6px; border-radius: 9999px; background: rgba(255,255,255,0.8); border: 1px solid rgba(0,0,0,0.1); padding: 0; }
        .slider-dot.active { background: #d4af37; }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <!-- Logo -->
                <div class="flex items-center">
                    <a href="../index.html" class="text-xl sm:text-2xl font-bold gold-text">زِينَة</a>
                </div>
                
                <!-- Desktop Navigation -->
                <nav class="hidden lg:flex space-x-6 space-x-reverse">
                    <a href="../index.html" class="text-gray-600 hover:text-gray-900 transition-colors">الرئيسية</a>
                    <a href="category-koshat.html" class="text-gray-600 hover:text-gray-900 transition-colors">كوشات</a>
                    <a href="category-cake.html" class="text-gray-600 hover:text-gray-900 transition-colors">تورتات وأنواع الشوكولاتة</a>
                    <a href="category-mirr.html" class="text-gray-600 hover:text-gray-900 transition-colors">مرايا</a>
                    <a href="category-other.html" class="text-gray-900 font-semibold">ديكورات</a>
                    <a href="category-flowerbouquets.html" class="text-gray-600 hover:text-gray-900 transition-colors">بوكيهات الورد</a>
                    <a href="category-invitations.html" class="text-gray-600 hover:text-gray-900 transition-colors">دعوات وتوزيعات</a>
                    <a href="about-us.html" class="text-gray-600 hover:text-gray-900 transition-colors">من نحن</a>
                    <a href="contact-us.html" class="text-gray-600 hover:text-gray-900 transition-colors">اتصل بنا</a>
                </nav>
                
                <!-- Desktop Buttons -->
                <div class="hidden md:flex items-center space-x-4 space-x-reverse">
                    <a href="favorites.html" class="text-pink-500 hover:text-pink-600 transition-colors flex items-center space-x-2 space-x-reverse relative">
                        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                        </svg>
                        <span>المفضلة</span>
                        <span id="favorites-count-badge" class="absolute -top-2 -right-2 bg-yellow-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold hidden">0</span>
                    </a>

                                    <!-- Desktop Add Product Request Button -->
                <a href="add-product-request.html" class="text-white text-xs px-3 py-2 rounded-lg font-semibold transition-all duration-200" style="background-color: #845FCE;" transform hover:scale-105 transition-all duration-200" id="add-product-request-btn-desktop">
                        <span class="flex items-center space-x-1 space-x-reverse">
                            <span>➕</span>
                            <span>أضف منتجك</span>
                        </span>
                    </a>

                                    <!-- Desktop Advertise Button -->
                <a href="advertise-with-us.html" class="text-white text-xs px-3 py-2 rounded-lg font-semibold transition-all duration-200" style="background-color: #845FCE;" transform hover:scale-105 transition-all duration-200">
                    <span class="flex items-center space-x-1 space-x-reverse">
                        <span>⭐</span>
                        <span>أضف إعلانك</span>
                    </span>
                </a>


                </div>
                

                
                <!-- Mobile Menu Button -->
                <div class="lg:hidden flex items-center space-x-3 space-x-reverse">
                    <!-- Mobile Favorites Button -->
                    <a href="favorites.html" class="text-pink-500 hover:text-pink-600 transition-colors flex items-center space-x-2 space-x-reverse relative">
                        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                        </svg>
                        <span id="favorites-count-badge-mobile" class="absolute -top-2 -right-2 bg-yellow-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold hidden">0</span>
                    </a>
                    

                    
                    <!-- زر أضف منتجك -->
                    <a href="add-product-request.html" class="text-white text-xs px-3 py-2 rounded-lg font-semibold transition-all duration-200" style="background-color: #845FCE;" transform hover:scale-105 transition-all duration-200 text-center">
                        <span class="flex items-center justify-center space-x-1 space-x-reverse">
                            <span>➕</span>
                            <span>أضف منتجك</span>
                        </span>
                    </a>
                    
                    <!-- Mobile Advertise Button -->
                    <a href="advertise-with-us.html" class="text-white text-xs px-2 py-2 rounded-lg font-semibold transition-all duration-200" style="background-color: #845FCE;" transform hover:scale-105 transition-all duration-200 text-center">
                        <span class="flex items-center justify-center space-x-1 space-x-reverse">
                            <span>⭐</span>
                            <span>أعلن معنا</span>
                        </span>
                    </a>
                    
                    <button id="mobile-menu-btn" class="p-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Mobile Navigation Menu -->
            <div id="mobile-menu" class="lg:hidden hidden bg-white border-t border-gray-200">
                <div class="px-4 py-2 space-y-2 max-h-[80vh] overflow-y-auto scrollbar-hide" style="-webkit-overflow-scrolling: touch; overscroll-behavior: contain;">
                    
                    <!-- التصنيفات -->
                    <div class="border-b border-gray-200 pb-3">
                        <h3 class="text-sm font-semibold text-gray-700 mb-2">التصنيفات</h3>
                        <div class="space-y-2">
                            <a href="category-koshat.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">كوشات</a>
                            <a href="category-cake.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">تورتات وأنواع الشوكولاتة</a>
                            <a href="category-mirr.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">مرايا</a>
                            <a href="category-other.html" class="block py-2 px-3 text-gray-900 font-semibold bg-gray-50 rounded-lg">ديكورات متنوعة</a>
                            <a href="category-flowerbouquets.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">بوكيهات الورد</a>
                            <a href="category-invitations.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">دعوات وتوزيعات</a>
                        </div>
                    </div>
                    
                    <!-- إضافة منتج -->
                    <div class="border-b border-gray-200 pb-3">
                        <h3 class="text-sm font-semibold text-gray-700 mb-2">إضافة منتج</h3>
                        <div class="space-y-2">
                            <a href="add-product-request.html" class="block py-2 px-3 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-all duration-200 text-sm flex items-center">
                                <span class="mr-2">➕</span>
                                أضف منتجك
                            </a>
                        </div>
                    </div>
                    
                    <!-- روابط مهمة -->
                    <div class="border-b border-gray-200 pb-3">
                        <h3 class="text-sm font-semibold text-gray-700 mb-2">روابط مهمة</h3>
                        <div class="space-y-2">
                            <a href="about-us.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">من نحن</a>
                            <a href="contact-us.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">اتصل بنا</a>
                            <a href="../index.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">الرئيسية</a>
                            <a href="advertise-with-us.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm flex items-center">
                                <span class="mr-2">⭐</span>
                                أعلن معنا
                            </a>
                        </div>
                    </div>
                    
                    <!-- تواصل معنا -->
                    <div class="border-b border-gray-200 pb-3">
                        <h3 class="text-sm font-semibold text-gray-700 mb-2">تواصل معنا</h3>
                        
                        <!-- التواصل الاجتماعي -->
                        <div class="mb-3">
                            <h4 class="text-xs font-medium text-gray-500 mb-2">التواصل الاجتماعي</h4>
                            <div class="space-y-2">
                                <a href="https://www.facebook.com/share/1BCEhAV89y/?mibextid=wwXIfr" target="_blank" class="block py-2 px-3 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200 text-sm flex items-center">
                                    <span class="mr-2">📘</span>
                                    فيسبوك
                                </a>
                                <a href="https://www.instagram.com/zeina.eg_?igsh=MXg4bzNqd213Z3IyaQ==" target="_blank" class="block py-2 px-3 text-gray-600 hover:text-pink-600 hover:bg-pink-50 rounded-lg transition-all duration-200 text-sm flex items-center">
                                    <span class="mr-2">📷</span>
                                    إنستغرام
                                </a>
                                <a href="https://wa.me/201016436007" target="_blank" class="block py-2 px-3 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-all duration-200 text-sm flex items-center">
                                    <span class="mr-2">📱</span>
                                    واتساب
                                </a>
                            </div>
                        </div>
                        
                        <!-- التواصل المباشر -->
                        <div>
                            <h4 class="text-xs font-medium text-gray-500 mb-2">التواصل المباشر</h4>
                            <div class="space-y-2">
                                <a href="tel:+201016436007" class="block py-2 px-3 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200 text-sm flex items-center">
                                    <span class="mr-2">📞</span>
                                    اتصل بنا: 01016436007
                                </a>
                                <a href="contact-us.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm flex items-center">
                                    <span class="mr-2">📧</span>
                                    راسلنا
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mobile Auth Buttons -->
                    <div class="auth-buttons-mobile border-t border-gray-200 pt-2 mt-2">
                        <!-- Auth buttons will be dynamically updated -->
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-2 sm:px-3 md:px-4 py-4 sm:py-6 md:py-8">


        <!-- Advanced Filters -->
        <div class="filter-section">
            <div class="flex justify-between items-center mb-3 sm:mb-4">
                <button id="toggle-filters-btn" class="toggle-filters-btn">
                    <svg id="toggle-icon" class="toggle-icon h-4 w-4 sm:h-5 sm:w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                    <span id="toggle-text" class="text-sm sm:text-base">فلاتر اختيار المنتج والمحافظة</span>
                </button>
                <div class="flex flex-col items-end gap-2">
                    <button id="clear-filters-btn" class="clear-filters-btn">مسح الفلاتر</button>
                </div>
            </div>



            <!-- Active Filters Display -->
            <div id="active-filters" class="active-filters"></div>
        </div>

        <!-- Products Count -->
        <div class="mb-6">
            <span id="products-count" class="text-gray-600 font-medium">0 منتج</span>
        </div>

        <!-- قسم الإعلانات المميزة في التصنيف -->
        <div id="category-featured-ads" class="mb-8">
            <div class="bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200 rounded-xl p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg sm:text-xl font-bold text-yellow-800 flex items-center gap-1 sm:gap-2">
                        <span class="text-base sm:text-lg">⭐</span>
                        <span class="text-sm sm:text-base">منتجات مميزة في هذا التصنيف</span>
                    </h2>
                </div>
                
                <!-- عرض الإعلانات المميزة -->
                <div id="featured-ads-container" class="flex overflow-x-auto gap-4 pb-4 scrollbar-hide">
                    <!-- سيتم ملء هذا القسم بواسطة JavaScript -->
                </div>
                
                <!-- رسالة عدم وجود إعلانات -->
                <div id="no-featured-ads" class="text-center py-8 hidden">
                    <div class="text-yellow-400 text-4xl mb-3">⭐</div>
                    <h3 class="text-lg font-medium text-yellow-700 mb-2">لا توجد منتجات مميزة حالياً</h3>
                    <p class="text-yellow-600 text-sm">كن أول من يضع منتجه في القسم المميز</p>
                </div>
            </div>
        </div>

        <!-- Products Grid -->
        <div id="products-container" class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 sm:gap-4 md:gap-6">
            <!-- Products will be loaded here -->
        </div>

        <!-- Pagination Container -->
        <div id="pagination-container" class="mt-8 text-center hidden">
            <!-- Pagination will be displayed here -->
        </div>

        <!-- Loading State -->
        <div id="loading-state" class="text-center py-12">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-gray-900"></div>
            <p class="mt-4 text-gray-600">جاري تحميل المنتجات...</p>
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="text-center py-12 hidden">
            <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
            </svg>
            <h3 class="mt-2 text-sm font-medium text-gray-900">لا توجد منتجات</h3>
            <p class="mt-1 text-sm text-gray-500">لم يتم العثور على منتجات في هذا التصنيف.</p>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-bold mb-4">زِينَة</h3>
                    <p class="text-gray-300 text-sm">منصة متخصصة في خدمات الخطوبة والمناسبات</p>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">روابط سريعة</h4>
                    <ul class="space-y-2 text-sm text-gray-300">
                        <li><a href="../index.html" class="hover:text-white transition-colors">الرئيسية</a></li>
                        <li><a href="about-us.html" class="hover:text-white transition-colors">من نحن</a></li>
                        <li><a href="contact-us.html" class="hover:text-white transition-colors">اتصل بنا</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">السياسات</h4>
                    <ul class="space-y-2 text-sm text-gray-300">
                        <li><a href="../legal/privacy-policy.html" class="hover:text-white transition-colors">سياسة الخصوصية</a></li>
                        <li><a href="../legal/terms-of-use.html" class="hover:text-white transition-colors">شروط الاستخدام</a></li>
                        <li><a href="../legal/cookies-policy.html" class="hover:text-white transition-colors">سياسة الكوكيز</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">التصنيفات</h4>
                    <ul class="space-y-2 text-sm text-gray-300">
                        <li><a href="category-koshat.html" class="hover:text-white transition-colors">كوشات</a></li>
                        <li><a href="category-cake.html" class="hover:text-white transition-colors">تورتة</a></li>
                        <li><a href="category-mirr.html" class="hover:text-white transition-colors">مرايا</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">تواصل معنا</h4>
                    <ul class="space-y-2 text-sm text-gray-300">
                        <li><a href="tel:+201016436007" class="hover:text-white transition-colors">📞 01016436007</a></li>
                        <li><a href="https://www.facebook.com/share/1BCEhAV89y/?mibextid=wwXIfr" target="_blank" class="hover:text-white transition-colors">📘 فيسبوك</a></li>
                        <li><a href="https://www.instagram.com/zeina.eg_?igsh=MXg4bzNqd213Z3IyaQ==" target="_blank" class="hover:text-white transition-colors">📷 إنستغرام</a></li>
                        <li><a href="https://wa.me/201016436007" target="_blank" class="hover:text-white transition-colors">📱 واتساب</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8">
                <div class="text-center text-sm text-gray-300 mb-4">
                    <p>&copy; 2024 زِينَة. جميع الحقوق محفوظة.</p>
                </div>
                <div class="bg-gray-700 rounded-lg p-4 text-center">
                    <p class="text-xs text-gray-400 leading-relaxed">
                        تنبيه قانوني: يقتصر دور الموقع على عرض المنتجات وربط الأطراف، ولا يشارك في البيع أو الدفع أو التوصيل. لا تتحمل إدارة الموقع أي مسؤولية عن الاتفاقات أو المعاملات التي تتم بين المستخدمين.
                    </p>
                </div>
            </div>
        </div>
    </footer>

    <script>
        /*
        ========================================
        تحسين عرض المدن والمحافظات في البطاقات
        ========================================
        
        المشكلة: كانت البطاقات تعرض "جميع المدن" عند عدم اختيار مدينة
        الحل: إخفاء خانة المدينة عند عدم الاختيار أو عند وجود قيم فارغة
        
        التعديلات المطبقة:
        1. إخفاء خانة المدينة عند عدم الاختيار
        2. إخفاء خانة المحافظة عند عدم الاختيار
        3. تنظيف البيانات من القيم الفارغة مثل 'null', 'undefined', 'جميع المدن'
        4. دعم جميع الأجهزة (هواتف، ألواح، شاشات كبيرة)
        5. تحسين الفلاتر لتعمل مع البيانات النظيفة فقط
        
        تاريخ التعديل: 2024
        ========================================
        */
        
        let allProducts = [];
        let filteredProducts = [];
        let currentPage = 1;
        const productsPerPage = 18;
        let currentFilter = 'all';
        let governorateFilter;
        let subcategoryFilter;
        let activeFilters = {
            subcategory: [],
            governorate: [],
            cities: [],
            price: ''
        };

        // دالة مساعدة لتنظيف بيانات الموقع
        function cleanLocationData(data) {
            if (!data || typeof data !== 'string') return '';
            const cleaned = data.trim();
            return cleaned !== '' && cleaned !== 'null' && cleaned !== 'undefined' && cleaned !== 'جميع المدن' ? cleaned : '';
        }

        // دالة مساعدة لتنظيف بيانات المدن
        function cleanCitiesData(cities) {
            if (!cities || typeof cities !== 'string') return '';
            const cleaned = cities.trim();
            if (cleaned === '' || cleaned === 'null' || cleaned === 'undefined' || cleaned === 'جميع المدن') return '';
            
            // تنظيف كل مدينة على حدة
            const cityArray = cities.split(',').map(city => city.trim()).filter(city => 
                city !== '' && city !== 'null' && city !== 'undefined'
            );
            
            return cityArray.length > 0 ? cityArray[0] : '';
        }

        // دالة مساعدة للتحقق من صحة البيانات
        function validateLocationData(data) {
            if (!data) return false;
            if (typeof data !== 'string') return false;
            const cleaned = data.trim();
            return cleaned !== '' && cleaned !== 'null' && cleaned !== 'undefined' && cleaned !== 'جميع المدن';
        }

        // دالة مساعدة لتنظيف البيانات قبل العرض
        function sanitizeDisplayData(data) {
            if (!validateLocationData(data)) return '';
            return data.trim();
        }

        // Load products on page load
        document.addEventListener('DOMContentLoaded', async function() {
            // قراءة رقم الصفحة من URL
            const urlParams = new URLSearchParams(window.location.search);
            currentPage = parseInt(urlParams.get('page')) || 1;
            
            // التمرير لأعلى إذا كانت الصفحة ليست الأولى
            if (currentPage > 1) {
                setTimeout(() => {
                    scrollToTop();
                }, 100);
            }
            

            
            // Initialize filters from URL (subcategory, governorate, cities, price)
            initializeFiltersFromURL();
            
            await loadCategoryProducts();
            setupAdvancedFilters();
            setupToggleFilters();
        });

        // Load products by category
        async function loadCategoryProducts() {
            try {
                // Wait for ProductService to load
                if (!window.ProductService) {
                    await new Promise((resolve) => {
                        const checkInterval = setInterval(() => {
                            if (window.ProductService) {
                                clearInterval(checkInterval);
                                resolve();
                            }
                        }, 100);
                        
                        setTimeout(() => {
                            clearInterval(checkInterval);
                            resolve();
                        }, 5000);
                    });
                }
                
                if (!window.ProductService) {
                    throw new Error('ProductService not available');
                }
                
                const result = await window.ProductService.getProductsByCategory('other');
                
                if (result.success) {
                    allProducts = result.data;
                    filteredProducts = [...allProducts];

                    // ترتيب المنتجات حسب المعايير المطلوبة
                    sortProductsByCriteria();
                    
                    // تحديث filteredProducts بعد الترتيب
                    filteredProducts = [...allProducts];
                    
                    applyFilters();
                } else {
                    showError('حدث خطأ في تحميل المنتجات: ' + result.error);
                }
                
            } catch (error) {
                showError('حدث خطأ في تحميل المنتجات');
            }
        }

        // ترتيب المنتجات حسب الأولوية: منتجات بسعر أولاً ثم بدون سعر
        function sortProductsByCriteria() {
            if (allProducts && allProducts.length > 0) {
                allProducts.sort((a, b) => {
                    const priceA = parseFloat(a.price);
                    const priceB = parseFloat(b.price);
                    const hasValidPriceA = !isNaN(priceA) && priceA > 0;
                    const hasValidPriceB = !isNaN(priceB) && priceB > 0;
                    
                    // إذا كان أحدهما له سعر والآخر لا، المنتج الذي له سعر يأتي أولاً
                    if (hasValidPriceA && !hasValidPriceB) {
                        return -1; // A يأتي قبل B
                    }
                    if (!hasValidPriceA && hasValidPriceB) {
                        return 1; // B يأتي قبل A
                    }
                    
                    // إذا كان كلاهما له سعر، ترتيب تصاعدي حسب السعر
                    if (hasValidPriceA && hasValidPriceB) {
                        return priceA - priceB;
                    }
                    
                    // إذا كان كلاهما بدون سعر، ترتيب حسب تاريخ الإنشاء
                    return new Date(b.created_at) - new Date(a.created_at);
                });
            }
        }

        // Setup toggle filters functionality
        function setupToggleFilters() {
            const toggleBtn = document.getElementById('toggle-filters-btn');
            
            toggleBtn.addEventListener('click', function() {
                const params = new URLSearchParams();
                if (activeFilters?.subcategory?.length) activeFilters.subcategory.forEach(v=>params.append('subcat', v));
                if (activeFilters?.governorate?.length) activeFilters.governorate.forEach(v=>params.append('gov', v));
                if (activeFilters?.cities?.length) activeFilters.cities.forEach(v=>params.append('city', v));
                switch (activeFilters?.price) {
                    case '0-200': params.set('pmin','0'); params.set('pmax','200'); break;
                    case '200-500': params.set('pmin','201'); params.set('pmax','500'); break;
                    case '500-1000': params.set('pmin','501'); params.set('pmax','1000'); break;
                    case '1000+': params.set('pmin','1001'); break;
                    case 'negotiable': params.set('pmin','0'); params.set('pmax','0'); break;
                }
                const qs = params.toString();
                window.location.href = `other-filters.html${qs ? '?' + qs : ''}`;
            });
        }



        // Setup advanced filters
        function setupAdvancedFilters() {
            // Clear filters button
            document.getElementById('clear-filters-btn').addEventListener('click', function() {
                clearAllFilters();
            });
        }

        // Initialize filters state from URL query params
        function initializeFiltersFromURL() {
            const params = new URLSearchParams(window.location.search);

            // Subcategories
            const subcats = params.getAll('subcat').filter(Boolean);
            if (subcats.length > 0) {
                activeFilters.subcategory = Array.from(new Set(subcats));
            }

            // Governorates
            const govs = params.getAll('gov').filter(Boolean);
            if (govs.length > 0) {
                activeFilters.governorate = Array.from(new Set(govs));
            }

            // Cities
            const cities = params.getAll('city').filter(Boolean);
            if (cities.length > 0) {
                activeFilters.cities = Array.from(new Set(cities));
            }

            // Price
            const pmin = params.get('pmin');
            const pmax = params.get('pmax');
            if (pmin !== null || pmax !== null) {
                let val = '';
                if (pmin === '0' && pmax === '200') val = '0-200';
                else if (pmin === '201' && pmax === '500') val = '200-500';
                else if (pmin === '501' && pmax === '1000') val = '500-1000';
                else if (pmin === '1001' && (pmax === null || pmax === '' || typeof pmax === 'undefined')) val = '1000+';
                else if (pmin === '0' && pmax === '0') val = 'negotiable';
                if (val) {
                    activeFilters.price = val;
                }
            }
        }

        // Apply all filters
        function applyFilters(resetPage = true) {
            let filteredProducts = allProducts;

            // Apply subcategory filter - فلتر التصنيفات الفرعية
            if (activeFilters.subcategory.length > 0) {
                const codeToAr = {
                    "other-birthday": "ديكور عيد ميلاد",
                    "other-hospital": "استقبال مستشفى", 
                    "other-bride": "استقبال عروسة",
                    "other-party": "حفلات بسيطة",
                    "other-balloons": "بالونات وهدايا",
                    "other-flowers": "زهور وأزهار",
                    "other-lights": "إضاءات ديكور"
                };
                const arToCode = {
                    "ديكور عيد ميلاد": "other-birthday",
                    "استقبال مستشفى": "other-hospital",
                    "استقبال عروسة": "other-bride", 
                    "حفلات بسيطة": "other-party",
                    "بالونات وهدايا": "other-balloons",
                    "زهور وأزهار": "other-flowers",
                    "إضاءات ديكور": "other-lights"
                };
                
                filteredProducts = filteredProducts.filter(product => {
                    if (!product.subcategory) return false;
                    
                    let productSubcats = [];
                    if (Array.isArray(product.subcategory)) {
                        productSubcats = product.subcategory;
                    } else if (typeof product.subcategory === 'string') {
                        try {
                            productSubcats = JSON.parse(product.subcategory);
                        } catch {
                            productSubcats = [product.subcategory];
                        }
                    }
                    
                    const mappedSubcats = productSubcats.map(x => arToCode[x] || x);
                    return activeFilters.subcategory.some(selected => 
                        mappedSubcats.includes(selected) || 
                        mappedSubcats.includes(codeToAr[selected] || selected)
                    );
                });
            }

            // Apply governorate filter - فلتر المحافظات
            if (activeFilters.governorate.length > 0) {
                filteredProducts = filteredProducts.filter(product => {
                    // التحقق من وجود المحافظة وأنها غير فارغة
                    if (cleanLocationData(product.governorate)) {
                        const productGovernorates = product.governorate.split(',').map(g => g.trim()).filter(gov => gov !== '' && gov !== 'null' && gov !== 'undefined');
                        return activeFilters.governorate.some(selected => 
                            productGovernorates.some(productGov => 
                                productGov.includes(selected)
                            )
                        );
                    }
                    return false;
                });
            }

            // Apply price filter
            if (activeFilters.price) {
                filteredProducts = filteredProducts.filter(product => {
                    const price = parseFloat(product.price) || 0;
                    
                    switch (activeFilters.price) {
                        case '0-200':
                            return price > 0 && price <= 200;
                        case '200-500':
                            return price > 200 && price <= 500;
                        case '500-1000':
                            return price > 500 && price <= 1000;
                        case '1000+':
                            return price > 1000;
                        case 'negotiable':
                            return price === 0 || !product.price;
                        default:
                            return true;
                    }
                });
            }

            // Apply cities filter - فلتر المدن
            if (activeFilters.cities.length > 0) {
                filteredProducts = filteredProducts.filter(product => {
                    // التحقق من وجود المدينة وأنها غير فارغة وليست "جميع المدن"
                    if (cleanCitiesData(product.cities)) {
                        const productCities = product.cities.split(',').map(c => c.trim()).filter(city => city !== '' && city !== 'null' && city !== 'undefined');
                        return activeFilters.cities.some(selected => 
                            productCities.some(productCity => 
                                productCity.includes(selected)
                            )
                        );
                    }
                    return false;
                });
            }



            // Update filtered products and display
            filteredProducts = filteredProducts;
            if (resetPage) {
                currentPage = 1;
                updateURL();
            }
            displayProducts(filteredProducts);
            updateActiveFiltersDisplay();
            updateURL();
            console.log('applyFilters called with resetPage:', resetPage, 'currentPage:', currentPage);
        }

        // Clear all filters
        function clearAllFilters() {
            // Reset active filters object
            activeFilters = {
                subcategory: [],
                governorate: [],
                cities: [],
                price: ''
            };

            // Apply filters
            applyFilters();
        }

        // Update active filters display
        function updateActiveFiltersDisplay() {
            const activeFiltersContainer = document.getElementById('active-filters');
            const filters = [];

            // Add subcategory filter
            activeFilters.subcategory.forEach(sub => {
                const subcategoryLabels = {
                            'other-birthday': 'ديكور عيد ميلاد',
        'other-hospital': 'استقبال المولود بالمستشفى',
        'other-bride': 'ديكور استقبال عروسة',
        'other-party': 'ديكور حفلات بسيطة'
                };
                filters.push({
                    type: 'subcategory',
                    text: subcategoryLabels[sub] || sub,
                    value: sub
                });
            });

            // Add governorate filters
            activeFilters.governorate.forEach(gov => {
                filters.push({
                    type: 'governorate',
                    text: gov,
                    value: gov
                });
            });

            // Add cities filters
            activeFilters.cities.forEach(city => {
                filters.push({
                    type: 'city',
                    text: city,
                    value: city
                });
            });

            // Add price filter
            if (activeFilters.price) {
                const priceText = document.getElementById('price-filter').options[
                    document.getElementById('price-filter').selectedIndex
                ].text;
                filters.push({
                    type: 'price',
                    text: priceText,
                    value: activeFilters.price
                });
            }

            // Display active filters
            if (filters.length > 0) {
                activeFiltersContainer.innerHTML = filters.map(filter => `
                    <div class="active-filter-tag">
                        ${filter.text}
                        <button class="remove-filter" onclick="removeFilter('${filter.type}', '${filter.value}')">
                            ×
                        </button>
                    </div>
                `).join('');
                activeFiltersContainer.style.display = 'flex';
            } else {
                activeFiltersContainer.style.display = 'none';
            }
        }

        // Remove specific filter
        function removeFilter(type, value) {
            switch (type) {
                case 'governorate':
                    activeFilters.governorate = activeFilters.governorate.filter(item => item !== value);
                    break;
                case 'city':
                    activeFilters.cities = activeFilters.cities.filter(item => item !== value);
                    break;
                case 'price':
                    activeFilters.price = '';
                    break;
            }
            applyFilters();
        }

        // Display products
        function displayProducts(products) {
            const container = document.getElementById('products-container');
            const loadingState = document.getElementById('loading-state');
            const emptyState = document.getElementById('empty-state');
            
            // Hide loading state
            loadingState.classList.add('hidden');
            
            if (!products || products.length === 0) {
                container.innerHTML = '<div class="text-center py-12"><p class="text-gray-500 text-lg">لا توجد منتجات</p></div>';
                document.getElementById('pagination-container').classList.add('hidden');
                return;
            }
            
            // Update products count
            const productsCount = document.getElementById('products-count');
            if (productsCount) {
                productsCount.textContent = `${products.length} منتج`;
            }
            
            const totalPages = Math.ceil(products.length / productsPerPage);
            const startIndex = (currentPage - 1) * productsPerPage;
            const endIndex = startIndex + productsPerPage;
            const currentProducts = products.slice(startIndex, endIndex);
            console.log('Pagination:', { currentPage, totalPages, startIndex, endIndex, totalProducts: products.length, currentProductsCount: currentProducts.length });
            
            container.innerHTML = currentProducts.map((product, index) => {

                const imageUrl = product.image_urls && product.image_urls.length > 0
                    ? product.image_urls[0]
                    : 'https://placehold.co/400x300/EEE/31343C?text=لا+توجد+صورة';

                // Get subcategory display name
                let subcategoryNames = [];
                let subcategoryColors = [];
                
                if (product.subcategory && Array.isArray(product.subcategory) && product.subcategory.length > 0) {

                    const subcategoryMap = {
                        'other-birthday': { name: 'ديكور عيد ميلاد', color: 'bg-yellow-500' },
                        'other-hospital': { name: 'ديكور استقبال مستشفى', color: 'bg-green-500' },
                        'other-bride': { name: 'ديكور استقبال عروسة', color: 'bg-pink-500' },
                        'other-party': { name: 'ديكور حفلات بسيطة', color: 'bg-purple-500' },
                        'other-balloons': { name: 'بالونات وهدايا', color: 'bg-red-500' },
                        'other-flowers': { name: 'زهور وأزهار', color: 'bg-pink-400' },
                        'other-lights': { name: 'إضاءات ديكور', color: 'bg-yellow-400' }
                    };

                    // معالجة جميع التصنيفات الفرعية
                    product.subcategory.forEach((subcat, subIndex) => {
                        const subcategoryInfo = subcategoryMap[subcat];

                        if (subcategoryInfo) {
                            subcategoryNames.push(subcategoryInfo.name);
                            subcategoryColors.push(subcategoryInfo.color);
                        } else {
                            // إذا لم نجد ترجمة، استخدم النص كما هو
                            subcategoryNames.push(subcat);
                            subcategoryColors.push('bg-gray-500');
                        }
                    });
                } else if (product.subcategory && typeof product.subcategory === 'string') {

                    // خريطة للنصوص العربية المباشرة
                    const arabicToCodeMap = {
                        'ديكور عيد ميلاد': 'other-birthday',
                        'استقبال المولود بالمستشفى': 'other-hospital',
                        'ديكور استقبال عروسة': 'other-bride',
                        'ديكور حفلات بسيطة': 'other-party',
                        'بالونات وهدايا': 'other-balloons'
                    };

                    // خريطة التصنيفات الفرعية
                    const subcategoryMap = {
                        'other-birthday': { name: 'ديكور عيد ميلاد', color: 'bg-yellow-500' },
                        'other-hospital': { name: 'استقبال المولود بالمستشفى', color: 'bg-green-500' },
                        'other-bride': { name: 'ديكور استقبال عروسة', color: 'bg-pink-500' },
                        'other-party': { name: 'ديكور حفلات بسيطة', color: 'bg-purple-500' },
                        'other-balloons': { name: 'بالونات وهدايا', color: 'bg-red-500' }
                    };

                    // محاولة معالجة النص كـ JSON أولاً
                    try {
                        const subcategoryArray = JSON.parse(product.subcategory);

                        if (Array.isArray(subcategoryArray) && subcategoryArray.length > 0) {

                            // معالجة جميع التصنيفات الفرعية
                            subcategoryArray.forEach((subcat, subIndex) => {
                                const subcategoryInfo = subcategoryMap[subcat];

                                if (subcategoryInfo) {
                                    subcategoryNames.push(subcategoryInfo.name);
                                    subcategoryColors.push(subcategoryInfo.color);
                                } else {
                                    // إذا لم نجد ترجمة، استخدم النص كما هو
                                    subcategoryNames.push(subcat);
                                    subcategoryColors.push('bg-gray-500');
                                }
                            });
                        }
                    } catch (error) {
                        // تحويل النص العربي إلى كود
                        const subcategoryCode = arabicToCodeMap[product.subcategory];

                        if (subcategoryCode) {
                            const subcategoryInfo = subcategoryMap[subcategoryCode];

                            if (subcategoryInfo) {
                                subcategoryNames.push(subcategoryInfo.name);
                                subcategoryColors.push(subcategoryInfo.color);
                            }
                        } else {
                            // إذا لم يتم العثور على ترجمة، استخدم النص كما هو
                            subcategoryNames.push(product.subcategory);
                            subcategoryColors.push('bg-gray-500');
                        }
                    }
                } else {
                    console.log(`🔍 [DEBUG] No valid subcategory data for product ${product.id}`);
                    processingMethod = 'NO_DATA';
                }
                
                // إذا لم توجد تصنيفات فرعية، استخدم قيم افتراضية
                if (subcategoryNames.length === 0) {
                    subcategoryNames = ['ديكور'];
                    subcategoryColors = ['bg-blue-500'];
                }
                
                let images = [];
                if (Array.isArray(product.image_urls) && product.image_urls.length > 0) {
                    images = product.image_urls;
                } else if (typeof product.image_urls === 'string' && product.image_urls.trim() !== '') {
                    try {
                        const parsed = JSON.parse(product.image_urls);
                        if (Array.isArray(parsed) && parsed.length > 0) {
                            images = parsed;
                        }
                    } catch (e) {
                        if (product.image_urls.includes(',')) {
                            images = product.image_urls.split(',').map(s => s.trim()).filter(Boolean);
                        } else {
                            images = [product.image_urls.trim()];
                        }
                    }
                }
                if (images.length === 0) { images = [imageUrl]; }
                const initialIndex = 0;
                return `
                    <div class=\"product-card bg-white rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow duration-300\" data-product-id=\"${product.id}\">\n                        <div class=\"image-container\" tabindex=\"0\" data-product-id=\"${product.id}\">\n                            ${images.map((url, idx) => `<img src=\"${url}\" alt=\"${product.title || 'منتج'}\" class=\"w-full h-full object-cover object-center transition-transform duration-300 hover:scale-105 cursor-pointer slider-image ${idx === initialIndex ? '' : 'hidden'}\" loading=\"${idx === initialIndex ? 'eager' : 'lazy'}\" onclick=\"viewProduct('${product.id}')\">`).join('')}\n                            ${images.length > 1 ? `
                                <button class=\"slider-btn slider-prev\" aria-label=\"السابق\">‹</button>
                                <button class=\"slider-btn slider-next\" aria-label=\"التالي\">›</button>
                            ` : ''}\n                            <div class=\"slider-dots\">${images.map((_, i) => `<button class=\"slider-dot ${i === initialIndex ? 'active' : ''}\" aria-label=\"الصورة ${i + 1}\" data-index=\"${i}\"></button>`).join('')}</div>\n                            <div class=\"absolute top-3 left-3\">\n                                <button class=\"favorite-btn bg-white rounded-full p-2 shadow-lg hover:bg-pink-50 transition-all duration-200\" onclick=\"toggleFavorite(event, '${product.id}', '${product.title || 'منتج'}', '${imageUrl}', '${product.price || 0}', '${product.governorate || ''}', '${product.cities || ''}', '${subcategoryNames.join(',')}')\">\n                                    <svg class=\"w-5 h-5 ${isFavorite(product.id) ? 'text-pink-500 fill-current' : 'text-gray-400'}\" viewBox=\"0 0 24 24\">\n                                        <path d=\"M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z\"/>\n                                    </svg>\n                                </button>\n                            </div>\n                        </div>
                                                    <div class="p-3 sm:p-4">
                            ${subcategoryNames.length > 0 ? `
                                <div class="mb-2 flex flex-wrap gap-1">
                                    ${subcategoryNames.map((name, index) => {
                                        const color = subcategoryColors[index];
                                        const bgColor = color.replace('bg-', 'bg-').replace('-500', '-100').replace('-400', '-100');
                                        const textColor = color.replace('bg-', 'text-').replace('-500', '-800').replace('-400', '-800');
                                        // تقسيم النصوص الطويلة على عدة سطور
                                        let displayName = name;
                                        if (name === 'استقبال المولود بالمستشفى') {
                                            displayName = 'استقبال المولود<br>بالمستشفى';
                                        } else if (name.length > 15) {
                                            // تقسيم النصوص الأخرى الطويلة تلقائياً
                                            const words = name.split(' ');
                                            if (words.length > 2) {
                                                const mid = Math.ceil(words.length / 2);
                                                displayName = words.slice(0, mid).join(' ') + '<br>' + words.slice(mid).join(' ');
                                            }
                                        }

                                        return `
                                            <span class="inline-block ${bgColor} ${textColor} text-xs sm:text-sm px-1.5 sm:px-2 py-0.5 sm:py-1 rounded-full">
                                                ${displayName}
                                            </span>
                                        `;
                                    }).join('')}
                                </div>
                            ` : ''}

                            <div class="flex justify-between items-center">
                                <span class="gold-text font-bold text-sm sm:text-lg">
                                    ${product.price > 0 ? product.price + ' ج.م' : 'السعر عند الطلب'}
                                </span>
                                <div class="flex flex-col items-end gap-1">
                                    <!-- عرض المحافظة فقط إذا كانت موجودة وغير فارغة -->
                                    ${sanitizeDisplayData(product.governorate) ? `<span class="text-xs sm:text-sm bg-gray-100 text-gray-600 px-1.5 sm:px-2 py-0.5 sm:py-1 rounded-full">${sanitizeDisplayData(product.governorate)}</span>` : ''}
                                    <!-- عرض المدينة فقط إذا كانت موجودة وغير فارغة وليست "جميع المدن" -->
                                    ${sanitizeDisplayData(product.cities) ? `<span class="text-xs sm:text-sm bg-blue-100 text-blue-700 px-1.5 sm:px-2 py-0.5 sm:py-1 rounded-full">${sanitizeDisplayData(product.cities)}</span>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                return cardHtml;
            }).join('');
            initCardSliders();
            
            displayPagination(products.length);
        }

        // View product details
        function viewProduct(productId) {
            window.location.href = `product-details.html?id=${productId}`;
        }

        // عرض تفاصيل المنتج
        function viewProductDetails(productId) {
            // البحث عن المنتج في القائمة
            let product = allProducts.find(p => p.id === productId);
            
            // إذا لم يتم العثور على المنتج، قد يكون منتج مميز
            if (!product) {
                // البحث في المنتجات المميزة
                const featuredAdsContainer = document.getElementById('featured-ads-container');
                if (featuredAdsContainer) {
                    const featuredAd = featuredAdsContainer.querySelector(`[data-ad-id="${productId}"]`);
                    if (featuredAd) {
                        // استخراج بيانات المنتج المميز من العنصر
                        const adData = JSON.parse(featuredAd.getAttribute('data-ad-info') || '{}');
                        if (adData.id) {
                            product = adData;
                            
                            // تسجيل النقر على الإعلان إذا كان موجوداً
                            if (product.ad_id && window.advertisingService) {
                                try {
                                    window.advertisingService.recordClick(product.ad_id);
                                } catch (error) {
                                    // Handle error silently
                                }
                            }
                        }
                    }
                }
            }
            
            if (!product) {
                return;
            }

            // إنشاء نافذة منبثقة لعرض التفاصيل
            showProductDetailsModal(product);
        }

        // عرض نافذة تفاصيل المنتج
        function showProductDetailsModal(product) {
            // إزالة النوافذ المنبثقة السابقة
            const existingModal = document.querySelector('.product-details-modal');
            if (existingModal) {
                existingModal.remove();
            }

            // إنشاء النافذة المنبثقة
            const modal = document.createElement('div');
            modal.className = 'product-details-modal fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            
            // الحصول على الصورة الأولى
            const imageUrl = product.image_urls && product.image_urls.length > 0 
                ? product.image_urls[0] 
                : '../assets/images/decorations.jpg';

            modal.innerHTML = `
                <div class="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-hidden">
                    <!-- Header -->
                    <div class="flex justify-between items-center p-6 border-b bg-white sticky top-0 z-10">
                        <h2 class="text-xl font-bold text-gray-800">تفاصيل المنتج</h2>
                        <button onclick="closeProductDetailsModal()" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">
                            ×
                        </button>
                    </div>
                    
                    <!-- Content -->
                    <div class="p-6 overflow-y-auto max-h-[calc(90vh-80px)]">
                        <!-- Main Image -->
                        <div class="mb-4">
                            <img id="modal-main-image" src="${imageUrl}" alt="${product.name || 'منتج'}" 
                                 class="w-45 h-48 object-cover rounded-lg"
                                 loading="lazy">
                        </div>
                        
                        <!-- Image Gallery -->
                        ${product.image_urls && product.image_urls.length > 1 ? `
                            <div class="mb-6">
                                <h4 class="text-sm font-medium text-gray-700 mb-3">معرض الصور</h4>
                                <div class="flex space-x-2 space-x-reverse overflow-x-auto pb-2">
                                    ${product.image_urls.map((url, index) => `
                                        <img src="${url}" 
                                             alt="صورة ${index + 1}" 
                                             class="w-16 h-16 object-cover rounded-lg cursor-pointer border-2 border-transparent hover:border-yellow-400 transition-colors"
                                             onclick="changeModalMainImage('${url}')"
                                             loading="lazy">
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- Product Info -->
                        <div class="space-y-4">
                            <!-- Price -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800 mb-2">السعر</h3>
                                <p class="text-2xl font-bold text-yellow-600">
                                    ${product.price > 0 ? product.price + ' ج.م' : 'السعر عند الطلب'}
                                </p>
                            </div>
                            
                            <!-- Description -->
                            ${product.description ? `
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-800 mb-2">الوصف</h3>
                                    <p class="text-gray-600">${product.description}</p>
                                </div>
                            ` : ''}
                            
                            <!-- Location -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800 mb-2">الموقع</h3>
                                <div class="space-y-2">
                                    <!-- عرض المحافظة فقط إذا كانت موجودة وغير فارغة -->
                                    ${sanitizeDisplayData(product.governorate) ? `<p class="text-gray-600">المحافظة: ${sanitizeDisplayData(product.governorate)}</p>` : ''}
                                    <!-- عرض المدينة فقط إذا كانت موجودة وغير فارغة وليست "جميع المدن" -->
                                    ${sanitizeDisplayData(product.cities) ? `<p class="text-gray-600">المدينة: ${sanitizeDisplayData(product.cities)}</p>` : ''}
                                </div>
                            </div>
                            
                            <!-- Category -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800 mb-2">التصنيف</h3>
                                <p class="text-gray-600">${product.category || 'غير محدد'}</p>
                            </div>
                        </div>
                        
                        <!-- Actions -->
                        <div class="flex gap-3 mt-6 pt-6 border-t">
                            <!-- Favorite Button -->
                            <button onclick="toggleFavoriteFromModal('${product.id}')" 
                                    class="w-full bg-pink-500 hover:bg-pink-600 text-white py-3 px-4 rounded-lg font-medium transition-colors">
                                ${isFavorite(product.id) ? 'إزالة من المفضلة' : 'إضافة إلى المفضلة'}
                            </button>
                        </div>
                        
                        <!-- التواصل مع البائع -->
                        <div class="mt-4 pt-4 border-t border-gray-200">
                            <h4 class="text-lg font-semibold text-gray-800 mb-2">تواصل مع البائع</h4>
                            <p class="text-sm text-gray-600 mb-4">جميع وسائل التواصل التالية تخص البائع لهذا المنتج.</p>
                            <div class="space-y-3">
                                <!-- WhatsApp Button -->
                                ${product.whatsapp ? `
                                    <button onclick="openWhatsAppChat('${product.id}', '${product.name || 'منتج'}', '${product.image_urls && product.image_urls.length > 0 ? product.image_urls[0] : ''}', '${product.price || 0}', '${product.governorate || ''}', '${product.cities || ''}', '${product.subcategories ? product.subcategories.join(',') : ''}', '${product.whatsapp}')"
                                       class="w-full bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-medium transition-colors flex items-center justify-center gap-2">
                                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.86 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.464 3.488"/>
                                        </svg>
                                        راسل البائع عبر واتساب
                                    </button>
                                ` : ''}
                                
                                <!-- Facebook Button -->
                                ${product.facebook ? `
                                    <a href="${product.facebook}" 
                                       target="_blank" 
                                       class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg font-medium transition-colors flex items-center justify-center gap-2">
                                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                                        </svg>
                                        صفحة البائع على فيسبوك
                                    </a>
                                ` : ''}
                                
                                <!-- Instagram Button -->
                                ${product.instagram ? `
                                    <a href="${(() => {
                                        let instagramUrl = product.instagram;
                                        if (!instagramUrl.startsWith('http://') && !instagramUrl.startsWith('https://')) {
                                            if (instagramUrl.includes('instagram.com')) {
                                                instagramUrl = 'https://' + instagramUrl;
                                            } else {
                                                instagramUrl = 'https://www.instagram.com/' + instagramUrl;
                                            }
                                        }
                                        return instagramUrl;
                                    })()}" 
                                       target="_blank" 
                                       class="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white py-3 px-4 rounded-lg font-medium transition-colors flex items-center justify-center gap-2">
                                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.174-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.402.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.357-.629-2.746-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24.009 12.017 24.009c6.624 0 11.99-5.367 11.99-11.988C24.007 5.367 18.641.001 12.017.001z"/>
                                        </svg>
                                        تابع البائع على إنستجرام
                                    </a>
                                ` : ''}
                                
                                <!-- No Social Media Message -->
                                ${!product.facebook && !product.instagram && !product.whatsapp ? `
                                    <div class="text-center text-gray-500 text-sm py-3 w-full">
                                        لا توجد وسائل تواصل متاحة للبائع
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- رسالة التنويه -->
                        <div class="mt-4 pt-4 border-t border-gray-200">
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                                <div class="flex items-start gap-3">
                                    <div class="flex-shrink-0 mt-1">
                                        <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <h5 class="text-sm font-semibold text-blue-800 mb-1">تنويه مهم</h5>
                                        <p class="text-sm text-blue-700 leading-relaxed">
                                            نحن منصة لعرض المنتجات فقط، ولسنا طرفًا في البيع أو التوصيل. جميع التعاملات تتم بين البائع والمشتري بشكل مباشر.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // إغلاق النافذة عند النقر خارجها
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeProductDetailsModal();
                }
            });
        }

        // إغلاق نافذة تفاصيل المنتج
        function closeProductDetailsModal() {
            const modal = document.querySelector('.product-details-modal');
            if (modal) {
                modal.remove();
            }
        }

        // تبديل المفضلة من النافذة المنبثقة
        function toggleFavoriteFromModal(productId) {
            // البحث عن المنتج في القائمة الرئيسية
            let product = allProducts.find(p => p.id === productId);
            
            // إذا لم يتم العثور على المنتج، البحث في المنتجات المميزة
            if (!product) {
                const featuredAdsContainer = document.getElementById('featured-ads-container');
                if (featuredAdsContainer) {
                    const featuredAd = featuredAdsContainer.querySelector(`[data-ad-id="${productId}"]`);
                    if (featuredAd) {
                        const adData = JSON.parse(featuredAd.getAttribute('data-ad-info') || '{}');
                        if (adData.id) {
                            product = adData;
                        }
                    }
                }
            }
            
            if (!product) {
                return;
            }
            
            // استخدام نفس منطق toggleFavorite
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            const existingIndex = favorites.findIndex(item => item.id === productId);
            
            if (existingIndex > -1) {
                favorites.splice(existingIndex, 1);
                showNotification('تم إزالة المنتج من المفضلة', 'info');
            } else {
                const productData = {
                    id: productId,
                    title: product.name || product.title || product.description || 'منتج',
                    imageUrl: product.image_urls && product.image_urls.length > 0 ? product.image_urls[0] : (product.image_url || ''),
                    price: product.price || 0,
                    governorate: product.governorate || '',
                    cities: product.cities || '',
                    subcategories: product.subcategory || product.subcategories || '',
                    category: 'other', // إضافة التصنيف الرئيسي
                    addedAt: new Date().toISOString()
                };
                favorites.push(productData);
                showNotification('تم إضافة المنتج إلى المفضلة', 'success');
            }
            
            localStorage.setItem('favorites', JSON.stringify(favorites));
            updateFavoriteIcon(productId);
            updateFeaturedAdFavoriteIcon(productId);
            updateFavoritesCountBadge();
            
            // تحديث زر المفضلة في النافذة المنبثقة
            const favoriteBtn = document.querySelector('.product-details-modal button:first-of-type');
            if (favoriteBtn) {
                favoriteBtn.textContent = isFavorite(productId) ? 'إزالة من المفضلة' : 'إضافة إلى المفضلة';
            }
        }

        // Mobile menu functionality
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        
        if (mobileMenuBtn && mobileMenu) {
            mobileMenuBtn.addEventListener('click', function() {
                mobileMenu.classList.toggle('hidden');
            });
        }
        
        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            if (mobileMenu && !mobileMenu.contains(event.target) && !mobileMenuBtn.contains(event.target)) {
                mobileMenu.classList.add('hidden');
            }
        });
        
        

        // Show error message
        function showError(message) {
            alert(message);
        }








        // Remove specific governorate














        // ===== وظائف إدارة المفضلة =====
        
        // التحقق من وجود منتج في المفضلة
        function isFavorite(productId) {
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            return favorites.some(item => item.id === productId);
        }

        // تبديل حالة المفضلة (إضافة/إزالة)
        function toggleFavorite(event, productId, title, imageUrl, price, governorate, cities, subcategories) {
            event.stopPropagation(); // منع انتقال الحدث للعنصر الأب
            
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            const existingIndex = favorites.findIndex(item => item.id === productId);
            
            if (existingIndex > -1) {
                // إزالة من المفضلة
                favorites.splice(existingIndex, 1);
                showNotification('تم إزالة المنتج من المفضلة', 'info');
            } else {
                // إضافة إلى المفضلة
                const productData = {
                    id: productId,
                    title: title,
                    imageUrl: imageUrl,
                    price: price,
                    governorate: governorate,
                    cities: cities,
                    subcategories: subcategories,
                    category: 'other', // إضافة التصنيف الرئيسي
                    addedAt: new Date().toISOString()
                };
                favorites.push(productData);
                showNotification('تم إضافة المنتج إلى المفضلة', 'success');
            }
            
            // حفظ في Local Storage
            localStorage.setItem('favorites', JSON.stringify(favorites));
            
            // تحديث أيقونة القلب
            updateFavoriteIcon(productId);
            
            // تحديث أيقونة القلب في بطاقات المنتجات المميزة
            updateFeaturedAdFavoriteIcon(productId);
            
            // تحديث عداد المفضلة
            console.log('🔄 Calling updateFavoritesCountBadge from toggleFavorite');
            updateFavoritesCountBadge();
        }

        // تحديث أيقونة القلب
        function updateFavoriteIcon(productId) {
            const favoriteBtn = document.querySelector(`[data-product-id="${productId}"] .favorite-btn svg`);
            if (favoriteBtn) {
                if (isFavorite(productId)) {
                    favoriteBtn.classList.remove('text-gray-400');
                    favoriteBtn.classList.add('text-pink-500', 'fill-current');
                } else {
                    favoriteBtn.classList.remove('text-pink-500', 'fill-current');
                    favoriteBtn.classList.add('text-gray-400');
                }
            }
        }
        
        // تحديث أيقونة القلب في بطاقات المنتجات المميزة
        function updateFeaturedAdFavoriteIcon(adId) {
            const favoriteBtn = document.querySelector(`[data-ad-id="${adId}"] .favorite-btn svg`);
            if (favoriteBtn) {
                if (isFavorite(adId)) {
                    favoriteBtn.classList.remove('text-gray-400');
                    favoriteBtn.classList.add('text-pink-500', 'fill-current');
                } else {
                    favoriteBtn.classList.remove('text-pink-500', 'fill-current');
                    favoriteBtn.classList.add('text-gray-400');
                }
            }
        }

        // عرض إشعار
        function showNotification(message, type = 'info') {
            // إزالة الإشعارات السابقة
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }

            const notification = document.createElement('div');
            notification.className = `notification fixed top-4 left-4 z-50 px-4 py-2 rounded-lg shadow-lg text-white text-sm font-medium transform transition-all duration-300 translate-x-0`;
            
            // تحديد لون الإشعار حسب النوع
            if (type === 'success') {
                notification.style.backgroundColor = '#10b981'; // أخضر
            } else if (type === 'error') {
                notification.style.backgroundColor = '#ef4444'; // أحمر
            } else {
                notification.style.backgroundColor = '#3b82f6'; // أزرق
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);

            // إخفاء الإشعار بعد 3 ثوان
            setTimeout(() => {
                notification.style.transform = 'translateX(-100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // تحديث عداد المفضلة
        function updateFavoritesCountBadge() {
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            const count = favorites.length;
            
            // تحديث جميع العدادات
            const badges = [
                'favorites-count-badge',
                'favorites-count-badge-mobile',
                'favorites-count-badge-desktop'
            ];
            
            badges.forEach(badgeId => {
                const badge = document.getElementById(badgeId);
                if (badge) {
                    if (count > 0) {
                        badge.textContent = count;
                        badge.classList.remove('hidden');
                    } else {
                        badge.classList.add('hidden');
                    }
                }
            });
        }

        // تحديث جميع أيقونات المفضلة عند تحميل الصفحة
        function updateAllFavoriteIcons() {
            const productCards = document.querySelectorAll('.product-card');
            if (productCards.length > 0) {
                productCards.forEach(card => {
                    const productId = card.getAttribute('data-product-id');
                    if (productId) {
                        updateFavoriteIcon(productId);
                    }
                });
            } else {
                // إعادة المحاولة بعد نصف ثانية
                setTimeout(updateAllFavoriteIcons, 500);
            }
        }

        // مراقبة التغييرات في DOM للتأكد من تحميل المنتجات
        const observer = new MutationObserver(function(mutations) {
            mutations.forEach(function(mutation) {
                if (mutation.type === 'childList' && mutation.addedNodes.length > 0) {
                    // التحقق من إضافة بطاقات منتجات جديدة
                    const hasNewProducts = Array.from(mutation.addedNodes).some(node => 
                        node.nodeType === 1 && node.classList && node.classList.contains('product-card')
                    );
                    
                    if (hasNewProducts) {
                        setTimeout(updateAllFavoriteIcons, 100);
                    }
                }
            });
        });

        // تحميل وعرض الإعلانات المميزة في التصنيف
        async function loadCategoryFeaturedAds() {
            try {
                if (!window.advertisingService) {
                    setTimeout(loadCategoryFeaturedAds, 1000);
                    return;
                }

                const featuredAds = await window.advertisingService.getCategoryFeaturedProducts('other', 4);
                
                displayCategoryFeaturedAds(featuredAds);
                
                // تسجيل ظهور الإعلانات
                featuredAds.forEach(ad => {
                    if (ad.ad_id && window.advertisingService) {
                        window.advertisingService.recordImpression(ad.ad_id);
                    }
                });
                
            } catch (error) {
                showNoFeaturedAds();
            }
        }

        // عرض الإعلانات المميزة في التصنيف
        function displayCategoryFeaturedAds(ads) {
            const container = document.getElementById('featured-ads-container');
            const noAdsMessage = document.getElementById('no-featured-ads');
            
            if (!container) return;
            
            if (!ads || ads.length === 0) {
                showNoFeaturedAds();
                return;
            }
            
            // إخفاء رسالة عدم وجود إعلانات
            if (noAdsMessage) {
                noAdsMessage.classList.add('hidden');
            }
            
            const adsHTML = ads.map(ad => {
                const imgs = Array.isArray(ad.image_urls) && ad.image_urls.length>0 ? ad.image_urls : [ad.image_url || '../assets/images/decorations.jpg'];
                return `
                <div class="bg-white rounded-lg shadow-md overflow-hidden border-2 border-yellow-200 hover:border-yellow-400 transition-all duration-300 transform hover:scale-105 flex-shrink-0" style="width: 200px;" data-ad-id="${ad.id}" data-product-id="${ad.id}" data-ad-info='${JSON.stringify(ad)}'>
                    <div class="relative image-container" data-product-id="${ad.id}" tabindex="0">
                        ${imgs.map((u,i)=>`<img src="${u}" alt="${ad.title}" class="w-full h-40 object-cover slider-image ${i===0?'':'hidden'}" loading="${i===0?'eager':'lazy'}" onclick="viewProductDetails('${ad.id}')">`).join('')}
                        ${imgs.length>1?`
                            <button class="slider-btn slider-prev" aria-label="السابق">‹</button>
                            <button class="slider-btn slider-next" aria-label="التالي">›</button>
                        `:''}
                        <div class="slider-dots">${imgs.map((_,i)=>`<button class="slider-dot ${i===0?'active':''}" aria-label="الصورة ${i+1}" data-index="${i}"></button>`).join('')}</div>
                        <div class="absolute top-1 right-1 bg-yellow-500 text-white text-xs px-1.5 py-0.5 rounded-full font-bold">⭐ مميز</div>
                        <button onclick="toggleFavorite(event, '${ad.id}', '${ad.title}', '${ad.image_url || '../assets/images/decorations.jpg'}', ${ad.price || 0}, '${ad.governorate || ''}', '${ad.cities || ''}', '${ad.subcategories ? ad.subcategories.join(',') : ''}')" class="absolute top-1 left-1 bg-white rounded-full p-1.5 shadow-lg hover:shadow-xl transition-all duration-200 favorite-btn border-2 border-white"><svg class="w-4 h-4 ${isFavorite('${ad.id}') ? 'text-pink-500 fill-current' : 'text-gray-400'}" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></button>
                    </div>
                    <div class="p-3"><div class="flex items-center justify-between mb-2"><span class="text-sm font-bold text-yellow-600">${ad.price > 0 ? ad.price + ' ج.م' : 'السعر عند الطلب'}</span>${sanitizeDisplayData(ad.governorate) ? `<span class="text-xs text-gray-500">${sanitizeDisplayData(ad.governorate)}</span>` : ''}</div></div>
                </div>`;
            }).join('');
            
            container.innerHTML = adsHTML;
            initCardSliders();
        }

        // إظهار رسالة عدم وجود إعلانات مميزة
        function showNoFeaturedAds() {
            const container = document.getElementById('featured-ads-container');
            const noAdsMessage = document.getElementById('no-featured-ads');
            
            if (container) {
                container.innerHTML = '';
            }
            
            if (noAdsMessage) {
                noAdsMessage.classList.remove('hidden');
            }
        }
        
        // تغيير الصورة الرئيسية في النافذة المنبثقة
        function changeModalMainImage(imageUrl) {
            const mainImage = document.getElementById('modal-main-image');
            if (mainImage) {
                mainImage.src = imageUrl;
            }
        }

        // دالة فتح محادثة الواتساب مع رسالة تلقائية
        function openWhatsAppChat(productId, title, imageUrl, price, governorate, cities, subcategories, whatsappNumber) {
            // تنظيف رقم الهاتف من جميع الأحرف غير الرقمية
            let phoneNumber = whatsappNumber.replace(/[^0-9]/g, '');
            
            // إزالة الرمز الدولي إذا كان موجوداً في البداية
            if (phoneNumber.startsWith('20')) {
                phoneNumber = phoneNumber.substring(2);
            }
            
            // إضافة الرمز الدولي لمصر إذا لم يكن موجوداً
            if (!phoneNumber.startsWith('20') && !phoneNumber.startsWith('+20')) {
                phoneNumber = '20' + phoneNumber;
            }
            
            // إنشاء رسالة واتساب محسنة
            let message = ``;
            
            // إضافة السعر أولاً
            if (price && price > 0) {
                message += `💰 السعر: ${price} ج.م\n`;
            }
            
            // إضافة رابط الصورة ثانياً
            if (imageUrl && imageUrl !== '../assets/images/decorations.jpg') {
                message += `🖼️ رابط الصورة: ${imageUrl}\n`;
            }
            
            // إضافة رابط المنتج ثالثاً
            message += `🔗 رابط المنتج: ${window.location.origin}/pages/product-details.html?id=${productId}\n\n`;
            
            // إضافة التحية والاستفسار في النهاية
            message += `مرحباً، أريد الاستفسار عن هذا المنتج`;
            
            // إنشاء رابط الواتساب
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
            
            // التحقق من أن المستخدم على جهاز محمول
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isMobile) {
                // محاولة فتح تطبيق الواتساب مباشرة
                window.location.href = whatsappUrl;
            } else {
                // على الكمبيوتر، فتح في تبويب جديد
                window.open(whatsappUrl, '_blank');
            }
        }

        // إعداد فلتر التمرير
        function setupScrollingFilter() {
            const filterSection = document.querySelector('.filter-section');
            const originalPosition = filterSection.offsetTop;
            let filterHeight = filterSection.offsetHeight;
            
            window.addEventListener('scroll', function() {
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                
                if (scrollTop > originalPosition) {
                    filterSection.classList.add('scrolled');
                    // إضافة مساحة لتجنب القفز
                    document.body.style.paddingTop = filterHeight + 'px';
                } else {
                    filterSection.classList.remove('scrolled');
                    document.body.style.paddingTop = '0';
                }
            });
            
            // تحديث الارتفاع عند تغيير حجم النافذة
            window.addEventListener('resize', function() {
                filterHeight = filterSection.offsetHeight;
                if (filterSection.classList.contains('scrolled')) {
                    document.body.style.paddingTop = filterHeight + 'px';
                }
            });
        }

        // بدء المراقبة عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            // إعداد فلتر التمرير
            setupScrollingFilter();
            
            // تحميل الإعلانات المميزة في التصنيف
            loadCategoryFeaturedAds();
            
            // مراقبة المراقبة في حاوية المنتجات
            const productsContainer = document.getElementById('products-container');
            if (productsContainer) {
                observer.observe(productsContainer, {
                    childList: true,
                    subtree: true
                });
            }
            
            // محاولة تحديث أيقونات المفضلة بعد تحميل الصفحة
            setTimeout(updateAllFavoriteIcons, 500);
            
            // تحديث عداد المفضلة عند تحميل الصفحة
            updateFavoritesCountBadge();
            
            // مراقبة التغييرات في localStorage (المفضلة)
            window.addEventListener('storage', function(e) {
                if (e.key === 'favorites') {
                    updateFavoritesCountBadge();
                }
            });
            // تهيئة السلايدر بعد أول عرض
            setTimeout(initCardSliders, 300);
        });

        function initCardSliders() {
            document.querySelectorAll('#products-container .image-container, #featured-ads-container .image-container').forEach(container => {
                if (container.__sliderInit) return;
                attachSwipe(container);
                container.addEventListener('keydown', onSliderKeyDown);
                container.__sliderInit = true;
            });
        }

        function onSliderKeyDown(e) {
            if (e.key !== 'ArrowLeft' && e.key !== 'ArrowRight') return;
            const id = this.getAttribute('data-product-id');
            const curr = (window.sliderState && window.sliderState.get(id)) || 0;
            updateCardSlide(this, curr + (e.key === 'ArrowLeft' ? -1 : 1));
        }

        function attachSwipe(container) {
            let startX = 0; let deltaX = 0;
            container.addEventListener('touchstart', e => { startX = e.touches[0].clientX; deltaX = 0; }, { passive: true });
            container.addEventListener('touchmove', e => { deltaX = e.touches[0].clientX - startX; }, { passive: true });
            container.addEventListener('touchend', () => {
                if (Math.abs(deltaX) > 30) {
                    const id = container.getAttribute('data-product-id');
                    const curr = (window.sliderState && window.sliderState.get(id)) || 0;
                    updateCardSlide(container, curr + (deltaX > 0 ? -1 : 1));
                }
            });
        }

        window.sliderState = new Map();
        function updateCardSlide(container, newIndex) {
            const id = container.getAttribute('data-product-id');
            const imgs = container.querySelectorAll('.slider-image');
            if (!imgs.length) return;
            const total = imgs.length;
            const idx = ((newIndex % total) + total) % total;
            imgs.forEach((img, i) => { if (i === idx) { img.classList.remove('hidden'); } else { img.classList.add('hidden'); } });
            const dots = container.querySelectorAll('.slider-dot');
            dots.forEach((d, i) => d.classList.toggle('active', i === idx));
            window.sliderState.set(id, idx);
        }

        document.addEventListener('click', function(e) {
            const prev = e.target.closest('.slider-prev');
            if (prev) {
                const container = prev.closest('.image-container');
                const id = container.getAttribute('data-product-id');
                const curr = window.sliderState.get(id) || 0;
                updateCardSlide(container, curr - 1);
                return;
            }
            const next = e.target.closest('.slider-next');
            if (next) {
                const container = next.closest('.image-container');
                const id = container.getAttribute('data-product-id');
                const curr = window.sliderState.get(id) || 0;
                updateCardSlide(container, curr + 1);
                return;
            }
            const dot = e.target.closest('.slider-dot');
            if (dot) {
                const container = dot.closest('.image-container');
                const index = parseInt(dot.getAttribute('data-index')) || 0;
                updateCardSlide(container, index);
            }
        });

        // دوال الترقيم
        function displayPagination(totalProducts) {
            const totalPages = Math.ceil(totalProducts / productsPerPage);
            const paginationContainer = document.getElementById('pagination-container');
            console.log('displayPagination:', { totalProducts, totalPages, currentPage, productsPerPage });
            
            if (totalPages <= 1) {
                paginationContainer.classList.add('hidden');
                return;
            }
            
            paginationContainer.classList.remove('hidden');
            
            let paginationHTML = '<div class="flex items-center justify-center space-x-2 space-x-reverse">';
            
            // زر السابق
            if (currentPage > 1) {
                paginationHTML += `<a href="?page=${currentPage - 1}" class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 hover:text-gray-700">السابق</a>`;
            } else {
                paginationHTML += `<span class="px-3 py-2 text-sm font-medium text-gray-300 bg-gray-100 border border-gray-200 rounded-md cursor-not-allowed">السابق</span>`;
            }
            
            // أرقام الصفحات
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);
            
            if (endPage - startPage + 1 < maxVisiblePages) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }
            
            if (startPage > 1) {
                paginationHTML += `<a href="?page=1" class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 hover:text-gray-700">1</a>`;
                if (startPage > 2) {
                    paginationHTML += `<span class="px-3 py-2 text-sm font-medium text-gray-500">...</span>`;
                }
            }
            
            for (let i = startPage; i <= endPage; i++) {
                if (i === currentPage) {
                    paginationHTML += `<span class="px-3 py-2 text-sm font-medium text-white bg-pink-500 border border-pink-500 rounded-md">${i}</span>`;
                } else {
                    paginationHTML += `<a href="?page=${i}" class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 hover:text-gray-700">${i}</a>`;
                }
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    paginationHTML += `<span class="px-3 py-2 text-sm font-medium text-gray-500">...</span>`;
                }
                paginationHTML += `<a href="?page=${totalPages}" class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 hover:text-gray-700">${totalPages}</a>`;
            }
            
            // زر التالي
            if (currentPage < totalPages) {
                paginationHTML += `<a href="?page=${currentPage + 1}" class="px-3 py-2 text-sm font-medium text-gray-500 bg-white border border-gray-300 rounded-md hover:bg-gray-50 hover:text-gray-700">التالي</a>`;
            } else {
                paginationHTML += `<span class="px-3 py-2 text-sm font-medium text-gray-300 bg-gray-100 border border-gray-200 rounded-md cursor-not-allowed">التالي</span>`;
            }
            
            paginationHTML += '</div>';
            
            // معلومات الصفحة الحالية
            paginationHTML += `
                <div class="text-center mt-4 text-sm text-gray-600">
                    صفحة ${currentPage} من ${totalPages} • عرض ${Math.min((currentPage - 1) * productsPerPage + 1, totalProducts)} - ${Math.min(currentPage * productsPerPage, totalProducts)} من ${totalProducts} منتج
                </div>
            `;
            
            paginationContainer.innerHTML = paginationHTML;
        }

        function updateURL() {
            const url = new URL(window.location);
            if (currentPage > 1) {
                url.searchParams.set('page', currentPage);
            } else {
                url.searchParams.delete('page');
            }
            window.history.replaceState({}, '', url);
        }

        // التمرير لأعلى الصفحة - محسنة للأجهزة المحمولة
        function scrollToTop() {
            // التمرير الفوري أولاً
            window.scrollTo(0, 0);
            document.body.scrollTop = 0;
            document.documentElement.scrollTop = 0;
            
            // محاولة التمرير السلس للشاشات الكبيرة
            try {
                window.scrollTo({
                    top: 0,
                    left: 0,
                    behavior: 'smooth'
                });
            } catch (error) {
                // في حالة عدم دعم التمرير السلس، استخدم التمرير العادي
                window.scrollTo(0, 0);
            }
            
            // فحص إضافي مع تأخير للتأكد من النجاح
            setTimeout(() => {
                // التأكد من الوصول لأعلى الصفحة
                if (window.pageYOffset > 0 || document.documentElement.scrollTop > 0 || document.body.scrollTop > 0) {
                    // إجبار التمرير إذا لم ينجح
                    window.scrollTo(0, 0);
                    document.body.scrollTop = 0;
                    document.documentElement.scrollTop = 0;
                    
                    // محاولة أخرى بطريقة مختلفة
                    try {
                        document.querySelector('body').scrollIntoView({ 
                            behavior: 'auto', 
                            block: 'start' 
                        });
                    } catch (e) {
                        // محاولة أخيرة
                        window.location.hash = '';
                        window.scrollTo(0, 0);
                    }
                }
            }, 100);
            
            // فحص نهائي بعد فترة أطول للأجهزة البطيئة
            setTimeout(() => {
                if (window.pageYOffset > 50) {
                    window.scrollTo(0, 0);
                    document.documentElement.scrollTop = 0;
                    document.body.scrollTop = 0;
                }
            }, 300);
        }

        function goToPage(pageNumber) {
            console.log('goToPage called with:', pageNumber);
            currentPage = pageNumber;
            updateURL();
            // تأخير صغير للتأكد من تحديث DOM قبل التمرير
            setTimeout(() => {
                scrollToTop();
            }, 50);
            applyFilters(false);
        }

        // مستمع النقر على الترقيم
        document.addEventListener('click', function(event) {
            if (event.target.matches('#pagination-container a[href*="page="]')) {
                event.preventDefault();
                const href = event.target.getAttribute('href');
                const pageMatch = href.match(/page=(\d+)/);
                if (pageMatch) {
                    const pageNumber = parseInt(pageMatch[1]);
                    console.log('Clicking on page:', pageNumber);
                    goToPage(pageNumber);
                }
            }
        });

        // مستمع تغيير التاريخ
        window.addEventListener('popstate', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const newPage = parseInt(urlParams.get('page')) || 1;
            if (newPage !== currentPage) {
                currentPage = newPage;
                applyFilters(false);
            }
        });
    </script>
    
    <!-- ملف التمرير السلس -->
    <script src="../js/scroll-optimization.js?v=2025-08-22-1" defer></script>
    <script src="../js/smooth-scroll.js" defer></script>
        
        <script>
        // تحسين تجربة التمرير
        document.addEventListener('DOMContentLoaded', function() {
            // إزالة CSS المتضارب
            const conflictingStyles = document.querySelectorAll('style');
            conflictingStyles.forEach(style => {
                if (style.textContent.includes('scroll-behavior: smooth')) {
                    style.textContent = style.textContent.replace(/scroll-behavior:\s*smooth/g, 'scroll-behavior: auto');
                }
            });
            
            // تطبيق CSS محسن للتمرير
            const scrollStyle = document.createElement('style');
            scrollStyle.textContent = `
                html, body {
                    scroll-behavior: auto !important;
                    -webkit-overflow-scrolling: touch !important;
                    overflow-x: hidden !important;
                }
                
                #featured-ads-container {
                    scroll-behavior: auto !important;
                    scroll-snap-type: none !important;
                }
                
                #featured-ads-container > div {
                    scroll-snap-align: none !important;
                }
            `;
            document.head.appendChild(scrollStyle);
        });
        </script>
        
        <!-- Floating Add Product Button -->
        <div class="fixed bottom-6 left-1/2 transform -translate-x-1/2 z-50">
            <a href="add-product-request.html" class="inline-flex items-center justify-center text-white px-6 py-4 rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 font-semibold text-lg" style="background: #845FCE;">
                <svg class="w-6 h-6 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
                أضف منتجك
            </a>
        </div>
</body>
</html> 