<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مرايا | Zeina Events</title>
    <meta name="description" content="مرايا مزخرفة وأنيقة للمناسبات والديكورات مع صور وتفاصيل.">
    <meta name="title" content="مرايا | Zeina Events">
    <link rel="canonical" href="https://zeinaevents.com/pages/category-mirr.html">
    <link rel="icon" type="image/png" href="../assets/images/zeina.jpeg">
    
    <!-- Schema.org markup for Google -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "CollectionPage",
      "name": "مرايا",
      "description": "مرايا مزخرفة وأنيقة للمناسبات والديكورات مع صور وتفاصيل.",
      "url": "https://zeinaevents.com/pages/category-mirr.html",
      "mainEntity": {
        "@type": "ItemList",
        "name": "مرايا",
        "description": "مجموعة متنوعة من المرايا المزخرفة للمناسبات"
      },
      "publisher": {
        "@type": "Organization",
        "name": "Zeina Events",
        "url": "https://zeinaevents.com"
      }
    }
    </script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" as="script">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../js/supabase-config.js?v=2025-08-22-1"></script>
    <script src="../js/product-service.js?v=2025-08-22-1"></script>
    <script src="../js/auth-service.js?v=2025-08-22-1"></script>
    <script src="../js/advertising-service.js?v=2025-08-22-1"></script>
    <script src="../js/common-utils.js?v=2025-08-22-1"></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-1994970196400389"
     crossorigin="anonymous"></script>

    <style>
        :root {
            --primary-pink: #f8d7e4;
            --primary-green: #d8e9d6;
            --primary-beige: #f5f0e6;
            --gold: #d4af37;
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f9f9f9;
            font-size: 14px;
        }
        
        @media (min-width: 640px) {
            body {
                font-size: 16px;
            }
        }
        
        .product-card {
            transition: all 0.3s ease;
            box-shadow: 0 2px 15px rgba(0,0,0,0.05);
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
.product-card img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
    image-rendering: -webkit-optimize-contrast;
    image-rendering: crisp-edges;
    backface-visibility: hidden;
    -webkit-backface-visibility: hidden;
    transition: transform 0.3s ease;
    transform: scale(1.0);
    border-radius: 8px 8px 0 0;
}
        
        .product-card .image-container {
            position: relative;
            width: 100%;
            height: 384px; /* نفس ارتفاع صفحة التفاصيل */
            overflow: hidden;
            border-radius: 8px;
            background-color: #f8f9fa;
        }
        
        /* تحسينات للشاشات الصغيرة */
        @media (max-width: 640px) {
            .product-card .image-container {
                height: 280px; /* ارتفاع أطول للشاشات الصغيرة مع عمودين */
            }
            
            .product-card {
                font-size: 0.875rem; /* حجم خط أصغر للشاشات الصغيرة */
            }
            
            .product-card h3 {
                font-size: 1rem; /* حجم عنوان أصغر */
                line-height: 1.2;
            }
            
            .product-card .price {
                font-size: 0.9rem; /* حجم السعر أصغر */
            }
            
            .product-card .location {
                font-size: 0.8rem; /* حجم الموقع أصغر */
            }
        }
        
        @media (min-width: 641px) and (max-width: 768px) {
            .product-card .image-container {
                height: 280px; /* ارتفاع للشاشات المتوسطة */
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            .product-card .image-container {
                height: 320px; /* ارتفاع للشاشات الكبيرة */
            }
        }
        
        /* الشاشات الكبيرة تحتفظ بالارتفاع الأصلي 384px */
        
        .product-card:hover img {
            transform: scale(1.05);
        }
        
        /* تحسينات شاملة للشاشات الصغيرة */
        @media (max-width: 480px) {
            .product-card .image-container {
                height: 280px; /* نفس الارتفاع المحدد أعلاه */
            }
            
            .product-card img {
                border-radius: 6px 6px 0 0;
            }
            
            .product-card {
                margin-bottom: 0.5rem;
            }
            
            .product-card .p-2 {
                padding: 0.5rem;
            }
            
            .product-card h3 {
                font-size: 0.875rem;
                line-height: 1.2;
            }
            
            .product-card p {
                font-size: 0.75rem;
                line-height: 1.3;
            }
            
            .category-badge {
                font-size: 0.625rem;
                padding: 0.125rem 0.5rem;
            }
            
            .gold-text {
                font-size: 0.875rem;
            }
        }
        
        /* تحسينات للشاشات المتوسطة الصغيرة */
        @media (max-width: 640px) {
            .product-card .image-container {
                height: 320px; /* نفس الارتفاع المحدد أعلاه */
            }
            
            .filter-section {
                padding: 0.5rem;
                margin-bottom: 0.75rem;
            }
            
            .filter-grid {
                gap: 0.5rem;
            }
            
            .btn-primary {
                padding: 0.375rem 0.75rem;
                font-size: 0.8rem;
            }
        }
        
        /* تحسين جودة الصور على الشاشات عالية الدقة */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .product-card img {
                image-rendering: -webkit-optimize-contrast;
                image-rendering: crisp-edges;
            }
        }
        
        .gold-border {
            border: 1px solid var(--gold);
        }
        
        .gold-text {
            color: var(--gold);
            font-weight: bold;
        }
        
        /* تحسين القائمة الرئيسية للهاتف المحمول */
        #mobile-menu {
            /* منع التمرير في الصفحة الرئيسية عند فتح القائمة */
            overscroll-behavior: contain;
            /* تحسين التمرير باللمس */
            -webkit-overflow-scrolling: touch;
            /* إخفاء شريط التمرير */
            scrollbar-width: none;
            -ms-overflow-style: none;
        }
        
        #mobile-menu::-webkit-scrollbar {
            display: none;
        }
        
        #mobile-menu > div {
            /* تحديد ارتفاع أقصى للقائمة */
            max-height: 80vh;
            /* تفعيل التمرير العمودي */
            overflow-y: auto;
            /* منع التمرير الأفقي */
            overflow-x: hidden;
        }
        
        /* تحسين التمرير على الأجهزة المحمولة */
        @media (max-width: 768px) {
            #mobile-menu > div {
                /* تحسين التمرير على الأجهزة المحمولة */
                -webkit-overflow-scrolling: touch;
                /* منع التمرير في الصفحة الرئيسية */
                overscroll-behavior: contain;
                /* تحسين الأداء */
                will-change: scroll-position;
            }
        }
        
        .category-badge {
            background: linear-gradient(135deg, var(--gold) 0%, #b8941f 100%);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.75rem;
        }
        
        @media (min-width: 640px) {
            .category-badge {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }
        }
        
        .filter-btn.active {
            background-color: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--gold) 0%, #b8941f 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 12px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.875rem;
        }
        
        @media (min-width: 640px) {
            .btn-primary {
                padding: 0.75rem 1.5rem;
                font-size: 1rem;
            }
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.3);
        }
        
        .btn-secondary {
            background: transparent;
            color: #666;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            border-color: #999;
            color: #333;
        }

        .filter-section {
            background: white;
            border-radius: 12px;
            padding: 0.75rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 50;
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.95);
        }
        
        @media (min-width: 640px) {
            .filter-section {
                padding: 1rem;
                margin-bottom: 1.5rem;
            }
        }
        
        @media (min-width: 768px) {
            .filter-section {
                padding: 1.5rem;
            }
        }

        .filter-title {
            font-size: 1rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        @media (min-width: 640px) {
            .filter-title {
                font-size: 1.1rem;
                margin-bottom: 1rem;
            }
        }

        .filter-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 0.75rem;
        }

        /* إخفاء شريط التمرير للإعلانات المميزة */
        .scrollbar-hide {
            -ms-overflow-style: none;  /* Internet Explorer 10+ */
            scrollbar-width: none;  /* Firefox */
        }
        .scrollbar-hide::-webkit-scrollbar {
            display: none;  /* Safari and Chrome */
        }

        /* تحسين عرض الإعلانات المميزة */
        #featured-ads-container {
            scroll-behavior: smooth;
            scroll-snap-type: x mandatory;
        }

        #featured-ads-container > div {
            transition: all 0.3s ease;
            scroll-snap-align: start;
        }

        #featured-ads-container > div:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }
        
        @media (min-width: 640px) {
            .filter-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
            }
        }

        .clear-filters-btn {
            background: #ef4444;
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 8px;
            font-size: 0.8rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        @media (min-width: 640px) {
            .clear-filters-btn {
                padding: 0.5rem 1rem;
                font-size: 0.875rem;
            }
        }

        .clear-filters-btn:hover {
            background: #dc2626;
            transform: translateY(-1px);
        }
        .close-filters-btn {
            background: #6b7280;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-size: 0.75rem;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .close-filters-btn:hover {
            background: #4b5563;
            transform: translateY(-1px);
        }

        .active-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.4rem;
            margin-top: 0.75rem;
        }
        
        @media (min-width: 640px) {
            .active-filters {
                gap: 0.5rem;
                margin-top: 1rem;
            }
        }

        .active-filter-tag {
            background: #3b82f6;
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 20px;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.4rem;
        }
        
        @media (min-width: 640px) {
            .active-filter-tag {
                padding: 0.25rem 0.75rem;
                font-size: 0.875rem;
                gap: 0.5rem;
            }
        }

        .remove-filter {
            background: rgba(255,255,255,0.2);
            border: none;
            color: white;
            border-radius: 50%;
            width: 1rem;
            height: 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.6rem;
        }
        
        @media (min-width: 640px) {
            .remove-filter {
                width: 1.25rem;
                height: 1.25rem;
                font-size: 0.75rem;
            }
        }

        /* Toggle button styles */
        .toggle-filters-btn {
            background: none;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            font-weight: 600;
            color: #374151;
            transition: all 0.3s ease;
            padding: 0.5rem;
            border-radius: 8px;
        }
        
        @media (min-width: 640px) {
            .toggle-filters-btn {
                font-size: 0.9rem;
            }
        }

        .toggle-filters-btn:hover {
            background-color: #f3f4f6;
            color: #1f2937;
        }

        .toggle-icon {
            transition: transform 0.3s ease;
        }

        .toggle-icon.rotated {
            transform: rotate(180deg);
        }

        /* Simple Filter Buttons Styles */
        .multi-filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .filter-btn {
            padding: 10px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            color: #374151;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            min-width: 120px;
            text-align: center;
        }

        .filter-btn:hover {
            border-color: #d4af37;
            background: #fefbf0;
            transform: translateY(-1px);
        }

        .filter-btn.active {
            background: #d4af37;
            border-color: #d4af37;
            color: white;
            box-shadow: 0 2px 8px rgba(212, 175, 55, 0.3);
        }

        .filter-btn.active:hover {
            background: #b8941f;
            border-color: #b8941f;
        }

        @media (max-width: 640px) {
            .filter-btn {
                min-width: 100px;
                padding: 8px 12px;
                font-size: 14px;
            }
        }

        /* Simple Governorate Filter Styles */
        .simple-governorate-filter {
            position: relative;
            width: 100%;
        }

        .filter-dropdown {
            position: relative;
        }

        .dropdown-btn {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            color: #374151;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .dropdown-btn:hover {
            border-color: #d4af37;
            background: #fefbf0;
        }

        .dropdown-arrow {
            width: 16px;
            height: 16px;
            transition: transform 0.3s ease;
        }

        .dropdown-btn.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        .dropdown-content {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
        }

        .governorate-options {
            padding: 8px;
        }

        .governorate-option {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 6px;
            transition: background-color 0.2s ease;
        }

        .governorate-option:hover {
            background-color: #f3f4f6;
        }

        .governorate-checkbox {
            margin-left: 8px;
            width: 16px;
            height: 16px;
            accent-color: #d4af37;
        }

        .dropdown-actions {
            display: flex;
            gap: 8px;
            padding: 8px;
            border-top: 1px solid #e5e7eb;
        }

        .action-btn {
            flex: 1;
            padding: 6px 12px;
            border: 1px solid #d4af37;
            border-radius: 6px;
            background: white;
            color: #d4af37;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: #d4af37;
            color: white;
        }

        .selected-governorates {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

        .selected-governorate-tag {
            background: #d4af37;
            color: white;
            padding: 4px 8px;
            border-radius: 16px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .remove-governorate {
            background: rgba(255,255,255,0.3);
            border: none;
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        /* Simple Cities Filter Styles */
        .simple-cities-filter {
            position: relative;
            width: 100%;
        }



        .cities-search-container {
            padding: 8px;
        }

        .cities-options {
            max-height: 200px;
            overflow-y: auto;
            padding: 8px;
        }

        .city-option {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 6px;
            transition: background-color 0.2s ease;
        }

        .city-option:hover {
            background-color: #f3f4f6;
        }

        .city-checkbox {
            margin-left: 8px;
            width: 16px;
            height: 16px;
            accent-color: #d4af37;
        }

        .selected-cities {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-top: 8px;
        }

        .selected-city-tag {
            background: #d4af37;
            color: white;
            padding: 4px 8px;
            border-radius: 16px;
            font-size: 12px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .remove-city {
            background: rgba(255,255,255,0.3);
            border: none;
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        /* Favorite Button Styles */
        .favorite-btn {
            background: white;
            border: none;
            border-radius: 50%;
            padding: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .favorite-btn:hover {
            background: #fef2f2;
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="bg-white shadow-sm border-b">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <!-- Logo -->
                <div class="flex items-center">
                    <a href="../index.html" class="text-xl sm:text-2xl font-bold gold-text">زِينَة</a>
                </div>
                
                <!-- Desktop Navigation -->
                <nav class="hidden lg:flex space-x-6 space-x-reverse">
                    <a href="../index.html" class="text-gray-600 hover:text-gray-900 transition-colors">الرئيسية</a>
                    <a href="category-koshat.html" class="text-gray-600 hover:text-gray-900 transition-colors">كوشات</a>
                    <a href="category-cake.html" class="text-gray-600 hover:text-gray-900 transition-colors">تورتات وأنواع الشوكولاتة</a>
                    <a href="category-mirr.html" class="text-gray-900 font-semibold">مرايا</a>
                    <a href="category-other.html" class="text-gray-600 hover:text-gray-900 transition-colors">ديكورات</a>
                    <a href="category-invitations.html" class="text-gray-600 hover:text-gray-900 transition-colors">دعوات وتوزيعات</a>
                    <a href="about-us.html" class="text-gray-600 hover:text-gray-900 transition-colors">من نحن</a>
                    <a href="contact-us.html" class="text-gray-600 hover:text-gray-900 transition-colors">اتصل بنا</a>
                </nav>
                
                <!-- Desktop Buttons -->
                <div class="hidden md:flex items-center space-x-4 space-x-reverse">
                    <a href="favorites.html" class="text-pink-500 hover:text-pink-600 transition-colors flex items-center space-x-2 space-x-reverse relative">
                        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                        </svg>
                        <span>المفضلة</span>
                        <span id="favorites-count-badge" class="absolute -top-2 -right-2 bg-yellow-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold hidden">0</span>
                    </a>

                                    <!-- Desktop Add Product Request Button -->
                <a href="add-product-request.html" class="text-white text-xs px-3 py-2 rounded-lg font-semibold transition-all duration-200" style="background-color: #845FCE;" transform hover:scale-105 transition-all duration-200" id="add-product-request-btn-desktop">
                        <span class="flex items-center space-x-1 space-x-reverse">
                            <span>➕</span>
                            <span>أضف منتجك</span>
                        </span>
                    </a>

                                    <!-- Desktop Advertise Button -->
                <a href="advertise-with-us.html" class="text-white text-xs px-3 py-2 rounded-lg font-semibold transition-all duration-200" style="background-color: #845FCE;" transform hover:scale-105 transition-all duration-200">
                    <span class="flex items-center space-x-1 space-x-reverse">
                        <span>⭐</span>
                        <span>أضف إعلانك</span>
                    </span>
                </a>


                </div>
                

                
                <!-- Mobile Menu Button -->
                <div class="lg:hidden flex items-center space-x-3 space-x-reverse">
                    <!-- Mobile Favorites Button -->
                    <a href="favorites.html" class="text-pink-500 hover:text-pink-600 transition-colors flex items-center space-x-2 space-x-reverse relative">
                        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                        </svg>
                        <span id="favorites-count-badge-mobile" class="absolute -top-2 -right-2 bg-yellow-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold hidden">0</span>
                    </a>
                    
                    <!-- زر أضف منتجك -->
                    <a href="add-product-request.html" class="text-white text-xs px-3 py-2 rounded-lg font-semibold transition-all duration-200" style="background-color: #845FCE;" transform hover:scale-105 transition-all duration-200 text-center">
                        <span class="flex items-center justify-center space-x-1 space-x-reverse">
                            <span>➕</span>
                            <span>أضف منتجك</span>
                        </span>
                    </a>
                    
                    <!-- Mobile Advertise Button -->
                    <a href="advertise-with-us.html" class="text-white text-xs px-2 py-2 rounded-lg font-semibold transition-all duration-200" style="background-color: #845FCE;" transform hover:scale-105 transition-all duration-200 text-center">
                        <span class="flex items-center justify-center space-x-1 space-x-reverse">
                            <span>⭐</span>
                            <span>أعلن معنا</span>
                        </span>
                    </a>
                    
                    <button id="mobile-menu-btn" class="p-2 rounded-lg hover:bg-gray-100 transition-colors">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Mobile Navigation Menu -->
            <div id="mobile-menu" class="lg:hidden hidden bg-white border-t border-gray-200">
                <div class="px-4 py-2 space-y-2 max-h-[80vh] overflow-y-auto scrollbar-hide" style="-webkit-overflow-scrolling: touch; overscroll-behavior: contain;">
                    
                    <!-- التصنيفات -->
                    <div class="border-b border-gray-200 pb-3">
                        <h3 class="text-sm font-semibold text-gray-700 mb-2">التصنيفات</h3>
                        <div class="space-y-2">
                            <a href="category-koshat.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">كوشات</a>
                            <a href="category-cake.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">تورتات وأنواع الشوكولاتة</a>
                            <a href="category-mirr.html" class="block py-2 px-3 text-gray-900 font-semibold bg-gray-50 rounded-lg">مرايا</a>
                            <a href="category-other.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">ديكورات متنوعة</a>
                            <a href="category-invitations.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">دعوات وتوزيعات</a>
                        </div>
                    </div>
                    
                    <!-- إضافة منتج -->
                    <div class="border-b border-gray-200 pb-3">
                        <h3 class="text-sm font-semibold text-gray-700 mb-2">إضافة منتج</h3>
                        <div class="space-y-2">
                            <a href="add-product-request.html" class="block py-2 px-3 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-all duration-200 text-sm flex items-center">
                                <span class="mr-2">➕</span>
                                أضف منتجك
                            </a>
                        </div>
                    </div>
                    
                    <!-- روابط مهمة -->
                    <div class="border-b border-gray-200 pb-3">
                        <h3 class="text-sm font-semibold text-gray-700 mb-2">روابط مهمة</h3>
                        <div class="space-y-2">
                            <a href="about-us.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">من نحن</a>
                            <a href="contact-us.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">اتصل بنا</a>
                            <a href="../index.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">الرئيسية</a>
                            <a href="advertise-with-us.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm flex items-center">
                                <span class="mr-2">⭐</span>
                                أعلن معنا
                            </a>
                        </div>
                    </div>
                    
                    <!-- تواصل معنا -->
                    <div class="border-b border-gray-200 pb-3">
                        <h3 class="text-sm font-semibold text-gray-700 mb-2">تواصل معنا</h3>
                        
                        <!-- التواصل الاجتماعي -->
                        <div class="mb-3">
                            <h4 class="text-xs font-medium text-gray-500 mb-2">التواصل الاجتماعي</h4>
                            <div class="space-y-2">
                                <a href="https://www.facebook.com/share/1BCEhAV89y/?mibextid=wwXIfr" target="_blank" class="block py-2 px-3 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200 text-sm flex items-center">
                                    <span class="mr-2">📘</span>
                                    فيسبوك
                                </a>
                                <a href="https://www.instagram.com/zeina.eg_?igsh=MXg4bzNqd213Z3IyaQ==" target="_blank" class="block py-2 px-3 text-gray-600 hover:text-pink-600 hover:bg-pink-50 rounded-lg transition-all duration-200 text-sm flex items-center">
                                    <span class="mr-2">📷</span>
                                    إنستغرام
                                </a>
                                <a href="https://wa.me/201016436007" target="_blank" class="block py-2 px-3 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-all duration-200 text-sm flex items-center">
                                    <span class="mr-2">📱</span>
                                    واتساب
                                </a>
                            </div>
                        </div>
                        
                        <!-- التواصل المباشر -->
                        <div>
                            <h4 class="text-xs font-medium text-gray-500 mb-2">التواصل المباشر</h4>
                            <div class="space-y-2">
                                <a href="tel:+201016436007" class="block py-2 px-3 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200 text-sm flex items-center">
                                    <span class="mr-2">📞</span>
                                    اتصل بنا: 01016436007
                                </a>
                                <a href="contact-us.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm flex items-center">
                                    <span class="mr-2">📧</span>
                                    راسلنا
                                </a>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mobile Auth Buttons -->
                    <div class="auth-buttons-mobile border-t border-gray-200 pt-2 mt-2">
                        <!-- Auth buttons will be dynamically updated -->
                    </div>
                </div>
            </div>
        </div>
    </header>

            <!-- Main Content -->
        <main class="container mx-auto px-2 sm:px-3 md:px-4 py-4 sm:py-6 md:py-8">


        <!-- Advanced Filters -->
        <div class="filter-section">
            <div class="flex justify-between items-center mb-3 sm:mb-4">
                <button id="toggle-filters-btn" class="toggle-filters-btn">
                    <svg id="toggle-icon" class="toggle-icon h-4 w-4 sm:h-5 sm:w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                    </svg>
                    <span id="toggle-text" class="text-sm sm:text-base">فلاتر اختيار المنتج والمحافظة</span>
                </button>
                <div class="flex flex-col items-end gap-2">
                    <button id="clear-filters-btn" class="clear-filters-btn">مسح الفلاتر</button>
                    <button id="close-filters-btn" class="close-filters-btn hidden sm:hidden">إغلاق النافذة</button>
                </div>
            </div>

            <div id="filters-content" class="filter-grid hidden transition-all duration-300 ease-in-out">
                <!-- Simple Filter Buttons -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">التصنيف الفرعي</label>
                    <div class="multi-filter-buttons flex flex-wrap gap-2">
                        <button class="filter-btn active" data-category="all">الكل</button>
                        <button class="filter-btn" data-category="mirr-wedding">مرايا زفاف</button>
                        <button class="filter-btn" data-category="mirr-engagement">مرايا خطوبة</button>
                        <button class="filter-btn" data-category="mirr-decorative">مرايا ديكور</button>
                    </div>
                </div>

                <!-- Simple Governorate Filter -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">المحافظة</label>
                    <div class="simple-governorate-filter">
                        <div class="filter-dropdown">
                            <button id="governorate-dropdown-btn" class="dropdown-btn">
                                <span id="governorate-placeholder">اختر المحافظات</span>
                                <svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6,9 12,15 18,9"></polyline>
                                </svg>
                            </button>
                            <div id="governorate-dropdown-content" class="dropdown-content hidden">
                                <div class="governorate-options">
                                    <label class="governorate-option">
                                        <input type="checkbox" value="القاهرة" class="governorate-checkbox">
                                        <span>القاهرة</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="الجيزة" class="governorate-checkbox">
                                        <span>الجيزة</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="الإسكندرية" class="governorate-checkbox">
                                        <span>الإسكندرية</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="الشرقية" class="governorate-checkbox">
                                        <span>الشرقية</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="الغربية" class="governorate-checkbox">
                                        <span>الغربية</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="المنوفية" class="governorate-checkbox">
                                        <span>المنوفية</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="القليوبية" class="governorate-checkbox">
                                        <span>القليوبية</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="البحيرة" class="governorate-checkbox">
                                        <span>البحيرة</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="كفر الشيخ" class="governorate-checkbox">
                                        <span>كفر الشيخ</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="دمياط" class="governorate-checkbox">
                                        <span>دمياط</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="الدقهلية" class="governorate-checkbox">
                                        <span>الدقهلية</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="المنيا" class="governorate-checkbox">
                                        <span>المنيا</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="أسيوط" class="governorate-checkbox">
                                        <span>أسيوط</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="سوهاج" class="governorate-checkbox">
                                        <span>سوهاج</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="قنا" class="governorate-checkbox">
                                        <span>قنا</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="الأقصر" class="governorate-checkbox">
                                        <span>الأقصر</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="أسوان" class="governorate-checkbox">
                                        <span>أسوان</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="بني سويف" class="governorate-checkbox">
                                        <span>بني سويف</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="الفيوم" class="governorate-checkbox">
                                        <span>الفيوم</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="الوادي الجديد" class="governorate-checkbox">
                                        <span>الوادي الجديد</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="مطروح" class="governorate-checkbox">
                                        <span>مطروح</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="شمال سيناء" class="governorate-checkbox">
                                        <span>شمال سيناء</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="جنوب سيناء" class="governorate-checkbox">
                                        <span>جنوب سيناء</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="البحر الأحمر" class="governorate-checkbox">
                                        <span>البحر الأحمر</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="بورسعيد" class="governorate-checkbox">
                                        <span>بورسعيد</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="الإسماعيلية" class="governorate-checkbox">
                                        <span>الإسماعيلية</span>
                                    </label>
                                    <label class="governorate-option">
                                        <input type="checkbox" value="السويس" class="governorate-checkbox">
                                        <span>السويس</span>
                                    </label>
                                </div>
                                <div class="dropdown-actions">
                                    <button id="select-all-governorates" class="action-btn">تحديد الكل</button>
                                    <button id="clear-all-governorates" class="action-btn">إلغاء الكل</button>
                                </div>
                            </div>
                        </div>
                        <div id="selected-governorates" class="selected-governorates"></div>
                    </div>
                </div>

                <!-- Cities Filter -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">المدينة/المنطقة</label>
                    <div class="simple-cities-filter">
                        <div class="filter-dropdown">
                            <button id="cities-dropdown-btn" class="dropdown-btn">
                                <span id="cities-placeholder">اختر المدن/المناطق</span>
                                <svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6,9 12,15 18,9"></polyline>
                                </svg>
                            </button>
                            <div id="cities-dropdown-content" class="dropdown-content hidden">
                                <div class="cities-search-container mb-3">
                                    <input type="text" id="cities-search-input" placeholder="ابحث عن مدينة..." class="w-full p-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                                </div>
                                <div class="cities-options">
                                    <!-- Cities will be populated dynamically -->
                                </div>
                                <div class="dropdown-actions">
                                    <button id="select-all-cities" class="action-btn">تحديد الكل</button>
                                    <button id="clear-all-cities" class="action-btn">إلغاء الكل</button>
                                </div>
                            </div>
                        </div>
                        <div id="selected-cities" class="selected-cities"></div>
                    </div>
                </div>

                <!-- Price Filter -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">السعر</label>
                    <select id="price-filter" class="w-full p-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
                        <option value="">جميع الأسعار</option>
                        <option value="0-300">حتى 300 ج.م</option>
                        <option value="300-800">300 - 800 ج.م</option>
                        <option value="800-1500">800 - 1500 ج.م</option>
                        <option value="1500+">أكثر من 1500 ج.م</option>
                        <option value="negotiable">السعر عند الطلب</option>
                    </select>
                </div>
            </div>

            <!-- Active Filters Display -->
            <div id="active-filters" class="active-filters"></div>
        </div>

        <!-- Products Count -->
        <div class="mb-4 sm:mb-6">
            <span id="products-count" class="text-gray-600 font-medium text-sm sm:text-base">0 منتج</span>
        </div>

        <!-- قسم الإعلانات المميزة في التصنيف -->
        <div id="category-featured-ads" class="mb-8">
            <div class="bg-gradient-to-r from-yellow-50 to-orange-50 border border-yellow-200 rounded-xl p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg sm:text-xl font-bold text-yellow-800 flex items-center gap-1 sm:gap-2">
                        <span class="text-base sm:text-lg">⭐</span>
                        <span class="text-sm sm:text-base">منتجات مميزة في هذا التصنيف</span>
                    </h2>
                </div>
                
                <!-- عرض الإعلانات المميزة -->
                <div id="featured-ads-container" class="flex overflow-x-auto gap-4 pb-4 scrollbar-hide">
                    <!-- سيتم ملء هذا القسم بواسطة JavaScript -->
                </div>
                
                <!-- رسالة عدم وجود إعلانات -->
                <div id="no-featured-ads" class="text-center py-8 hidden">
                    <div class="text-yellow-400 text-4xl mb-3">⭐</div>
                    <h3 class="text-lg font-medium text-yellow-700 mb-2">لا توجد منتجات مميزة حالياً</h3>
                    <p class="text-yellow-600 text-sm">كن أول من يضع منتجه في القسم المميز</p>
                </div>
            </div>
        </div>

        <!-- Products Grid -->
        <div id="products-container" class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 sm:gap-4 md:gap-6">
            <!-- Products will be loaded here -->
        </div>

        <!-- Loading State -->
        <div id="loading-state" class="text-center py-8 sm:py-12">
            <div class="inline-block animate-spin rounded-full h-6 w-6 sm:h-8 sm:w-8 border-b-2 border-gray-900"></div>
            <p class="mt-3 sm:mt-4 text-gray-600 text-sm sm:text-base">جاري تحميل المنتجات...</p>
        </div>

        <!-- Empty State -->
        <div id="empty-state" class="text-center py-8 sm:py-12 hidden">
            <svg class="mx-auto h-8 w-8 sm:h-12 sm:w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
            </svg>
            <h3 class="mt-2 text-sm font-medium text-gray-900">لا توجد منتجات</h3>
            <p class="mt-1 text-xs sm:text-sm text-gray-500">لم يتم العثور على منتجات في هذا التصنيف.</p>
        </div>
    </main>



    <script>
        let allProducts = [];
        let currentFilter = 'all';
        let governorateFilter;
        let subcategoryFilter;
        let activeFilters = {
            subcategory: [],
            governorate: [],
            cities: [],
            price: ''
        };

        // Load products on page load
        document.addEventListener('DOMContentLoaded', async function() {
            // Initialize simple filter buttons
            setupSimpleFilterButtons();
            
            // Initialize simple governorate filter
            setupSimpleGovernorateFilter();
            
            // Initialize simple cities filter
            setupSimpleCitiesFilter();
            
            await loadCategoryProducts();
            setupAdvancedFilters();
            setupToggleFilters();
            
            // تحديث عداد المفضلة عند تحميل الصفحة
            updateFavoritesCountBadge();
        });

        // Load products by category
        async function loadCategoryProducts() {
            try {
                console.log('🔄 بدء تحميل منتجات المرايا...');
                
                // Wait for ProductService to load
                if (!window.ProductService) {
                    console.log('⏳ Waiting for ProductService to load...');
                    await new Promise((resolve) => {
                        const checkInterval = setInterval(() => {
                            if (window.ProductService) {
                                clearInterval(checkInterval);
                                console.log('✅ ProductService loaded');
                                resolve();
                            }
                        }, 100);
                        
                        setTimeout(() => {
                            clearInterval(checkInterval);
                            console.log('❌ ProductService not loaded after 5 seconds');
                            resolve();
                        }, 5000);
                    });
                }
                
                if (!window.ProductService) {
                    throw new Error('ProductService not available');
                }
                
                console.log('✅ ProductService متاح، جاري جلب المنتجات...');
                
                const result = await window.ProductService.getProductsByCategory('mirr');
                
                console.log('📊 نتيجة جلب المنتجات:', result);
                
                if (result.success) {
                    allProducts = result.data;
                    console.log(`✅ تم جلب ${allProducts.length} منتج بنجاح`);

                    // طباعة تفاصيل المنتجات للتحقق من بنية البيانات
                    console.log('📋 تفاصيل المنتجات المجلبة:');
                    allProducts.forEach((product, index) => {
                        console.log(`  ${index + 1}. ID: ${product.id}, العنوان: ${product.title}`);
                        console.log(`     التصنيف الفرعي: ${product.subcategory} (النوع: ${typeof product.subcategory})`);
                        console.log(`     التصنيف الرئيسي: ${product.category}`);
                        console.log(`     المحافظة: ${product.governorate}`);
                        console.log(`     السعر: ${product.price}`);
                        console.log('     ---');
                    });

                    // ترتيب المنتجات حسب المعايير المطلوبة
                    sortProductsByCriteria();
                    applyFilters();
                } else {
                    console.error('❌ خطأ في جلب المنتجات:', result.error);
                    showError('حدث خطأ في تحميل المنتجات: ' + result.error);
                }
                
            } catch (error) {
                console.error('❌ خطأ في loadCategoryProducts:', error);
                showError('حدث خطأ في تحميل المنتجات');
            }
        }

        // ترتيب المنتجات حسب الأولوية: منتجات بسعر أولاً ثم بدون سعر
        function sortProductsByCriteria() {
            if (allProducts && allProducts.length > 0) {
                allProducts.sort((a, b) => {
                    const priceA = parseFloat(a.price);
                    const priceB = parseFloat(b.price);
                    const hasValidPriceA = !isNaN(priceA) && priceA > 0;
                    const hasValidPriceB = !isNaN(priceB) && priceB > 0;
                    
                    // إذا كان أحدهما له سعر والآخر لا، المنتج الذي له سعر يأتي أولاً
                    if (hasValidPriceA && !hasValidPriceB) {
                        return -1; // A يأتي قبل B
                    }
                    if (!hasValidPriceA && hasValidPriceB) {
                        return 1; // B يأتي قبل A
                    }
                    
                    // إذا كان كلاهما له سعر، ترتيب تصاعدي حسب السعر
                    if (hasValidPriceA && hasValidPriceB) {
                        return priceA - priceB;
                    }
                    
                    // إذا كان كلاهما بدون سعر، ترتيب حسب تاريخ الإنشاء
                    return new Date(b.created_at) - new Date(a.created_at);
                });
                
                console.log('✅ تم ترتيب المنتجات: منتجات بسعر أولاً (تصاعدياً) ثم منتجات بدون سعر');
            }
        }

        // Setup toggle filters functionality
        function setupToggleFilters() {
            const toggleBtn = document.getElementById('toggle-filters-btn');
            const filtersContent = document.getElementById('filters-content');
            const toggleIcon = document.getElementById('toggle-icon');
            const toggleText = document.getElementById('toggle-text');
            const closeFiltersBtn = document.getElementById('close-filters-btn');
            
            let filtersOpen = false;
            
            toggleBtn.addEventListener('click', function() {
                filtersOpen = !filtersOpen;
                
                if (filtersOpen) {
                    // Open filters
                    filtersContent.classList.remove('hidden');
                    toggleIcon.classList.add('rotated');
                    toggleText.textContent = 'إلغاء تحديد المنتج والمحافظة';
                    
                    // Show close button on small screens
                    if (window.innerWidth < 640) {
                        closeFiltersBtn.classList.remove('hidden');
                    }
                } else {
                    // Close filters
                    filtersContent.classList.add('hidden');
                    toggleIcon.classList.remove('rotated');
                    toggleText.textContent = 'فلاتر اختيار المنتج والمحافظة';
                    closeFiltersBtn.classList.add('hidden');
                }
            });
            
            // Close filters button functionality
            closeFiltersBtn.addEventListener('click', function() {
                filtersContent.classList.add('hidden');
                toggleIcon.classList.remove('rotated');
                toggleText.textContent = 'فلاتر اختيار المنتج والمحافظة';
                closeFiltersBtn.classList.add('hidden');
                filtersOpen = false;
            });
            
            // Handle resize events
            window.addEventListener('resize', function() {
                if (window.innerWidth >= 640) {
                    closeFiltersBtn.classList.add('hidden');
                } else if (filtersOpen) {
                    closeFiltersBtn.classList.remove('hidden');
                }
            });
        }

        // Setup simple filter buttons functionality
        function setupSimpleFilterButtons() {
            const filterButtons = document.querySelectorAll('.filter-btn');

            filterButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    console.log('🔘 تم النقر على فلتر:', category);
                    console.log('📊 الفلاتر النشطة قبل التعديل:', activeFilters.subcategory);

                    if (category === 'all') {
                        // Reset all buttons
                        filterButtons.forEach(btn => btn.classList.remove('active'));
                        this.classList.add('active');
                        activeFilters.subcategory = [];
                        console.log('🔄 تم إعادة تعيين جميع الفلاتر');
                    } else {
                        // Handle multiple selection
                        if (this.classList.contains('active')) {
                            this.classList.remove('active');
                            // Remove from active filters
                            const index = activeFilters.subcategory.indexOf(category);
                            if (index > -1) {
                                activeFilters.subcategory.splice(index, 1);
                                console.log('❌ تم إزالة التصنيف من الفلاتر النشطة:', category);
                            }
                        } else {
                            this.classList.add('active');
                            // Add to active filters
                            if (!activeFilters.subcategory.includes(category)) {
                                activeFilters.subcategory.push(category);
                                console.log('✅ تم إضافة التصنيف إلى الفلاتر النشطة:', category);
                            }
                        }

                        // If no subcategory is selected, show all
                        if (activeFilters.subcategory.length === 0) {
                            filterButtons.forEach(btn => {
                                if (btn.getAttribute('data-category') === 'all') {
                                    btn.classList.add('active');
                                } else {
                                    btn.classList.remove('active');
                                }
                            });
                            console.log('🔄 لا توجد تصنيفات نشطة، تفعيل زر "الكل"');
                        } else {
                            // Remove active from "all" button
                            const allButton = document.querySelector('[data-category="all"]');
                            if (allButton) {
                                allButton.classList.remove('active');
                                console.log('🔄 إلغاء تفعيل زر "الكل"');
                            }
                        }
                    }

                    console.log('📊 الفلاتر النشطة النهائية:', activeFilters.subcategory);
                    console.log('🔍 عدد المنتجات الكلي:', allProducts.length);

                    // Apply filters immediately
                    applyFilters();
                });
            });
        }

        // Setup simple governorate filter
        function setupSimpleGovernorateFilter() {
            const dropdownBtn = document.getElementById('governorate-dropdown-btn');
            const dropdownContent = document.getElementById('governorate-dropdown-content');
            const checkboxes = document.querySelectorAll('.governorate-checkbox');
            const selectAllBtn = document.getElementById('select-all-governorates');
            const clearAllBtn = document.getElementById('clear-all-governorates');
            const selectedContainer = document.getElementById('selected-governorates');

            // Toggle dropdown
            dropdownBtn.addEventListener('click', function() {
                dropdownContent.classList.toggle('hidden');
                dropdownBtn.classList.toggle('active');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function(event) {
                if (!dropdownBtn.contains(event.target) && !dropdownContent.contains(event.target)) {
                    dropdownContent.classList.add('hidden');
                    dropdownBtn.classList.remove('active');
                }
            });

            // Handle checkbox changes
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    updateSelectedGovernorates();
                    updatePlaceholder();
                    applyFilters();
                });
            });

            // Select all
            selectAllBtn.addEventListener('click', function() {
                checkboxes.forEach(checkbox => {
                    checkbox.checked = true;
                });
                updateSelectedGovernorates();
                updatePlaceholder();
                applyFilters();
            });

            // Clear all
            clearAllBtn.addEventListener('click', function() {
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
                updateSelectedGovernorates();
                updatePlaceholder();
                applyFilters();
            });

            function updateSelectedGovernorates() {
                const selected = [];
                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        selected.push(checkbox.value);
                    }
                });
                activeFilters.governorate = selected;
                displaySelectedGovernorates();
            }

            function updatePlaceholder() {
                const placeholder = document.getElementById('governorate-placeholder');
                if (activeFilters.governorate.length === 0) {
                    placeholder.textContent = 'اختر المحافظات';
                } else if (activeFilters.governorate.length === 1) {
                    placeholder.textContent = activeFilters.governorate[0];
                } else {
                    placeholder.textContent = `${activeFilters.governorate.length} محافظة مختارة`;
                }
            }

            function displaySelectedGovernorates() {
                if (activeFilters.governorate.length === 0) {
                    selectedContainer.innerHTML = '';
                    return;
                }

                selectedContainer.innerHTML = activeFilters.governorate.map(gov => `
                    <div class="selected-governorate-tag">
                        ${gov}
                        <button class="remove-governorate" onclick="removeGovernorate('${gov}')">×</button>
                    </div>
                `).join('');
            }
        }

        // Remove specific governorate
        function removeGovernorate(governorate) {
            const checkbox = document.querySelector(`.governorate-checkbox[value="${governorate}"]`);
            if (checkbox) {
                checkbox.checked = false;
                activeFilters.governorate = activeFilters.governorate.filter(g => g !== governorate);
                document.getElementById('governorate-placeholder').textContent = 
                    activeFilters.governorate.length === 0 ? 'اختر المحافظات' : 
                    activeFilters.governorate.length === 1 ? activeFilters.governorate[0] :
                    `${activeFilters.governorate.length} محافظة مختارة`;
                
                // Update selected display
                const selectedContainer = document.getElementById('selected-governorates');
                if (activeFilters.governorate.length === 0) {
                    selectedContainer.innerHTML = '';
                } else {
                    selectedContainer.innerHTML = activeFilters.governorate.map(gov => `
                        <div class="selected-governorate-tag">
                            ${gov}
                            <button class="remove-governorate" onclick="removeGovernorate('${gov}')">×</button>
                        </div>
                    `).join('');
                }
                
                applyFilters();
            }
        }



        // Setup advanced filters
        function setupAdvancedFilters() {
            // Price filter
            document.getElementById('price-filter').addEventListener('change', function() {
                activeFilters.price = this.value;
                applyFilters();
            });

            // Clear filters button
            document.getElementById('clear-filters-btn').addEventListener('click', function() {
                clearAllFilters();
            });
        }

        // Apply all filters
        function applyFilters() {
            let filteredProducts = allProducts;

            // Apply subcategory filter
            if (activeFilters.subcategory.length > 0) {
                console.log('🔍 تطبيق فلتر التصنيف الفرعي:', activeFilters.subcategory);

                filteredProducts = filteredProducts.filter(product => {
                    // خريطة تحويل النصوص العربية إلى أكواد
                    const arabicToCodeMap = {
                        'مرايا زفاف': 'mirr-wedding',
                        'مرايا خطوبة': 'mirr-engagement',
                        'مرايا ديكور': 'mirr-decorative',
                        'مرآة زفاف': 'mirr-wedding',
                        'مرآة خطوبة': 'mirr-engagement',
                        'مرآة ديكور': 'mirr-decorative',
                        // إضافة التنسيقات المباشرة من قاعدة البيانات
                        'mirror-wedding': 'mirr-wedding',
                        'mirror-engagement': 'mirr-engagement',
                        'mirror-decorative': 'mirr-decorative',
                        'mirror-custom': 'mirr-custom',
                        'mirror-classic': 'mirr-classic',
                        'mirror-modern': 'mirr-modern',
                        'mirror-luxury': 'mirr-luxury',
                        'mirr-wedding': 'mirr-wedding',
                        'mirr-engagement': 'mirr-engagement',
                        'mirr-decorative': 'mirr-decorative',
                        'mirr-custom': 'mirr-custom',
                        'mirr-classic': 'mirr-classic',
                        'mirr-modern': 'mirr-modern',
                        'mirr-luxury': 'mirr-luxury'
                    };

                    // خريطة تحويل الأكواد إلى نصوص عربية
                    const codeToArabicMap = {
                        'mirr-wedding': 'مرايا زفاف',
                        'mirr-engagement': 'مرايا خطوبة',
                        'mirr-decorative': 'مرايا ديكور',
                        'mirror-wedding': 'مرايا زفاف',
                        'mirror-engagement': 'مرايا خطوبة',
                        'mirror-decorative': 'مرايا ديكور'
                    };

                    // Handle different subcategory formats
                    let productSubcategories = [];
                    console.log('🔍 تحليل التصنيفات للمنتج:', product.id, product.title, 'subcategory:', product.subcategory, 'type:', typeof product.subcategory);

                    if (product.subcategory) {
                        if (Array.isArray(product.subcategory)) {
                            productSubcategories = product.subcategory;
                            console.log('  ✅ التصنيفات مصفوفة:', productSubcategories);
                        } else if (typeof product.subcategory === 'string') {
                            try {
                                const parsed = JSON.parse(product.subcategory);
                                if (Array.isArray(parsed)) {
                                    productSubcategories = parsed;
                                    console.log('  ✅ التصنيفات نص JSON تم تحليلها:', productSubcategories);
                                } else {
                                    productSubcategories = [product.subcategory];
                                    console.log('  ⚠️ JSON ليس مصفوفة، تحويل لمصفوفة:', productSubcategories);
                                }
                            } catch (error) {
                                // If it's not JSON, treat as single value
                                productSubcategories = [product.subcategory];
                                console.log('  ⚠️ خطأ في تحليل JSON، تحويل لمصفوفة:', productSubcategories);
                            }
                        } else {
                            console.log('  ❌ نوع البيانات غير مدعوم:', typeof product.subcategory);
                        }
                    } else {
                        console.log('  ❌ لا توجد تصنيفات فرعية للمنتج');
                        // محاولة استخراج من الاسم أو الوصف
                        if (product.title) {
                            const title = product.title.toLowerCase();
                            if (title.includes('زفاف') || title.includes('عرس') || title.includes('wedding')) {
                                productSubcategories = ['mirr-wedding'];
                            } else if (title.includes('خطوبة') || title.includes('engagement')) {
                                productSubcategories = ['mirr-engagement'];
                            } else if (title.includes('ديكور') || title.includes('decorative')) {
                                productSubcategories = ['mirr-decorative'];
                            }
                            console.log('  🔄 تصنيفات مستخرجة من العنوان:', productSubcategories);
                        }
                    }

                    // Check if any of the selected subcategories match the product's subcategories
                    const matches = activeFilters.subcategory.some(selectedCode => {
                        console.log('  🔍 فحص التطابق مع:', selectedCode);

                        // Check direct match with code
                        if (productSubcategories.includes(selectedCode)) {
                            console.log('    ✅ تطابق مباشر مع الكود:', selectedCode);
                            return true;
                        }

                        // Check match with Arabic text
                        const selectedArabic = codeToArabicMap[selectedCode];
                        if (selectedArabic && productSubcategories.includes(selectedArabic)) {
                            console.log('    ✅ تطابق مع النص العربي:', selectedArabic);
                            return true;
                        }

                        // Check if product has text that matches the selected code
                        const productCodeMatch = productSubcategories.some(productSub => {
                            // التحقق من التطابق المباشر
                            if (productSub === selectedCode) {
                                console.log('    ✅ تطابق مباشر:', productSub);
                                return true;
                            }

                            // التحقق من التطابق عبر الخريطة
                            const productCode = arabicToCodeMap[productSub];
                            if (productCode === selectedCode) {
                                console.log('    ✅ تطابق عبر الخريطة:', productSub, '->', productCode);
                                return true;
                            }

                            // التحقق من التطابق العكسي (من كود إلى كود آخر)
                            const reverseCode = arabicToCodeMap[selectedCode];
                            if (productSub === reverseCode) {
                                console.log('    ✅ تطابق عكسي:', productSub, '<-', selectedCode);
                                return true;
                            }

                            return false;
                        });

                        if (productCodeMatch) {
                            return true;
                        }

                        console.log('    ❌ لا يوجد تطابق مع:', selectedCode);
                        return false;
                    });

                    console.log('  🎯 النتيجة النهائية للمنتج:', product.id, matches ? '✅ يطابق' : '❌ لا يطابق');
                    if (matches) {
                        console.log('  🎉 المنتج سيظهر في النتائج!');
                    }
                    return matches;
                });

                console.log('📊 عدد المنتجات بعد تطبيق فلتر التصنيف:', filteredProducts.length);
            }

            // Apply governorate filter
            if (activeFilters.governorate.length > 0) {
                filteredProducts = filteredProducts.filter(product => {
                    if (product.governorate) {
                        const productGovernorates = product.governorate.split(',').map(g => g.trim());
                        return activeFilters.governorate.some(selected => 
                            productGovernorates.some(productGov => 
                                productGov.includes(selected)
                            )
                        );
                    }
                    return false;
                });
            }

            // Apply price filter
            if (activeFilters.price) {
                filteredProducts = filteredProducts.filter(product => {
                    const price = parseFloat(product.price) || 0;
                    
                    switch (activeFilters.price) {
                        case '0-300':
                            return price > 0 && price <= 300;
                        case '300-800':
                            return price > 300 && price <= 800;
                        case '800-1500':
                            return price > 800 && price <= 1500;
                        case '1500+':
                            return price > 1500;
                        case 'negotiable':
                            return price === 0 || !product.price;
                        default:
                            return true;
                    }
                });
            }

            // Apply cities filter
            if (activeFilters.cities.length > 0) {
                filteredProducts = filteredProducts.filter(product => {
                    if (product.cities) {
                        const productCities = product.cities.split(',').map(c => c.trim());
                        return activeFilters.cities.some(selected => 
                            productCities.some(productCity => 
                                productCity.includes(selected)
                            )
                        );
                    }
                    return false;
                });
            }



            displayProducts(filteredProducts);
            updateActiveFiltersDisplay();
        }

        // Clear all filters
        function clearAllFilters() {
            // Reset simple filter buttons
            const filterButtons = document.querySelectorAll('.filter-btn');
            filterButtons.forEach(btn => btn.classList.remove('active'));
            
            // Activate "all" button
            const allButton = document.querySelector('[data-category="all"]');
            if (allButton) {
                allButton.classList.add('active');
            }
            
            // Reset price filter
            document.getElementById('price-filter').value = '';
            
            // Reset governorate filter
            const checkboxes = document.querySelectorAll('.governorate-checkbox');
            checkboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // Reset active filters object
            activeFilters = {
                subcategory: [],
                governorate: [],
                cities: [],
                price: ''
            };

            // Update governorate display
            document.getElementById('governorate-placeholder').textContent = 'اختر المحافظات';
            document.getElementById('selected-governorates').innerHTML = '';

            // Reset cities filter
            const cityCheckboxes = document.querySelectorAll('.city-checkbox');
            cityCheckboxes.forEach(checkbox => {
                checkbox.checked = false;
            });
            document.getElementById('cities-placeholder').textContent = 'اختر المدن/المناطق';
            document.getElementById('selected-cities').innerHTML = '';

            // Hide close filters button
            const closeFiltersBtn = document.getElementById('close-filters-btn');
            closeFiltersBtn.classList.add('hidden');

            // Apply filters
            applyFilters();
        }

        // Update active filters display
        function updateActiveFiltersDisplay() {
            const activeFiltersContainer = document.getElementById('active-filters');
            const filters = [];

            // Add subcategory filter
            activeFilters.subcategory.forEach(sub => {
                const subcategoryLabels = {
                    'mirr-wedding': 'مرايا زفاف',
                    'mirr-engagement': 'مرايا خطوبة',
                    'mirr-decorative': 'مرايا ديكور',
                    'mirror-wedding': 'مرآة زفاف',
                    'mirror-engagement': 'مرآة خطوبة',
                    'mirror-decorative': 'مرآة ديكور',
                    'mirror-custom': 'مرآة مخصصة',
                    'mirror-classic': 'مرآة كلاسيكية',
                    'mirror-modern': 'مرآة عصرية',
                    'mirror-luxury': 'مرآة فاخرة'
                };
                filters.push({
                    type: 'subcategory',
                    text: subcategoryLabels[sub] || sub,
                    value: sub
                });
            });

            // Add governorate filters
            activeFilters.governorate.forEach(gov => {
                filters.push({
                    type: 'governorate',
                    text: gov,
                    value: gov
                });
            });

            // Add cities filters
            activeFilters.cities.forEach(city => {
                filters.push({
                    type: 'city',
                    text: city,
                    value: city
                });
            });

            // Add price filter
            if (activeFilters.price) {
                const priceText = document.getElementById('price-filter').options[
                    document.getElementById('price-filter').selectedIndex
                ].text;
                filters.push({
                    type: 'price',
                    text: priceText,
                    value: activeFilters.price
                });
            }

            // Display active filters
            if (filters.length > 0) {
                activeFiltersContainer.innerHTML = filters.map(filter => `
                    <div class="active-filter-tag">
                        ${filter.text}
                        <button class="remove-filter" onclick="removeFilter('${filter.type}', '${filter.value}')">
                            ×
                        </button>
                    </div>
                `).join('');
                activeFiltersContainer.style.display = 'flex';
            } else {
                activeFiltersContainer.style.display = 'none';
            }
        }

        // Remove specific filter
        function removeFilter(type, value) {
            switch (type) {
                case 'subcategory':
                    activeFilters.subcategory = activeFilters.subcategory.filter(s => s !== value);
                    // Update button states
                    const filterButtons = document.querySelectorAll('.filter-btn');
                    filterButtons.forEach(btn => {
                        const category = btn.getAttribute('data-category');
                        if (category === value) {
                            btn.classList.remove('active');
                        }
                    });
                    
                    // If no subcategory is selected, activate "all" button
                    if (activeFilters.subcategory.length === 0) {
                        const allButton = document.querySelector('[data-category="all"]');
                        if (allButton) {
                            allButton.classList.add('active');
                        }
                    }
                    break;
                            case 'governorate':
                removeGovernorate(value);
                return; // removeGovernorate already calls applyFilters
            case 'city':
                removeCity(value);
                return; // removeCity already calls applyFilters
                    break;
                case 'price':
                    document.getElementById('price-filter').value = '';
                    activeFilters.price = '';
                    break;
            }
            applyFilters();
        }

        // Display products
        function displayProducts(products) {
            const container = document.getElementById('products-container');
            const loadingState = document.getElementById('loading-state');
            const emptyState = document.getElementById('empty-state');
            const productsCount = document.getElementById('products-count');
            
            // Hide loading state
            loadingState.classList.add('hidden');
            
            // Update products count
            productsCount.textContent = `${products.length} منتج`;
            
            if (!products || products.length === 0) {
                container.innerHTML = '';
                emptyState.classList.remove('hidden');
                return;
            }
            
            emptyState.classList.add('hidden');
            
            container.innerHTML = products.map(product => {
                const imageUrl = product.image_urls && product.image_urls.length > 0 
                    ? product.image_urls[0] 
                    : 'https://placehold.co/400x300/EEE/31343C?text=لا+توجد+صورة';
                
                // Get subcategory display name
                let subcategoryName = '';
                let subcategoryColor = 'bg-blue-500';
                
                // Debug: Log the actual subcategory data
                console.log('🔍 Product subcategory data:', {
                    productId: product.id,
                    title: product.title,
                    subcategory: product.subcategory,
                    subcategoryType: typeof product.subcategory,
                    isArray: Array.isArray(product.subcategory),
                    length: product.subcategory ? product.subcategory.length : 'N/A'
                });
                
                let subcategoryNames = [];
                let subcategoryColors = [];
                
                if (product.subcategory && Array.isArray(product.subcategory) && product.subcategory.length > 0) {
                    const subcategoryMap = {
                        'mirr-wedding': { name: 'مرآة زفاف', color: 'bg-pink-500' },
                        'mirr-engagement': { name: 'مرآة خطوبة', color: 'bg-purple-500' },
                        'mirr-birthday': { name: 'مرآة عيد ميلاد', color: 'bg-green-500' },
                        'mirr-decorative': { name: 'مرآة ديكور', color: 'bg-green-500' },
                        'mirr-custom': { name: 'مرآة مخصصة', color: 'bg-indigo-500' },
                        'mirr-classic': { name: 'مرآة كلاسيكية', color: 'bg-yellow-500' },
                        'mirr-modern': { name: 'مرآة عصرية', color: 'bg-blue-500' },
                        'mirr-luxury': { name: 'مرآة فاخرة', color: 'bg-red-500' },
                        
                        // إضافة المفاتيح البديلة
                        'mirror-wedding': { name: 'مرآة زفاف', color: 'bg-pink-500' },
                        'mirror-engagement': { name: 'مرآة خطوبة', color: 'bg-purple-500' },
                        'mirror-birthday': { name: 'مرآة عيد ميلاد', color: 'bg-green-500' },
                        'mirror-decorative': { name: 'مرآة ديكور', color: 'bg-green-500' },
                        'mirror-custom': { name: 'مرآة مخصصة', color: 'bg-indigo-500' },
                        'mirror-classic': { name: 'مرآة كلاسيكية', color: 'bg-yellow-500' },
                        'mirror-modern': { name: 'مرآة عصرية', color: 'bg-blue-500' },
                        'mirror-luxury': { name: 'مرآة فاخرة', color: 'bg-red-500' }
                    };
                    
                    // معالجة جميع التصنيفات الفرعية
                    product.subcategory.forEach(subcat => {
                        const subcategoryInfo = subcategoryMap[subcat];
                        if (subcategoryInfo) {
                            subcategoryNames.push(subcategoryInfo.name);
                            subcategoryColors.push(subcategoryInfo.color);
                        }
                    });
                    
                    console.log('🔍 All subcategories:', subcategoryNames);
                } else if (product.subcategory && typeof product.subcategory === 'string') {
                    // Handle case where subcategory is a JSON string
                    console.log('🔍 Subcategory is a string:', product.subcategory);
                    try {
                        const subcategoryArray = JSON.parse(product.subcategory);
                        console.log('🔍 Parsed subcategory array:', subcategoryArray);
                        
                        if (Array.isArray(subcategoryArray) && subcategoryArray.length > 0) {
                            const subcategoryMap = {
                                'mirr-wedding': { name: 'مرآة زفاف', color: 'bg-pink-500' },
                                'mirr-engagement': { name: 'مرآة خطوبة', color: 'bg-purple-500' },
                                'mirr-birthday': { name: 'مرآة عيد ميلاد', color: 'bg-green-500' },
                                'mirr-decorative': { name: 'مرآة ديكور', color: 'bg-green-500' },
                                'mirr-custom': { name: 'مرآة مخصصة', color: 'bg-indigo-500' },
                                'mirr-classic': { name: 'مرآة كلاسيكية', color: 'bg-yellow-500' },
                                'mirr-modern': { name: 'مرآة عصرية', color: 'bg-blue-500' },
                                'mirr-luxury': { name: 'مرآة فاخرة', color: 'bg-red-500' },
                                
                                // إضافة المفاتيح البديلة
                                'mirror-wedding': { name: 'مرآة زفاف', color: 'bg-pink-500' },
                                'mirror-engagement': { name: 'مرآة خطوبة', color: 'bg-purple-500' },
                                'mirror-birthday': { name: 'مرآة عيد ميلاد', color: 'bg-green-500' },
                                'mirror-decorative': { name: 'مرآة ديكور', color: 'bg-green-500' },
                                'mirror-custom': { name: 'مرآة مخصصة', color: 'bg-indigo-500' },
                                'mirror-classic': { name: 'مرآة كلاسيكية', color: 'bg-yellow-500' },
                                'mirror-modern': { name: 'مرآة عصرية', color: 'bg-blue-500' },
                                'mirror-luxury': { name: 'مرآة فاخرة', color: 'bg-red-500' }
                            };
                            
                            // معالجة جميع التصنيفات الفرعية
                            subcategoryArray.forEach(subcat => {
                                const subcategoryInfo = subcategoryMap[subcat];
                                if (subcategoryInfo) {
                                    subcategoryNames.push(subcategoryInfo.name);
                                    subcategoryColors.push(subcategoryInfo.color);
                                }
                            });
                            
                            console.log('🔍 All subcategories from parsed array:', subcategoryNames);
                        }
                    } catch (error) {
                        console.error('🔍 Error parsing subcategory JSON:', error);
                    }
                }
                
                // إذا لم توجد تصنيفات فرعية، استخدم قيم افتراضية
                if (subcategoryNames.length === 0) {
                                    // محاولة استخراج التصنيف من اسم المنتج أو الوصف
                if (product.title && (product.title.toLowerCase().includes('زفاف') || product.title.toLowerCase().includes('عرس') || product.title.toLowerCase().includes('wedding') || product.title.toLowerCase().includes('عرائس'))) {
                    subcategoryNames = ['مرآة زفاف'];
                    subcategoryColors = ['bg-pink-500'];
                } else if (product.title && (product.title.toLowerCase().includes('خطوبة') || product.title.toLowerCase().includes('خطبة') || product.title.toLowerCase().includes('engagement') || product.title.toLowerCase().includes('خطيب'))) {
                    subcategoryNames = ['مرآة خطوبة'];
                    subcategoryColors = ['bg-purple-500'];
                } else if (product.title && (product.title.toLowerCase().includes('ديكور') || product.title.toLowerCase().includes('تزيين') || product.title.toLowerCase().includes('decorative') || product.title.toLowerCase().includes('زينة'))) {
                    subcategoryNames = ['مرآة ديكور'];
                    subcategoryColors = ['bg-green-500'];
                } else if (product.title && (product.title.toLowerCase().includes('مخصص') || product.title.toLowerCase().includes('custom') || product.title.toLowerCase().includes('خاص'))) {
                    subcategoryNames = ['مرآة مخصصة'];
                    subcategoryColors = ['bg-indigo-500'];
                } else if (product.title && (product.title.toLowerCase().includes('كلاسيك') || product.title.toLowerCase().includes('classic') || product.title.toLowerCase().includes('تقليدي'))) {
                    subcategoryNames = ['مرآة كلاسيكية'];
                    subcategoryColors = ['bg-yellow-500'];
                } else if (product.title && (product.title.toLowerCase().includes('عصرية') || product.title.toLowerCase().includes('modern') || product.title.toLowerCase().includes('حديث'))) {
                    subcategoryNames = ['مرآة عصرية'];
                    subcategoryColors = ['bg-blue-500'];
                } else if (product.title && (product.title.toLowerCase().includes('فاخر') || product.title.toLowerCase().includes('luxury') || product.title.toLowerCase().includes('مميز'))) {
                    subcategoryNames = ['مرآة فاخرة'];
                    subcategoryColors = ['bg-red-500'];
                } else {
                    // محاولة استخراج من الوصف إذا كان موجوداً
                    if (product.description) {
                        const desc = product.description.toLowerCase();
                        if (desc.includes('زفاف') || desc.includes('عرس') || desc.includes('wedding')) {
                            subcategoryNames = ['مرآة زفاف'];
                            subcategoryColors = ['bg-pink-500'];
                        } else if (desc.includes('خطوبة') || desc.includes('خطبة') || desc.includes('engagement')) {
                            subcategoryNames = ['مرآة خطوبة'];
                            subcategoryColors = ['bg-purple-500'];
                        } else if (desc.includes('ديكور') || desc.includes('تزيين') || desc.includes('decorative')) {
                            subcategoryNames = ['مرآة ديكور'];
                            subcategoryColors = ['bg-green-500'];
                        } else if (desc.includes('مخصص') || desc.includes('custom')) {
                            subcategoryNames = ['مرآة مخصصة'];
                            subcategoryColors = ['bg-indigo-500'];
                        } else if (desc.includes('كلاسيك') || desc.includes('classic')) {
                            subcategoryNames = ['مرآة كلاسيكية'];
                            subcategoryColors = ['bg-yellow-500'];
                        } else if (desc.includes('عصرية') || desc.includes('modern')) {
                            subcategoryNames = ['مرآة عصرية'];
                            subcategoryColors = ['bg-blue-500'];
                        } else if (desc.includes('فاخر') || desc.includes('luxury')) {
                            subcategoryNames = ['مرآة فاخرة'];
                            subcategoryColors = ['bg-red-500'];
                        } else {
                            // محاولة استخراج من الكلمات المفتاحية
                            const keywords = ['زفاف', 'عرس', 'خطوبة', 'خطبة', 'ديكور', 'تزيين', 'مخصص', 'كلاسيك', 'عصرية', 'فاخر'];
                            const foundKeyword = keywords.find(keyword => desc.includes(keyword));
                            if (foundKeyword) {
                                if (foundKeyword.includes('زفاف') || foundKeyword.includes('عرس')) {
                                    subcategoryNames = ['مرآة زفاف'];
                                    subcategoryColors = ['bg-pink-500'];
                                } else if (foundKeyword.includes('خطوبة') || foundKeyword.includes('خطبة')) {
                                    subcategoryNames = ['مرآة خطوبة'];
                                    subcategoryColors = ['bg-purple-500'];
                                } else if (foundKeyword.includes('ديكور') || foundKeyword.includes('تزيين')) {
                                    subcategoryNames = ['مرآة ديكور'];
                                    subcategoryColors = ['bg-green-500'];
                                } else if (foundKeyword.includes('مخصص')) {
                                    subcategoryNames = ['مرآة مخصصة'];
                                    subcategoryColors = ['bg-indigo-500'];
                                } else if (foundKeyword.includes('كلاسيك')) {
                                    subcategoryNames = ['مرآة كلاسيكية'];
                                    subcategoryColors = ['bg-yellow-500'];
                                } else if (foundKeyword.includes('عصرية')) {
                                    subcategoryNames = ['مرآة عصرية'];
                                    subcategoryColors = ['bg-blue-500'];
                                } else if (foundKeyword.includes('فاخر')) {
                                    subcategoryNames = ['مرآة فاخرة'];
                                    subcategoryColors = ['bg-red-500'];
                                }
                            } else {
                                subcategoryNames = ['مرآة'];
                                subcategoryColors = ['bg-gray-500'];
                            }
                        }
                    } else {
                        // إذا لم يكن هناك وصف، استخدم التصنيف العام
                        subcategoryNames = ['مرآة'];
                        subcategoryColors = ['bg-gray-500'];
                    }
                }
                }
                

                
                return `
                    <div class="product-card bg-white rounded-lg overflow-hidden shadow-lg hover:shadow-xl transition-shadow duration-300" data-product-id="${product.id}">
                        <div class="image-container">
                            <img src="${imageUrl}" alt="${product.title || 'منتج'}" class="w-full h-full object-cover object-center transition-transform duration-300 hover:scale-105 cursor-pointer" loading="lazy" onclick="viewProduct('${product.id}')">
                            <!-- أيقونة المفضلة -->
                            <div class="absolute top-3 left-3">
                                <button class="favorite-btn bg-white rounded-full p-2 shadow-lg hover:bg-pink-50 transition-all duration-200" onclick="toggleFavorite(event, '${product.id}', '${product.title || 'منتج'}', '${imageUrl}', '${product.price || 0}', '${product.governorate || ''}', '${product.cities || ''}', '${subcategoryNames.join(',')}')">
                                    <svg class="w-5 h-5 ${isFavorite(product.id) ? 'text-pink-500 fill-current' : 'text-gray-400'}" viewBox="0 0 24 24">
                                        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="p-2 sm:p-3 md:p-4">
                            ${subcategoryNames.length > 0 ? `
                                <div class="mb-2 flex flex-wrap gap-1">
                                    ${subcategoryNames.map((name, index) => {
                                        const color = subcategoryColors[index];
                                        const bgColor = color.replace('bg-', 'bg-').replace('-500', '-100');
                                        const textColor = color.replace('bg-', 'text-').replace('-500', '-800');
                                        // تقسيم النصوص الطويلة على عدة سطور
                                        let displayName = name;
                                        if (name === 'استقبال المولود بالمستشفى') {
                                            displayName = 'استقبال المولود<br>بالمستشفى';
                                        } else if (name.length > 15) {
                                            // تقسيم النصوص الأخرى الطويلة تلقائياً
                                            const words = name.split(' ');
                                            if (words.length > 2) {
                                                const mid = Math.ceil(words.length / 2);
                                                displayName = words.slice(0, mid).join(' ') + '<br>' + words.slice(mid).join(' ');
                                            }
                                        }

                                        return `
                                            <span class="inline-block ${bgColor} ${textColor} text-xs sm:text-sm px-1.5 sm:px-2 py-0.5 sm:py-1 rounded-full">
                                                ${displayName}
                                            </span>
                                        `;
                                    }).join('')}
                                </div>
                            ` : ''}

                            <div class="flex justify-between items-center">
                                <span class="gold-text font-bold text-sm sm:text-lg">
                                    ${product.price > 0 ? product.price + ' ج.م' : 'السعر عند الطلب'}
                                </span>
                                <div class="flex flex-col items-end gap-1">
                                    ${product.governorate ? `<span class="text-xs sm:text-sm bg-gray-100 text-gray-600 px-1.5 sm:px-2 py-0.5 sm:py-1 rounded-full">${product.governorate}</span>` : ''}
                                    ${product.cities && product.cities.trim() !== '' && product.cities !== 'جميع المدن' ? `<span class="text-xs sm:text-sm bg-blue-100 text-blue-700 px-1.5 sm:px-2 py-0.5 sm:py-1 rounded-full">${product.cities.split(',')[0].trim()}</span>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // View product details
        function viewProduct(productId) {
            window.location.href = `product-details.html?id=${productId}`;
        }

        // عرض تفاصيل المنتج
        function viewProductDetails(productId) {
            console.log('🔍 محاولة عرض تفاصيل المنتج:', productId);
            
            // البحث عن المنتج في القائمة
            let product = allProducts.find(p => p.id === productId);
            
            // إذا لم يتم العثور على المنتج، قد يكون منتج مميز
            if (!product) {
                // البحث في المنتجات المميزة
                const featuredAdsContainer = document.getElementById('featured-ads-container');
                if (featuredAdsContainer) {
                    const featuredAd = featuredAdsContainer.querySelector(`[data-ad-id="${productId}"]`);
                    if (featuredAd) {
                        // استخراج بيانات المنتج المميز من العنصر
                        const adData = JSON.parse(featuredAd.getAttribute('data-ad-info') || '{}');
                        if (adData.id) {
                            product = adData;
                            console.log('✅ تم العثور على المنتج المميز:', product);
                            
                            // تسجيل النقر على الإعلان إذا كان موجوداً
                            if (product.ad_id && window.advertisingService) {
                                console.log('📢 تسجيل النقر على الإعلان المميز:', product.ad_id);
                                try {
                                    window.advertisingService.recordClick(product.ad_id);
                                    console.log('✅ تم تسجيل النقر بنجاح!');
                                } catch (error) {
                                    console.error('❌ خطأ في تسجيل النقر:', error);
                                }
                            }
                        }
                    }
                }
            }
            
            if (!product) {
                console.error('❌ المنتج غير موجود:', productId);
                return;
            }

            // إنشاء نافذة منبثقة لعرض التفاصيل
            showProductDetailsModal(product);
        }

        // عرض نافذة تفاصيل المنتج
        function showProductDetailsModal(product) {
            // إزالة النوافذ المنبثقة السابقة
            const existingModal = document.querySelector('.product-details-modal');
            if (existingModal) {
                existingModal.remove();
            }

            // إنشاء النافذة المنبثقة
            const modal = document.createElement('div');
            modal.className = 'product-details-modal fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4';
            
            // الحصول على الصورة الأولى
            const imageUrl = product.image_urls && product.image_urls.length > 0 
                ? product.image_urls[0] 
                : '../assets/images/sarah-penney-1yk6cjyije8-unsplash.jpg';

            modal.innerHTML = `
                <div class="bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                    <!-- Header -->
                    <div class="flex justify-between items-center p-6 border-b">
                        <h2 class="text-xl font-bold text-gray-800">تفاصيل المنتج</h2>
                        <button onclick="closeProductDetailsModal()" class="text-gray-500 hover:text-gray-700 text-2xl font-bold">
                            ×
                        </button>
                    </div>
                    
                    <!-- Content -->
                    <div class="p-6">
                        <!-- Main Image -->
                        <div class="mb-4">
                            <img id="modal-main-image" src="${imageUrl}" alt="${product.name || 'منتج'}" 
                                 class="w-55 h-48 object-cover rounded-lg mx-auto">
                        </div>
                        
                        <!-- Image Gallery -->
                        ${product.image_urls && product.image_urls.length > 1 ? `
                            <div class="mb-6">
                                <h4 class="text-sm font-medium text-gray-700 mb-3">معرض الصور</h4>
                                <div class="flex space-x-2 space-x-reverse overflow-x-auto pb-2">
                                    ${product.image_urls.map((url, index) => `
                                        <img src="${url}" 
                                             alt="صورة ${index + 1}" 
                                             class="w-16 h-16 object-cover rounded-lg cursor-pointer border-2 border-transparent hover:border-yellow-400 transition-colors"
                                             onclick="changeModalMainImage('${url}')"
                                             loading="lazy">
                                    `).join('')}
                                </div>
                            </div>
                        ` : ''}
                        
                        <!-- Product Info -->
                        <div class="space-y-4">
                            <!-- Price -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800 mb-2">السعر</h3>
                                <p class="text-2xl font-bold text-yellow-600">
                                    ${product.price > 0 ? product.price + ' ج.م' : 'السعر عند الطلب'}
                                </p>
                            </div>
                            
                            <!-- Description -->
                            ${product.description ? `
                                <div>
                                    <h3 class="text-lg font-semibold text-gray-800 mb-2">الوصف</h3>
                                    <p class="text-gray-600">${product.description}</p>
                                </div>
                            ` : ''}
                            
                            <!-- Location -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800 mb-2">الموقع</h3>
                                <div class="space-y-2">
                                    ${product.governorate ? `<p class="text-gray-600">المحافظة: ${product.governorate}</p>` : ''}
                                    ${product.cities ? `<p class="text-gray-600">المدينة: ${product.cities}</p>` : ''}
                                </div>
                            </div>
                            
                            <!-- Category -->
                            <div>
                                <h3 class="text-lg font-semibold text-gray-800 mb-2">التصنيف</h3>
                                <p class="text-gray-600">${product.category || 'غير محدد'}</p>
                            </div>
                        </div>
                        
                        <!-- Actions -->
                        <div class="flex gap-3 mt-6 pt-6 border-t">
                            <!-- Favorite Button -->
                            <button onclick="toggleFavoriteFromModal('${product.id}')"
                                    class="flex-1 bg-pink-500 hover:bg-pink-600 text-white py-3 px-4 rounded-lg font-medium transition-colors text-center">
                                ${isFavorite(product.id) ? 'إزالة من المفضلة' : 'إضافة إلى المفضلة'}
                            </button>
                            
                            <!-- WhatsApp Button -->
                            ${product.whatsapp ? `
                                <button onclick="openWhatsAppChat('${product.id}', '${product.name || 'منتج'}', '${product.image_urls && product.image_urls.length > 0 ? product.image_urls[0] : ''}', '${product.price || 0}', '${product.governorate || ''}', '${product.cities || ''}', '${product.subcategories ? product.subcategories.join(',') : ''}', '${product.whatsapp}')"
                                   class="flex-1 bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-medium transition-colors text-center">
                                    تواصل عبر واتساب
                                </button>
                            ` : ''}
                        </div>
                        
                        <!-- التواصل مع البائع -->
                        <div class="mt-4 pt-4 border-t border-gray-200">
                            <h4 class="text-lg font-semibold text-gray-800 mb-2">تواصل مع البائع</h4>
                            <p class="text-sm text-gray-600 mb-4">جميع وسائل التواصل التالية تخص البائع لهذا المنتج.</p>
                            <div class="space-y-3">
                                <!-- WhatsApp Button -->
                                ${product.whatsapp ? `
                                    <button onclick="openWhatsAppChat('${product.id}', '${product.name || 'منتج'}', '${product.image_urls && product.image_urls.length > 0 ? product.image_urls[0] : ''}', '${product.price || 0}', '${product.governorate || ''}', '${product.cities || ''}', '${product.subcategories ? product.subcategories.join(',') : ''}', '${product.whatsapp}')"
                                       class="w-full bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded-lg font-medium transition-colors flex items-center justify-center gap-2">
                                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.86 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.464 3.488"/>
                                        </svg>
                                        راسل البائع عبر واتساب
                                    </button>
                                ` : ''}
                                
                                <!-- Facebook Button -->
                                ${product.facebook ? `
                                    <a href="${product.facebook}" 
                                       target="_blank" 
                                       class="w-full bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg font-medium transition-colors flex items-center justify-center gap-2">
                                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                                        </svg>
                                        صفحة البائع على فيسبوك
                                    </a>
                                ` : ''}
                                
                                <!-- Instagram Button -->
                                ${product.instagram ? `
                                    <a href="${product.instagram}" 
                                       target="_blank" 
                                       class="w-full bg-gradient-to-r from-purple-500 to-pink-500 hover:from-purple-600 hover:to-pink-600 text-white py-3 px-4 rounded-lg font-medium transition-colors flex items-center justify-center gap-2">
                                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                                            <path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.174-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.402.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.357-.629-2.746-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24.009 12.017 24.009c6.624 0 11.99-5.367 11.99-11.988C24.007 5.367 18.641.001 12.017.001z"/>
                                        </svg>
                                        تابع البائع على إنستجرام
                                    </a>
                                ` : ''}
                                
                                <!-- No Social Media Message -->
                                ${!product.facebook && !product.instagram && !product.whatsapp ? `
                                    <div class="text-center text-gray-500 text-sm py-3 w-full">
                                        لا توجد وسائل تواصل متاحة للبائع
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <!-- رسالة التنويه -->
                        <div class="mt-4 pt-4 border-t border-gray-200">
                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                                <div class="flex items-start gap-3">
                                    <div class="flex-shrink-0 mt-1">
                                        <svg class="w-5 h-5 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                                        </svg>
                                    </div>
                                    <div>
                                        <h5 class="text-sm font-semibold text-blue-800 mb-1">تنويه مهم</h5>
                                        <p class="text-sm text-blue-700 leading-relaxed">
                                            نحن منصة لعرض المنتجات فقط، ولسنا طرفًا في البيع أو التوصيل. جميع التعاملات تتم بين البائع والمشتري بشكل مباشر.
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // إغلاق النافذة عند النقر خارجها
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    closeProductDetailsModal();
                }
            });
        }

        // إغلاق نافذة تفاصيل المنتج
        function closeProductDetailsModal() {
            const modal = document.querySelector('.product-details-modal');
            if (modal) {
                modal.remove();
            }
        }

        // تبديل المفضلة من النافذة المنبثقة
        function toggleFavoriteFromModal(productId) {
            // البحث عن المنتج في القائمة الرئيسية
            let product = allProducts.find(p => p.id === productId);
            
            // إذا لم يتم العثور على المنتج، البحث في المنتجات المميزة
            if (!product) {
                const featuredAdsContainer = document.getElementById('featured-ads-container');
                if (featuredAdsContainer) {
                    const featuredAd = featuredAdsContainer.querySelector(`[data-ad-id="${productId}"]`);
                    if (featuredAd) {
                        const adData = JSON.parse(featuredAd.getAttribute('data-ad-info') || '{}');
                        if (adData.id) {
                            product = adData;
                        }
                    }
                }
            }
            
            if (!product) {
                console.error('❌ المنتج غير موجود:', productId);
                return;
            }
            
            // استخدام نفس منطق toggleFavorite
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            const existingIndex = favorites.findIndex(item => item.id === productId);
            
            if (existingIndex > -1) {
                favorites.splice(existingIndex, 1);
                showNotification('تم إزالة المنتج من المفضلة', 'info');
            } else {
                const productData = {
                    id: productId,
                    title: product.name || product.title || product.description || 'منتج',
                    imageUrl: product.image_urls && product.image_urls.length > 0 ? product.image_urls[0] : (product.image_url || ''),
                    price: product.price || 0,
                    governorate: product.governorate || '',
                    cities: product.cities || '',
                    subcategories: product.subcategory || product.subcategories || '',
                    category: 'mirr', // إضافة التصنيف الرئيسي
                    addedAt: new Date().toISOString()
                };
                favorites.push(productData);
                showNotification('تم إضافة المنتج إلى المفضلة', 'success');
            }
            
            localStorage.setItem('favorites', JSON.stringify(favorites));
            updateFavoriteIcon(productId);
            updateFeaturedAdFavoriteIcon(productId);
            updateFavoritesCountBadge();
            
            // تحديث زر المفضلة في النافذة المنبثقة
            const favoriteBtn = document.querySelector('.product-details-modal button:first-of-type');
            if (favoriteBtn) {
                favoriteBtn.textContent = isFavorite(productId) ? 'إزالة من المفضلة' : 'إضافة إلى المفضلة';
            }
        }



        // Mobile menu functionality
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        
        if (mobileMenuBtn && mobileMenu) {
            mobileMenuBtn.addEventListener('click', function() {
                mobileMenu.classList.toggle('hidden');
            });
        }
        
        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            if (mobileMenu && !mobileMenu.contains(event.target) && !mobileMenuBtn.contains(event.target)) {
                mobileMenu.classList.add('hidden');
            }
        });
        
        

        // Show error message
        function showError(message) {
            alert(message);
        }

        // Global functions for cities filter
        function updateSelectedCities() {
            const selected = [];
            const checkboxes = document.querySelectorAll('.city-checkbox');
            checkboxes.forEach(checkbox => {
                if (checkbox.checked) {
                    selected.push(checkbox.value);
                }
            });
            activeFilters.cities = selected;
            displaySelectedCities();
        }

        function updateCitiesPlaceholder() {
            const placeholder = document.getElementById('cities-placeholder');
            if (activeFilters.cities.length === 0) {
                placeholder.textContent = 'اختر المدن/المناطق';
            } else if (activeFilters.cities.length === 1) {
                placeholder.textContent = activeFilters.cities[0];
            } else {
                placeholder.textContent = `${activeFilters.cities.length} مدينة مختارة`;
            }
        }

        function displaySelectedCities() {
            const selectedCitiesContainer = document.getElementById('selected-cities');
            if (activeFilters.cities.length === 0) {
                selectedCitiesContainer.innerHTML = '';
                return;
            }
            selectedCitiesContainer.innerHTML = activeFilters.cities.map(city => `
                <div class="selected-city-tag">
                    ${city}
                    <button class="remove-city" onclick="removeCity('${city}')">×</button>
                </div>
            `).join('');
        }

        function filterCities(searchTerm) {
            const cityOptions = document.querySelectorAll('.city-option');
            cityOptions.forEach(option => {
                const cityName = option.querySelector('span').textContent.toLowerCase();
                if (cityName.includes(searchTerm.toLowerCase())) {
                    option.style.display = 'flex';
                } else {
                    option.style.display = 'none';
                }
            });
        }

        function removeCity(cityName) {
            const checkbox = document.querySelector(`.city-checkbox[value="${cityName}"]`);
            if (checkbox) {
                checkbox.checked = false;
                updateSelectedCities();
                applyFilters();
            }
        }

        // Setup simple cities filter
        function setupSimpleCitiesFilter() {
            const dropdownBtn = document.getElementById('cities-dropdown-btn');
            const dropdownContent = document.getElementById('cities-dropdown-content');
            const searchInput = document.getElementById('cities-search-input');
            const selectAllBtn = document.getElementById('select-all-cities');
            const clearAllBtn = document.getElementById('clear-all-cities');

            // Sample cities data - you can replace this with actual data
            const cities = [
                'القاهرة الجديدة', 'مدينة نصر', 'المعادي', 'مصر الجديدة', 'الزمالك', 'جاردن سيتي',
                'المعادي', 'الزمالك', 'جاردن سيتي', 'القصر العيني', 'السيدة زينب', 'السيدة عائشة',
                'باب اللوق', 'وسط البلد', 'الأزبكية', 'بولاق', 'شبرا', 'روض الفرج', 'الزاوية الحمراء',
                'الشرابية', 'الساحل', 'الوايلي', 'العباسية', 'الزيتون', 'حدائق القبة', 'عين شمس',
                'المطرية', 'السلام', 'المرج', 'مدينة بدر', 'مدينة الشروق', 'مدينة العبور',
                'مدينة 15 مايو', 'مدينة 6 أكتوبر', 'مدينة الشيخ زايد', 'مدينة العاصمة الإدارية'
            ];

            // Populate cities options
            const citiesOptionsContainer = document.querySelector('.cities-options');
            citiesOptionsContainer.innerHTML = cities.map(city => `
                <label class="city-option">
                    <input type="checkbox" value="${city}" class="city-checkbox">
                    <span>${city}</span>
                </label>
            `).join('');

            // Toggle dropdown
            dropdownBtn.addEventListener('click', function() {
                dropdownContent.classList.toggle('hidden');
                dropdownBtn.classList.toggle('active');
            });

            // Search functionality
            searchInput.addEventListener('input', function() {
                filterCities(this.value);
            });

            // Select all cities
            selectAllBtn.addEventListener('click', function() {
                const checkboxes = document.querySelectorAll('.city-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = true;
                });
                updateSelectedCities();
                applyFilters();
            });

            // Clear all cities
            clearAllBtn.addEventListener('click', function() {
                const checkboxes = document.querySelectorAll('.city-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
                updateSelectedCities();
                applyFilters();
            });

            // Handle individual city selection
            citiesOptionsContainer.addEventListener('change', function(e) {
                if (e.target.classList.contains('city-checkbox')) {
                    updateSelectedCities();
                    applyFilters();
                }
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function(event) {
                if (!dropdownBtn.contains(event.target) && !dropdownContent.contains(event.target)) {
                    dropdownContent.classList.add('hidden');
                    dropdownBtn.classList.remove('active');
                }
            });
        }





        // تحديث أيقونة القلب


        // عرض إشعار
        function showNotification(message, type = 'info') {
            // إزالة الإشعارات السابقة
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }

            const notification = document.createElement('div');
            notification.className = `notification fixed top-4 left-4 z-50 px-4 py-2 rounded-lg shadow-lg text-white text-sm font-medium transform transition-all duration-300 translate-x-0`;
            
            // تحديد لون الإشعار حسب النوع
            if (type === 'success') {
                notification.style.backgroundColor = '#10b981'; // أخضر
            } else if (type === 'error') {
                notification.style.backgroundColor = '#ef4444'; // أحمر
            } else {
                notification.style.backgroundColor = '#3b82f6'; // أزرق
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);

            // إخفاء الإشعار بعد 3 ثوان
            setTimeout(() => {
                notification.style.transform = 'translateX(-100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }



        // تحميل وعرض الإعلانات المميزة في التصنيف
        async function loadCategoryFeaturedAds() {
            try {
                if (!window.advertisingService) {
                    console.log('⏳ انتظار خدمة الإعلانات...');
                    setTimeout(loadCategoryFeaturedAds, 1000);
                    return;
                }

                console.log('🔍 جلب الإعلانات المميزة للتصنيف: mirr');
                const featuredAds = await window.advertisingService.getCategoryFeaturedProducts('mirr', 4);
                
                displayCategoryFeaturedAds(featuredAds);
                
                // تسجيل ظهور الإعلانات
                featuredAds.forEach(ad => {
                    if (ad.ad_id && window.advertisingService) {
                        window.advertisingService.recordImpression(ad.ad_id);
                    }
                });
                
            } catch (error) {
                console.error('❌ خطأ في تحميل الإعلانات المميزة:', error);
                showNoFeaturedAds();
            }
        }

        // عرض الإعلانات المميزة في التصنيف
        function displayCategoryFeaturedAds(ads) {
            const container = document.getElementById('featured-ads-container');
            const noAdsMessage = document.getElementById('no-featured-ads');
            
            if (!container) return;
            
            if (!ads || ads.length === 0) {
                showNoFeaturedAds();
                return;
            }
            
            // إخفاء رسالة عدم وجود إعلانات
            if (noAdsMessage) {
                noAdsMessage.classList.add('hidden');
            }
            
            const adsHTML = ads.map(ad => `
                <div class="bg-white rounded-lg shadow-md overflow-hidden border-2 border-yellow-200 hover:border-yellow-400 transition-all duration-300 transform hover:scale-105 flex-shrink-0 cursor-pointer" 
                     style="width: 200px;"
                     data-ad-id="${ad.id}"
                     data-product-id="${ad.id}"
                     data-ad-info='${JSON.stringify(ad)}'
                     onclick="viewProductDetails('${ad.id}')">
                    <div class="relative">
                        <img src="${ad.image_url || '../assets/images/sarah-penney-1yk6cjyije8-unsplash.jpg'}" 
                             alt="${ad.title}" 
                             class="w-full h-40 object-cover">
                        
                        <!-- علامة مميز -->
                        <div class="absolute top-1 right-1 bg-yellow-500 text-white text-xs px-1.5 py-0.5 rounded-full font-bold">
                            ⭐ مميز
                        </div>
                        
                        <!-- أيقونة المفضلة -->
                        <div class="absolute top-1 left-1">
                            <button class="favorite-btn bg-white rounded-full p-1.5 shadow-lg hover:bg-pink-50 transition-all duration-200" 
                                    onclick="toggleFavorite(event, '${ad.id}', '${ad.title || 'منتج مميز'}', '${ad.image_url || '../assets/images/sarah-penney-1yk6cjyije8-unsplash.jpg'}', '${ad.price || 0}', '${ad.governorate || ''}', '${ad.cities || ''}', '${ad.subcategories ? ad.subcategories.join(',') : ''}')">
                                <svg class="w-4 h-4 ${isFavorite(ad.id) ? 'text-pink-500 fill-current' : 'text-gray-400'}" viewBox="0 0 24 24">
                                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                </svg>
                            </button>
                        </div>
                    </div>
                    
                    <div class="p-3">
                        <div class="flex items-center justify-between mb-2">
                            <span class="text-sm font-bold text-yellow-600">
                                ${ad.price > 0 ? ad.price + ' ج.م' : 'السعر عند الطلب'}
                            </span>
                            <span class="text-xs text-gray-500">${ad.governorate}</span>
                        </div>
                        
                        <div class="flex gap-1">
                        </div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = adsHTML;
            console.log(`✅ تم عرض ${ads.length} إعلان مميز في التصنيف`);
        }

        // إظهار رسالة عدم وجود إعلانات مميزة
        function showNoFeaturedAds() {
            const container = document.getElementById('featured-ads-container');
            const noAdsMessage = document.getElementById('no-featured-ads');
            
            if (container) {
                container.innerHTML = '';
            }
            
            if (noAdsMessage) {
                noAdsMessage.classList.remove('hidden');
            }
        }
        
        // تغيير الصورة الرئيسية في النافذة المنبثقة
        function changeModalMainImage(imageUrl) {
            const mainImage = document.getElementById('modal-main-image');
            if (mainImage) {
                mainImage.src = imageUrl;
            }
        }

        // دالة فتح محادثة الواتساب مع رسالة تلقائية
        function openWhatsAppChat(productId, title, imageUrl, price, governorate, cities, subcategories, whatsappNumber) {
            // تنظيف رقم الهاتف من جميع الأحرف غير الرقمية
            let phoneNumber = whatsappNumber.replace(/[^0-9]/g, '');
            
            // إزالة الرمز الدولي إذا كان موجوداً في البداية
            if (phoneNumber.startsWith('20')) {
                phoneNumber = phoneNumber.substring(2);
            }
            
            // إضافة الرمز الدولي لمصر إذا لم يكن موجوداً
            if (!phoneNumber.startsWith('20') && !phoneNumber.startsWith('+20')) {
                phoneNumber = '20' + phoneNumber;
            }
            
            // إنشاء رسالة واتساب محسنة
            let message = ``;
            
            // إضافة السعر أولاً
            if (price && price > 0) {
                message += `💰 السعر: ${price} ج.م\n`;
            }
            
            // إضافة رابط الصورة ثانياً
            if (imageUrl && imageUrl !== '../assets/images/sarah-penney-1yk6cjyije8-unsplash.jpg') {
                message += `🖼️ رابط الصورة: ${imageUrl}\n`;
            }
            
            // إضافة رابط المنتج ثالثاً
            message += `🔗 رابط المنتج: ${window.location.origin}/pages/product-details.html?id=${productId}\n\n`;
            
            // إضافة التحية والاستفسار في النهاية
            message += `مرحباً، أريد الاستفسار عن هذا المنتج`;
            
            // إنشاء رابط الواتساب
            const whatsappUrl = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
            
            // التحقق من أن المستخدم على جهاز محمول
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (isMobile) {
                // محاولة فتح تطبيق الواتساب مباشرة
                window.location.href = whatsappUrl;
            } else {
                // على الكمبيوتر، فتح في تبويب جديد
                window.open(whatsappUrl, '_blank');
            }
        }

        // تحميل الإعلانات المميزة عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', function() {
            // تحميل الإعلانات المميزة في التصنيف
            loadCategoryFeaturedAds();
        });

        // ===== وظائف إدارة المفضلة =====
        
        // التحقق من وجود منتج في المفضلة
        function isFavorite(productId) {
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            return favorites.some(item => item.id === productId);
        }

        // تبديل حالة المفضلة (إضافة/إزالة)
        function toggleFavorite(event, productId, title, imageUrl, price, governorate, cities, subcategories) {
            event.stopPropagation(); // منع انتقال الحدث للعنصر الأب
            
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            const existingIndex = favorites.findIndex(item => item.id === productId);
            
            if (existingIndex > -1) {
                // إزالة من المفضلة
                favorites.splice(existingIndex, 1);
                showNotification('تم إزالة المنتج من المفضلة', 'info');
            } else {
                // إضافة إلى المفضلة
                const productData = {
                    id: productId,
                    title: title,
                    imageUrl: imageUrl,
                    price: price,
                    governorate: governorate,
                    cities: cities,
                    subcategories: subcategories,
                    category: 'mirr', // إضافة التصنيف الرئيسي
                    addedAt: new Date().toISOString()
                };
                favorites.push(productData);
                showNotification('تم إضافة المنتج إلى المفضلة', 'success');
            }
            
            // حفظ في Local Storage
            localStorage.setItem('favorites', JSON.stringify(favorites));
            
            // تحديث أيقونة القلب
            updateFavoriteIcon(productId);
            
            // تحديث أيقونة القلب في بطاقات المنتجات المميزة
            updateFeaturedAdFavoriteIcon(productId);
            
            // تحديث عداد المفضلة
            console.log('🔄 Calling updateFavoritesCountBadge from toggleFavorite');
            updateFavoritesCountBadge();
        }

        // تحديث أيقونة القلب
        function updateFavoriteIcon(productId) {
            const favoriteBtn = document.querySelector(`[data-product-id="${productId}"] .favorite-btn svg`);
            if (favoriteBtn) {
                if (isFavorite(productId)) {
                    favoriteBtn.classList.remove('text-gray-400');
                    favoriteBtn.classList.add('text-pink-500', 'fill-current');
                } else {
                    favoriteBtn.classList.remove('text-pink-500', 'fill-current');
                    favoriteBtn.classList.add('text-gray-400');
                }
            }
        }
        
        // تحديث أيقونة القلب في بطاقات المنتجات المميزة
        function updateFeaturedAdFavoriteIcon(adId) {
            const favoriteBtn = document.querySelector(`[data-ad-id="${adId}"] .favorite-btn svg`);
            if (favoriteBtn) {
                if (isFavorite(adId)) {
                    favoriteBtn.classList.remove('text-gray-400');
                    favoriteBtn.classList.add('text-pink-500', 'fill-current');
                } else {
                    favoriteBtn.classList.remove('text-pink-500', 'fill-current');
                    favoriteBtn.classList.add('text-gray-400');
                }
            }
        }

        // عرض إشعار
        function showNotification(message, type = 'info') {
            // إزالة الإشعارات السابقة
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }

            const notification = document.createElement('div');
            notification.className = `notification fixed top-4 left-4 z-50 px-4 py-2 rounded-lg shadow-lg text-white text-sm font-medium transform transition-all duration-300 translate-x-0`;
            
            // تحديد لون الإشعار حسب النوع
            if (type === 'success') {
                notification.style.backgroundColor = '#10b981'; // أخضر
            } else if (type === 'error') {
                notification.style.backgroundColor = '#ef4444'; // أحمر
            } else {
                notification.style.backgroundColor = '#3b82f6'; // أزرق
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // إخفاء الإشعار بعد 3 ثوان
            setTimeout(() => {
                notification.style.transform = 'translateX(-100%)';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // تحديث عداد المفضلة
        function updateFavoritesCountBadge() {
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            const count = favorites.length;
            
            // تحديث العداد في الهيدر
            const desktopBadge = document.getElementById('favorites-count-badge');
            const mobileBadge = document.getElementById('favorites-count-badge-mobile');
            
            if (desktopBadge) {
                if (count > 0) {
                    desktopBadge.textContent = count;
                    desktopBadge.classList.remove('hidden');
                } else {
                    desktopBadge.classList.add('hidden');
                }
            }
            
            if (mobileBadge) {
                if (count > 0) {
                    mobileBadge.textContent = count;
                    mobileBadge.classList.remove('hidden');
                } else {
                    mobileBadge.classList.add('hidden');
                }
            }
        }
    </script>
    
    <!-- ملف التمرير السلس -->
    <script src="../js/scroll-optimization.js?v=2025-08-22-1" defer></script>
    <script src="../js/smooth-scroll.js" defer></script>
    
    <!-- Floating Add Product Button -->
    <div class="fixed bottom-6 left-1/2 transform -translate-x-1/2 z-50">
        <a href="add-product-request.html" class="inline-flex items-center justify-center text-white px-6 py-4 rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 font-semibold text-lg" style="background: #845FCE;">
            <svg class="w-6 h-6 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
            </svg>
            أضف منتجك
        </a>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="text-lg font-bold mb-4">زِينَة</h3>
                    <p class="text-gray-300 text-sm">منصة متخصصة في خدمات الخطوبة والمناسبات</p>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">روابط سريعة</h4>
                    <ul class="space-y-2 text-sm text-gray-300">
                        <li><a href="../index.html" class="hover:text-white transition-colors">الرئيسية</a></li>
                        <li><a href="about-us.html" class="hover:text-white transition-colors">من نحن</a></li>
                        <li><a href="contact-us.html" class="hover:text-white transition-colors">اتصل بنا</a></li>
                        <li><a href="advertise-with-us.html" class="text-yellow-400 hover:text-yellow-300 font-medium">⭐ أضف إعلانك</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">السياسات</h4>
                    <ul class="space-y-2 text-sm text-gray-300">
                        <li><a href="../legal/privacy-policy.html" class="hover:text-white transition-colors">سياسة الخصوصية</a></li>
                        <li><a href="../legal/terms-of-use.html" class="hover:text-white transition-colors">شروط الاستخدام</a></li>
                        <li><a href="../legal/cookies-policy.html" class="hover:text-white transition-colors">سياسة الكوكيز</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-semibold mb-4">تواصل معنا</h4>
                    <ul class="space-y-2 text-sm text-gray-300">
                        <li><a href="tel:+201016436007" class="hover:text-white transition-colors">📞 01016436007</a></li>
                        <li><a href="https://www.facebook.com/share/1BCEhAV89y/?mibextid=wwXIfr" target="_blank" class="hover:text-white transition-colors">📘 فيسبوك</a></li>
                        <li><a href="https://www.instagram.com/zeina.eg_?igsh=MXg4bzNqd213Z3IyaQ==" target="_blank" class="hover:text-white transition-colors">📷 إنستغرام</a></li>
                        <li><a href="https://wa.me/201016436007" target="_blank" class="hover:text-white transition-colors">📱 واتساب</a></li>
                    </ul>
                </div>
            </div>
            <div class="border-t border-gray-700 mt-8 pt-8">
                <div class="text-center text-sm text-gray-300 mb-4">
                    <p>&copy; 2024 زِينَة. جميع الحقوق محفوظة.</p>
                </div>
                <div class="bg-gray-700 rounded-lg p-4 text-center">
                    <p class="text-xs text-gray-400 leading-relaxed">
                        تنبيه قانوني: يقتصر دور الموقع على عرض المنتجات وربط الأطراف، ولا يشارك في البيع أو الدفع أو التوصيل. لا تتحمل إدارة الموقع أي مسؤولية عن الاتفاقات أو المعاملات التي تتم بين المستخدمين.
                    </p>
                </div>
            </div>
        </div>
    </footer>
</body>
</html> 
</html> 