<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÙØ­Øµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª - Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="js/supabase-config.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .ad-card { border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 8px; }
        .ad-card.cake { border-left: 5px solid #f59e0b; }
        .field { margin: 5px 0; }
        .field label { font-weight: bold; color: #333; margin-left: 10px; }
        .field span { color: #666; }
        .btn { padding: 10px 20px; margin: 10px; background: #3b82f6; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .btn:hover { background: #2563eb; }
        .status { padding: 5px 10px; border-radius: 15px; color: white; font-size: 12px; }
        .status.active { background: #10b981; }
        .status.inactive { background: #ef4444; }
        .missing { color: #ef4444; font-weight: bold; }
        .success { color: #10b981; font-weight: bold; }
        .warning { color: #f59e0b; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ÙØ­Øµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h1>
        
        <div>
            <button class="btn" onclick="loadAllAds()">ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</button>
            <button class="btn" onclick="loadCakeAds()">Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„ØªÙˆØ±ØªØ§Øª ÙÙ‚Ø·</button>
            <button class="btn" onclick="testCakeQuery()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„ØªÙˆØ±ØªØ§Øª</button>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        // ØªÙ‡ÙŠØ¦Ø© Supabase
        let supabase = null;
        
        // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Supabase
        function waitForSupabase() {
            return new Promise((resolve) => {
                const check = () => {
                    if (window.supabaseClient) {
                        supabase = window.supabaseClient;
                        resolve(supabase);
                    } else {
                        setTimeout(check, 100);
                    }
                };
                check();
            });
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
        async function loadAllAds() {
            await waitForSupabase();
            
            try {
                console.log('ğŸ” Ø¬Ù„Ø¨ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª...');
                const { data, error } = await supabase
                    .from('advertisements')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                displayAds(data, 'Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª');
            } catch (error) {
                document.getElementById('results').innerHTML = `<p style="color: red;">Ø®Ø·Ø£: ${error.message}</p>`;
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„ØªÙˆØ±ØªØ§Øª
        async function loadCakeAds() {
            await waitForSupabase();
            
            try {
                console.log('ğŸ” Ø¬Ù„Ø¨ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„ØªÙˆØ±ØªØ§Øª...');
                const { data, error } = await supabase
                    .from('advertisements')
                    .select('*')
                    .eq('ad_type', 'featured')
                    .eq('is_active', true)
                    .eq('category_section', 'cake')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                displayAds(data, 'Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„ØªÙˆØ±ØªØ§Øª (Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ù…Ø·Ø¨Ù‚Ø©)');
            } catch (error) {
                document.getElementById('results').innerHTML = `<p style="color: red;">Ø®Ø·Ø£: ${error.message}</p>`;
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„ØªÙˆØ±ØªØ§Øª Ù…Ø¹ ØªÙØ§ØµÙŠÙ„
        async function testCakeQuery() {
            await waitForSupabase();
            
            try {
                const results = document.getElementById('results');
                results.innerHTML = '<h3>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± ØªÙØµÙŠÙ„ÙŠ Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„ØªÙˆØ±ØªØ§Øª...</h3>';

                // Ø®Ø·ÙˆØ© 1: Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ø¹ product_category = cake
                console.log('1ï¸âƒ£ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ø¹ product_category = cake');
                const { data: cakeProducts, error: error1 } = await supabase
                    .from('advertisements')
                    .select('*')
                    .eq('product_category', 'cake');
                
                results.innerHTML += `<div><strong>Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ø¹ product_category = 'cake':</strong> ${cakeProducts?.length || 0}</div>`;

                // Ø®Ø·ÙˆØ© 2: Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ø¹ category_section = cake
                console.log('2ï¸âƒ£ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ø¹ category_section = cake');
                const { data: cakeSection, error: error2 } = await supabase
                    .from('advertisements')
                    .select('*')
                    .eq('category_section', 'cake');
                
                results.innerHTML += `<div><strong>Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…Ø¹ category_section = 'cake':</strong> ${cakeSection?.length || 0}</div>`;

                // Ø®Ø·ÙˆØ© 3: Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¥Ø¹Ù„Ø§Ù†Ø§Øª featured Ù†Ø´Ø·Ø©
                console.log('3ï¸âƒ£ Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¥Ø¹Ù„Ø§Ù†Ø§Øª featured Ù†Ø´Ø·Ø©');
                const { data: featuredActive, error: error3 } = await supabase
                    .from('advertisements')
                    .select('*')
                    .eq('ad_type', 'featured')
                    .eq('is_active', true);
                
                results.innerHTML += `<div><strong>Ø¥Ø¹Ù„Ø§Ù†Ø§Øª featured Ù†Ø´Ø·Ø©:</strong> ${featuredActive?.length || 0}</div>`;

                // Ø®Ø·ÙˆØ© 4: Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ø«Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…
                console.log('4ï¸âƒ£ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„ÙƒØ§Ù…Ù„ Ù…Ø«Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…');
                const { data: finalQuery, error: error4 } = await supabase
                    .from('advertisements')
                    .select('*')
                    .eq('ad_type', 'featured')
                    .eq('is_active', true)
                    .eq('category_section', 'cake')
                    .order('priority', { ascending: false })
                    .order('created_at', { ascending: false });
                
                results.innerHTML += `<div><strong>Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø§Ù„ÙƒØ§Ù…Ù„ (Ù…Ø«Ù„ Ø§Ù„Ù†Ø¸Ø§Ù…):</strong> ${finalQuery?.length || 0}</div>`;

                // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
                if (cakeProducts && cakeProducts.length > 0) {
                    results.innerHTML += '<h4>ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ø§Ù„ØªÙˆØ±ØªØ§Øª:</h4>';
                    displayAds(cakeProducts, 'Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø§Ù„ØªÙˆØ±ØªØ§Øª');
                }

            } catch (error) {
                document.getElementById('results').innerHTML += `<p style="color: red;">Ø®Ø·Ø£: ${error.message}</p>`;
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
        function displayAds(ads, title) {
            const results = document.getElementById('results');
            
            if (!ads || ads.length === 0) {
                results.innerHTML = `<h3>${title}</h3><p class="warning">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª!</p>`;
                return;
            }

            let html = `<h3>${title} (${ads.length} Ø¥Ø¹Ù„Ø§Ù†)</h3>`;
            
            ads.forEach((ad, index) => {
                const isCakeRelated = ad.product_category === 'cake' || ad.category_section === 'cake';
                const isActiveAndFeatured = ad.is_active && ad.ad_type === 'featured';
                const hasCategorySection = !!ad.category_section;
                
                html += `
                    <div class="ad-card ${isCakeRelated ? 'cake' : ''}">
                        <h4>Ø¥Ø¹Ù„Ø§Ù† #${index + 1} - ${ad.title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†'}</h4>
                        
                        <div class="field">
                            <label>ID:</label> <span>${ad.id}</span>
                        </div>
                        
                        <div class="field">
                            <label>Ù†ÙˆØ¹ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†:</label> 
                            <span class="${ad.ad_type === 'featured' ? 'success' : 'warning'}">${ad.ad_type}</span>
                            ${ad.ad_type !== 'featured' ? '<span class="missing"> â† ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† "featured"</span>' : ''}
                        </div>
                        
                        <div class="field">
                            <label>Ø§Ù„Ø­Ø§Ù„Ø©:</label> 
                            <span class="status ${ad.is_active ? 'active' : 'inactive'}">${ad.is_active ? 'Ù†Ø´Ø·' : 'ØºÙŠØ± Ù†Ø´Ø·'}</span>
                            ${!ad.is_active ? '<span class="missing"> â† ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ù†Ø´Ø·Ø§Ù‹</span>' : ''}
                        </div>
                        
                        <div class="field">
                            <label>ØªØµÙ†ÙŠÙ Ø§Ù„Ù…Ù†ØªØ¬:</label> 
                            <span class="${ad.product_category === 'cake' ? 'success' : ''}">${ad.product_category || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                        </div>
                        
                        <div class="field">
                            <label>Ù‚Ø³Ù… Ø§Ù„ØªØµÙ†ÙŠÙ:</label> 
                            <span class="${ad.category_section === 'cake' ? 'success' : hasCategorySection ? 'warning' : 'missing'}">${ad.category_section || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                            ${ad.category_section !== 'cake' ? '<span class="missing"> â† ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† "cake" Ù„Ù„Ø¸Ù‡ÙˆØ± ÙÙŠ Ù‚Ø³Ù… Ø§Ù„ØªÙˆØ±ØªØ§Øª</span>' : ''}
                        </div>
                        
                        <div class="field">
                            <label>Ø§Ù„Ù…ÙˆØ¶Ø¹:</label> <span>${ad.position || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                        </div>
                        
                        <div class="field">
                            <label>Ø§Ù„Ø£ÙˆÙ„ÙˆÙŠØ©:</label> <span>${ad.priority || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</span>
                        </div>
                        
                        <div class="field">
                            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:</label> <span>${new Date(ad.created_at).toLocaleString('ar-EG')}</span>
                        </div>
                        
                        ${ad.end_date ? `<div class="field">
                            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡:</label> <span>${new Date(ad.end_date).toLocaleString('ar-EG')}</span>
                        </div>` : ''}
                        
                        <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                            <strong>ğŸ“Š ØªØ­Ù„ÙŠÙ„:</strong>
                            ${isActiveAndFeatured && ad.category_section === 'cake' 
                                ? '<span class="success">âœ… Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ÙŠØ¬Ø¨ Ø£Ù† ÙŠØ¸Ù‡Ø± ÙÙŠ Ù‚Ø³Ù… Ø§Ù„ØªÙˆØ±ØªØ§Øª!</span>'
                                : '<span class="warning">âš ï¸ Ù‡Ø°Ø§ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† Ù„Ù† ÙŠØ¸Ù‡Ø± ÙÙŠ Ù‚Ø³Ù… Ø§Ù„ØªÙˆØ±ØªØ§Øª</span>'}
                        </div>
                    </div>
                `;
            });
            
            results.innerHTML = html;
        }

        // ØªØ­Ù…ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ”§ ØµÙØ­Ø© ÙØ­Øµ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø¬Ø§Ù‡Ø²Ø©');
        });
    </script>
</body>
</html>
