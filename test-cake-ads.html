<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„ØªÙˆØ±ØªØ§Øª Ø§Ù„Ù…ÙØ­Ø¯Ø«Ø©</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="js/supabase-config.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 10px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .btn { padding: 10px 20px; margin: 10px; background: #3b82f6; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .btn:hover { background: #2563eb; }
        .btn-success { background: #10b981; }
        .btn-success:hover { background: #059669; }
        .result { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 5px; }
        .success { color: #10b981; font-weight: bold; }
        .error { color: #ef4444; font-weight: bold; }
        .warning { color: #f59e0b; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„ØªÙˆØ±ØªØ§Øª Ø§Ù„Ù…ÙØ­Ø¯Ø«Ø©</h1>
        
        <div class="test-section">
            <h3>1ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø¯Ø§Ù„Ø© getCategorySectionAdvertisements Ø§Ù„Ù…ÙØ­Ø¯Ø«Ø©</h3>
            <button class="btn" onclick="testUpdatedFunction()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…ÙØ­Ø¯Ø«Ø©</button>
            <div id="test1-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>2ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h3>
            <button class="btn" onclick="testHomepageDisplay()">Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¹Ø±Ø¶</button>
            <div id="test2-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>3ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ù†Ø´Ø§Ø¡ HTML Ù„Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</h3>
            <button class="btn" onclick="testHTMLCreation()">Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ù†Ø´Ø§Ø¡ HTML</button>
            <div id="test3-result" class="result"></div>
        </div>
        
        <div class="test-section">
            <h3>4ï¸âƒ£ Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„</h3>
            <button class="btn btn-success" onclick="runFullTest()">ØªØ´ØºÙŠÙ„ Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„</button>
            <div id="test4-result" class="result"></div>
        </div>
    </div>

    <script>
        let supabase = null;
        
        // Ø§Ù†ØªØ¸Ø§Ø± ØªØ­Ù…ÙŠÙ„ Supabase
        function waitForSupabase() {
            return new Promise((resolve) => {
                const check = () => {
                    if (window.supabaseClient) {
                        supabase = window.supabaseClient;
                        resolve(supabase);
                    } else {
                        setTimeout(check, 100);
                    }
                };
                check();
            });
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ù…ÙØ­Ø¯Ø«Ø©
        async function testUpdatedFunction() {
            const result = document.getElementById('test1-result');
            result.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...';
            
            try {
                await waitForSupabase();
                
                if (!window.advertisingService) {
                    result.innerHTML = '<span class="error">âŒ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</span>';
                    return;
                }
                
                console.log('ğŸ” Ø§Ø®ØªØ¨Ø§Ø± getCategorySectionAdvertisements Ø§Ù„Ù…ÙØ­Ø¯Ø«Ø©...');
                const ads = await window.advertisingService.getCategorySectionAdvertisements('cake', 3);
                
                if (ads && ads.length > 0) {
                    result.innerHTML = `
                        <span class="success">âœ… ØªÙ… Ø¬Ù„Ø¨ ${ads.length} Ø¥Ø¹Ù„Ø§Ù† Ø¨Ù†Ø¬Ø§Ø­!</span><br>
                        <strong>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª:</strong><br>
                        ${ads.map((ad, index) => `
                            <div style="margin: 10px 0; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                                <strong>Ø§Ù„Ø¥Ø¹Ù„Ø§Ù† ${index + 1}:</strong><br>
                                - Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${ad.title || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
                                - Ø§Ù„ÙˆØµÙ: ${ad.description || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
                                - Ø§Ù„ØµÙˆØ±Ø©: ${ad.image_url || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}<br>
                                - Ø§Ù„Ù…Ù†ØªØ¬: ${ad.product ? 'âœ… Ù…Ø±ØªØ¨Ø·' : 'âŒ ØºÙŠØ± Ù…Ø±ØªØ¨Ø·'}<br>
                                - Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø®Ø§Ù…: <pre style="font-size: 10px;">${JSON.stringify(ad, null, 2)}</pre>
                            </div>
                        `).join('')}
                    `;
                } else {
                    result.innerHTML = '<span class="warning">âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù„Ù„ØªÙˆØ±ØªØ§Øª</span>';
                }
                
            } catch (error) {
                result.innerHTML = `<span class="error">âŒ Ø®Ø·Ø£: ${error.message}</span>`;
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:', error);
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        async function testHomepageDisplay() {
            const result = document.getElementById('test2-result');
            result.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...';
            
            try {
                await waitForSupabase();
                
                if (!window.advertisingService) {
                    result.innerHTML = '<span class="error">âŒ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</span>';
                    return;
                }
                
                // Ù…Ø­Ø§ÙƒØ§Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
                const ads = await window.advertisingService.getCategorySectionAdvertisements('cake', 3);
                
                if (ads && ads.length > 0) {
                    // Ù…Ø­Ø§ÙƒØ§Ø© Ø¯Ø§Ù„Ø© displayCategoryAds
                    const container = document.createElement('div');
                    container.innerHTML = `
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            ${ads.map(ad => createTestAdHTML(ad)).join('')}
                        </div>
                    `;
                    
                    result.innerHTML = `
                        <span class="success">âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ HTML Ø¨Ù†Ø¬Ø§Ø­!</span><br>
                        <strong>Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª:</strong><br>
                        <div style="margin: 10px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                            ${container.innerHTML}
                        </div>
                    `;
                } else {
                    result.innerHTML = '<span class="warning">âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù„Ù„Ø¹Ø±Ø¶</span>';
                }
                
            } catch (error) {
                result.innerHTML = `<span class="error">âŒ Ø®Ø·Ø£: ${error.message}</span>`;
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:', error);
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ HTML Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
        function createTestAdHTML(ad) {
            let imageUrl = '';
            if (ad.image_url) {
                imageUrl = ad.image_url;
            } else if (ad.product && ad.product.image_url) {
                imageUrl = ad.product.image_url;
            } else if (ad.product && ad.product.image_urls && ad.product.image_urls.length > 0) {
                imageUrl = ad.product.image_urls[0];
            } else {
                imageUrl = 'assets/images/placeholder.jpg';
            }
            
            let title = 'Ø¥Ø¹Ù„Ø§Ù† Ù…Ù…ÙŠØ²';
            let description = 'Ù…Ù†ØªØ¬ Ù…Ù…ÙŠØ² ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„ØªØµÙ†ÙŠÙ';
            let price = '';
            
            if (ad.title) {
                title = ad.title;
            } else if (ad.product && ad.product.name) {
                title = ad.product.name;
            }
            
            if (ad.description) {
                description = ad.description;
            } else if (ad.product && ad.product.description) {
                description = ad.product.description;
            }
            
            if (ad.product && ad.product.price) {
                price = `${ad.product.price} Ø¬.Ù…`;
            }
            
            return `
                <div class="bg-white rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-all duration-300 transform hover:scale-105" style="width: 280px;">
                    <div class="relative">
                        <img src="${imageUrl}" alt="${title}" class="w-full h-48 object-cover" onerror="this.src='assets/images/placeholder.jpg'">
                        <div class="absolute top-2 left-2 bg-gradient-to-r from-yellow-500 to-yellow-600 text-white px-3 py-1 rounded-full text-sm font-bold">
                            ğŸ¯ Ø¥Ø¹Ù„Ø§Ù† Ù…Ù…ÙŠØ²
                        </div>
                    </div>
                    <div class="p-4">
                        <h3 class="font-bold text-lg text-gray-800 mb-2">${title}</h3>
                        <p class="text-gray-600 text-sm mb-3">${description}</p>
                        ${price ? `<div class="text-yellow-600 font-bold text-lg mb-2">${price}</div>` : ''}
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-gray-500">Ø¥Ø¹Ù„Ø§Ù†</span>
                            <button class="bg-gradient-to-r from-yellow-500 to-yellow-600 text-white px-4 py-2 rounded-lg text-sm font-semibold">
                                Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ù†Ø´Ø§Ø¡ HTML
        async function testHTMLCreation() {
            const result = document.getElementById('test3-result');
            result.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±...';
            
            try {
                await waitForSupabase();
                
                if (!window.advertisingService) {
                    result.innerHTML = '<span class="error">âŒ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</span>';
                    return;
                }
                
                const ads = await window.advertisingService.getCategorySectionAdvertisements('cake', 1);
                
                if (ads && ads.length > 0) {
                    const ad = ads[0];
                    const html = createTestAdHTML(ad);
                    
                    result.innerHTML = `
                        <span class="success">âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ HTML Ø¨Ù†Ø¬Ø§Ø­!</span><br>
                        <strong>HTML Ø§Ù„Ù…ÙÙ†Ø´Ø£:</strong><br>
                        <pre style="background: #f8f9fa; padding: 10px; border-radius: 5px; overflow-x: auto; font-size: 10px;">${html}</pre>
                    `;
                } else {
                    result.innerHTML = '<span class="warning">âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ù„Ø§Ø®ØªØ¨Ø§Ø± HTML</span>';
                }
                
            } catch (error) {
                result.innerHTML = `<span class="error">âŒ Ø®Ø·Ø£: ${error.message}</span>`;
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±:', error);
            }
        }

        // Ø§Ø®ØªØ¨Ø§Ø± Ø´Ø§Ù…Ù„
        async function runFullTest() {
            const result = document.getElementById('test4-result');
            result.innerHTML = 'ğŸš€ Ø¨Ø¯Ø¡ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„...';
            
            try {
                await waitForSupabase();
                
                if (!window.advertisingService) {
                    result.innerHTML = '<span class="error">âŒ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©</span>';
                    return;
                }
                
                // Ø§Ø®ØªØ¨Ø§Ø± 1: Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª
                result.innerHTML += '<br>1ï¸âƒ£ Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø¹Ù„Ø§Ù†Ø§Øª...';
                const ads = await window.advertisingService.getCategorySectionAdvertisements('cake', 3);
                
                if (!ads || ads.length === 0) {
                    result.innerHTML += '<span class="warning"> âš ï¸ Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¥Ø¹Ù„Ø§Ù†Ø§Øª</span>';
                    return;
                }
                
                result.innerHTML += '<span class="success"> âœ… ØªÙ… Ø¬Ù„Ø¨ ' + ads.length + ' Ø¥Ø¹Ù„Ø§Ù†</span>';
                
                // Ø§Ø®ØªØ¨Ø§Ø± 2: ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                result.innerHTML += '<br>2ï¸âƒ£ ÙØ­Øµ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...';
                let dataValid = true;
                ads.forEach((ad, index) => {
                    if (!ad.title && !ad.product) {
                        dataValid = false;
                    }
                });
                
                if (dataValid) {
                    result.innerHTML += '<span class="success"> âœ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØµØ­ÙŠØ­Ø©</span>';
                } else {
                    result.innerHTML += '<span class="warning"> âš ï¸ Ø¨Ø¹Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙÙ‚ÙˆØ¯Ø©</span>';
                }
                
                // Ø§Ø®ØªØ¨Ø§Ø± 3: Ø¥Ù†Ø´Ø§Ø¡ HTML
                result.innerHTML += '<br>3ï¸âƒ£ Ø¥Ù†Ø´Ø§Ø¡ HTML...';
                try {
                    const html = ads.map(ad => createTestAdHTML(ad)).join('');
                    result.innerHTML += '<span class="success"> âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ HTML</span>';
                } catch (htmlError) {
                    result.innerHTML += '<span class="error"> âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ù†Ø´Ø§Ø¡ HTML</span>';
                }
                
                result.innerHTML += '<br><br><span class="success">ğŸ‰ ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„!</span>';
                
            } catch (error) {
                result.innerHTML += `<br><span class="error">âŒ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„: ${error.message}</span>`;
                console.error('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø´Ø§Ù…Ù„:', error);
            }
        }

        // ØªØ­Ù…ÙŠÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ”§ ØµÙØ­Ø© Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¹Ù„Ø§Ù†Ø§Øª Ø§Ù„ØªÙˆØ±ØªØ§Øª Ø¬Ø§Ù‡Ø²Ø©');
        });
    </script>
</body>
</html>
