<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>زِينَة</title>
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" as="script">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/supabase-config.js"></script>
    <script src="js/cities-service.js" defer></script>
    <script src="js/product-service.js" defer></script>
    <script src="js/auth-service.js" defer></script>
    <script src="js/admin-security.js" defer></script>
    <script src="js/governorate-filter.js" defer></script>
    <script src="js/enhanced-auto-slideshow.js" defer></script>
    <script src="js/product-requests-service.js" defer></script>
    <script src="js/advertising-service.js" defer></script>
    <script src="js/smooth-scroll.js" defer></script>
    
    <!-- Cities Filter Styles -->
    <style>
        :root {
            --primary-pink: #f8d7e4;
            --primary-green: #d8e9d6;
            --primary-beige: #f5f0e6;
            --gold: #d4af37;
        }
        
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f9f9f9;
        }
        
        .hero-image {
            height: 60vh;
            background-position: center;
            background-size: cover;
            transition: all 0.7s ease-in-out;
            position: relative;
        }
        
        .text-shadow {
            text-shadow: none;
        }
        
        .text-shadow-lg {
            text-shadow: none;
        }
        
        .carousel-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .carousel-indicator.active {
            background: #d4af37;
            border-color: #d4af37;
            transform: scale(1.2);
        }
        
        .product-card {
            transition: all 0.3s ease;
            box-shadow: 0 2px 15px rgba(0,0,0,0.05);
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .product-card img {
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }
        
        /* أنماط المفضلة */
        .favorite-btn {
            transition: all 0.2s ease;
            z-index: 10;
        }
        
        .favorite-btn:hover {
            transform: scale(1.1);
        }
        
        .favorite-btn svg {
            transition: all 0.2s ease;
        }
        
        .favorite-btn.favorite svg {
            color: #ef4444;
            fill: currentColor;
        }
        
        .favorite-btn:not(.favorite) svg {
            color: #9ca3af;
        }
        
        /* تحسين مظهر القلب الأحمر */
        .favorite-btn svg.text-red-500 {
            color: #ef4444 !important;
            fill: currentColor !important;
        }
        
        /* أنماط السلايدر الجديد */
        .product-image-container {
            position: relative;
            overflow: hidden;
            border-radius: 8px 8px 0 0;
        }
        
        .slideshow-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        .slideshow-image {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
            transform: scale(1.05);
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }
        
        .slideshow-image.active {
            opacity: 1;
            transform: scale(1);
        }
        
        .slideshow-image:hover {
            transform: scale(1.02);
            transition: transform 0.3s ease;
        }
        
        .slideshow-indicators {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 6px;
            z-index: 15;
        }
        
        .indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            border: 2px solid rgba(255, 255, 255, 0.8);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .indicator.active {
            background: #d4af37;
            border-color: #d4af37;
            transform: scale(1.2);
        }
        
        .indicator:hover {
            background: #d4af37;
            border-color: #d4af37;
        }
        
        .multiple-images-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            backdrop-filter: blur(10px);
            z-index: 15;
        }
        
        /* تحسين جودة الصور في الصفحة الرئيسية */
        .category-card img {
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }
        
        /* تحسين تحميل الصور للمنتجات المميزة */
        .product-card img {
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            loading: lazy;
        }
        
        /* تحسينات العرض الأفقي */
        #featured-products-grid {
            scrollbar-width: thin;
            scrollbar-color: #d4af37 #f3f4f6;
        }
        
        #featured-products-grid::-webkit-scrollbar {
            height: 8px;
        }
        
        #featured-products-grid::-webkit-scrollbar-track {
            background: #f3f4f6;
        }
        
        /* تنسيق رسائل الخطأ */
        .error-message {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* تنسيق الحقول التي تحتوي على أخطاء */
        .border-red-500 {
            border-color: #ef4444 !important;
        }
        
        /* Validation Styles */
        .validation-error {
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .validation-error::before {
            content: "⚠️";
            font-size: 1rem;
        }
        
        .validation-error.show {
            display: flex;
        }
        
        .validation-error.hidden {
            display: none;
        }
        
        .field-error {
            border-color: #dc2626 !important;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1) !important;
        }
        
        .field-error:focus {
            border-color: #dc2626 !important;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1) !important;
        }
        
        .required-field {
            color: #dc2626;
            font-weight: 600;
        }
        
        /* Special error styling for governorate and subcategory sections */
        .simple-governorate-filter.field-error .dropdown-btn {
            border-color: #dc2626 !important;
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.1) !important;
        }
        
        .simple-governorate-filter.field-error .dropdown-btn:hover {
            border-color: #dc2626 !important;
        }
        
        #request-subcategory-group.field-error {
            border: 2px solid #dc2626;
            border-radius: 8px;
            padding: 1rem;
            background-color: rgba(220, 38, 38, 0.05);
        }
        
        #request-subcategory-options.field-error {
            border: 1px solid #dc2626;
            border-radius: 6px;
            padding: 0.5rem;
            background-color: rgba(220, 38, 38, 0.05);
        }
        
        .field-error {
            border-color: #dc2626 !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
        }
        
        /* تنسيق dropdown المحافظات عند وجود خطأ */
        #request-governorate-dropdown-btn.border-red-500 {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
        }
        
        /* تنسيق مجموعة التصنيفات الفرعية عند وجود خطأ */
        #request-subcategory-group.border-red-500 {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
        }
        
        /* تنسيق منطقة رفع الصور عند وجود خطأ */
        #request-upload-area.border-red-500 {
            border-color: #ef4444 !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
        }
        
        #featured-products-grid::-webkit-scrollbar-thumb {
            background: #d4af37;
            border-radius: 4px;
        }
        
        #featured-products-grid::-webkit-scrollbar-thumb {
            background: #d4af37;
            border-radius: 4px;
        }
        
        #featured-products-grid::-webkit-scrollbar-thumb:hover {
            background: #b8941f;
        }
        
        .gold-border {
            border: 1px solid var(--gold);
        }
        
        /* ضمان ظهور الهيدر */
        header {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            position: sticky !important;
            top: 0 !important;
            z-index: 50 !important;
            background-color: white !important;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06) !important;
        }
        
        /* تحسين التمرير السلس */
        html {
            scroll-behavior: smooth;
            scroll-padding-top: 80px; /* تعويض ارتفاع الهيدر */
        }
        
        /* تحسين التمرير على الأجهزة المحمولة */
        @media (max-width: 768px) {
            html {
                scroll-padding-top: 70px;
            }
        }
        
        /* تأثير بصري للقسم المستهدف */
        #product-request-section {
            scroll-margin-top: 80px;
        }
        
        @media (max-width: 768px) {
            #product-request-section {
                scroll-margin-top: 70px;
            }
        }
        
        header .container {
            display: flex !important;
            align-items: center !important;
            justify-content: space-between !important;
        }
        
        .gold-text {
            color: var(--gold);
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .hero-image {
                height: 40vh;
            }
        }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Logo styles */
        .logo-css {
            width: 100%;
            height: 100%;
        }
        

        
        .logo-text {
            font-family: 'Tajawal', sans-serif;
            color: #d4af37;
            font-size: 1.5rem;
            font-weight: bold;
            text-align: center;
        }
        
        /* Fallback logo styles */
        .logo-fallback {
            background: linear-gradient(135deg, #d4af37 0%, #b8941f 100%);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: bold;
            text-align: center;
            font-size: 0.875rem;
        }
        
        /* Button Styles */
        .btn-primary {
            background: linear-gradient(135deg, var(--gold) 0%, #b8941f 100%);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.3);
        }
        
        .btn-secondary {
            background: transparent;
            color: #666;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            border-color: #999;
            color: #333;
        }
        
        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
            transform: translateY(-20px);
            transition: all 0.3s ease;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        }
        
        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }
        
        .modal-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--gold) 0%, #b8941f 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1.5rem;
            box-shadow: 0 10px 25px rgba(212, 175, 55, 0.3);
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 1rem;
        }
        
        .modal-message {
            color: #666;
            line-height: 1.6;
            margin-bottom: 2rem;
        }
        
        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }
        
        .btn-modal-primary {
            background: linear-gradient(135deg, var(--gold) 0%, #b8941f 100%);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-modal-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.3);
        }
        
        .btn-modal-secondary {
            background: transparent;
            color: #666;
            padding: 0.75rem 1.5rem;
            border-radius: 12px;
            font-weight: 600;
            border: 2px solid #ddd;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-modal-secondary:hover {
            border-color: #999;
            color: #333;
        }
        
        /* Custom Modal Styles */
        .custom-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .custom-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .custom-modal-content {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            transform: scale(0.8);
            transition: all 0.3s ease;
        }
        
        .custom-modal-overlay.active .custom-modal-content {
            transform: scale(1);
        }
        
        .custom-modal-icon {
            width: 64px;
            height: 64px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 2rem;
        }
        
        .custom-modal-icon.warning {
            background: #fef3c7;
            color: #f59e0b;
        }
        
        .custom-modal-icon.success {
            background: #d1fae5;
            color: #10b981;
        }
        
        .custom-modal-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: #1f2937;
        }
        
        .custom-modal-message {
            color: #6b7280;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }
        
        .custom-modal-buttons {
            display: flex;
            gap: 0.75rem;
            justify-content: center;
        }
        
        .custom-modal-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            border: none;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 100px;
        }
        
        .custom-modal-btn.cancel {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .custom-modal-btn.cancel:hover {
            background: #e5e7eb;
            transform: translateY(-1px);
        }
        
        .custom-modal-btn.confirm {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
        
        .custom-modal-btn.confirm:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 20px rgba(239, 68, 68, 0.3);
        }
        
        .custom-modal-btn.success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }
        
        .custom-modal-btn.success:hover {
            transform: translateY(-1px);
            box-shadow: 0 8px 20px rgba(16, 185, 129, 0.3);
        }
        
        /* تأثيرات إضافية لزر "أضف منتجك" */
        #add-product-request-btn {
            position: relative;
            overflow: hidden;
        }
        
        #add-product-request-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        #add-product-request-btn:hover::before {
            left: 100%;
        }
        
        /* تأثير التمرير السلس */
        html {
            scroll-behavior: smooth;
        }
        
        /* تأثير النبض للقسم */
        @keyframes section-pulse {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            }
            50% {
                transform: scale(1.02);
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            }
        }

        .cities-filter-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            font-family: 'Tajawal', sans-serif;
        }

        .cities-header {
            position: relative;
        }

        .cities-trigger {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 16px;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 48px;
        }

        .cities-trigger:hover {
            border-color: #d1d5db;
        }

        .cities-trigger.active {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .trigger-content {
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
        }

        .location-icon {
            width: 20px;
            height: 20px;
            color: #6b7280;
            flex-shrink: 0;
        }

        .trigger-text {
            color: #374151;
            font-weight: 500;
            flex: 1;
        }

        .selected-count {
            background: #3b82f6;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            min-width: 20px;
            text-align: center;
        }

        .chevron-icon {
            width: 16px;
            height: 16px;
            color: #6b7280;
            transition: transform 0.3s ease;
            flex-shrink: 0;
        }

        .cities-trigger.active .chevron-icon {
            transform: rotate(180deg);
        }

        .cities-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            z-index: 1000;
            margin-top: 4px;
            max-height: 400px;
            overflow: hidden;
            display: none;
        }

        .cities-dropdown.show {
            display: block;
        }

        .dropdown-header {
            padding: 16px;
            border-bottom: 1px solid #e5e7eb;
        }

        .search-container {
            position: relative;
            margin-bottom: 12px;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            color: #9ca3af;
        }

        .search-input {
            width: 100%;
            padding: 8px 12px 8px 36px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            outline: none;
            transition: border-color 0.3s ease;
        }

        .search-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .actions {
            display: flex;
            gap: 8px;
        }

        .action-btn {
            padding: 6px 12px;
            background: #f3f4f6;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 12px;
            color: #374151;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: #e5e7eb;
            border-color: #9ca3af;
        }

        .cities-list {
            max-height: 250px;
            overflow-y: auto;
            padding: 8px 0;
        }

        .city-item {
            padding: 8px 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .city-item:hover {
            background-color: #f9fafb;
        }

        .city-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            width: 100%;
        }

        .city-input {
            width: 16px;
            height: 16px;
            accent-color: #3b82f6;
        }

        .city-name {
            color: #374151;
            font-size: 14px;
            flex: 1;
        }

        .dropdown-footer {
            padding: 12px 16px;
            border-top: 1px solid #e5e7eb;
            background: #f9fafb;
        }

        .apply-btn {
            width: 100%;
            padding: 10px 16px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .apply-btn:hover {
            background: #2563eb;
        }

        .selected-cities {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }

        .selected-city-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: #dbeafe;
            color: #1e40af;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .remove-city {
            background: none;
            border: none;
            color: #1e40af;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            padding: 0;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }

        .remove-city:hover {
            background: rgba(30, 64, 175, 0.1);
        }

        /* Sortable Image Styles */
        .sortable-image {
            cursor: grab;
            transition: all 0.3s ease;
            position: relative;
        }

        .sortable-image:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .sortable-image.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
            z-index: 1000;
            cursor: grabbing;
        }

        .sortable-image.drag-over {
            border: 2px dashed #d4af37;
            background: rgba(212, 175, 55, 0.1);
        }

        .image-drag-handle {
            position: absolute;
            top: 0.5rem;
            left: 0.5rem;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border-radius: 50%;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: grab;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .image-drag-handle:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: scale(1.1);
        }

        .image-number {
            position: absolute;
            bottom: 0.5rem;
            left: 0.5rem;
            background: #d4af37;
            color: white;
            border-radius: 50%;
            width: 1.5rem;
            height: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            z-index: 10;
        }

        .image-sort-instructions {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
        }

        /* Simple Governorate Filter Styles */
        .simple-governorate-filter {
            position: relative;
            width: 100%;
        }

        .filter-dropdown {
            position: relative;
        }

        .dropdown-btn {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            background: white;
            color: #374151;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 14px;
        }

        .dropdown-btn:hover {
            border-color: #d4af37;
            background: #fefbf0;
        }
        
        .dropdown-btn:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        .dropdown-arrow {
            width: 16px;
            height: 16px;
            transition: transform 0.3s ease;
        }

        .dropdown-btn.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        .dropdown-content {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            z-index: 1000;
            max-height: 300px;
            overflow-y: auto;
        }

        .governorate-options {
            padding: 8px;
        }

        .governorate-option {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 6px;
            transition: background-color 0.2s ease;
        }

        .governorate-option:hover {
            background-color: #f3f4f6;
        }

        .governorate-checkbox {
            margin-left: 8px;
            width: 16px;
            height: 16px;
            accent-color: #d4af37;
        }

        .dropdown-actions {
            display: flex;
            gap: 8px;
            padding: 8px;
            border-top: 1px solid #e5e7eb;
        }

        .action-btn {
            flex: 1;
            padding: 6px 12px;
            border: 1px solid #d4af37;
            border-radius: 6px;
            background: white;
            color: #d4af37;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .action-btn:hover {
            background: #d4af37;
            color: white;
        }

        .selected-governorates {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .selected-governorate-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            background: #dbeafe;
            color: #1e40af;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .remove-governorate {
            background: none;
            border: none;
            color: #1e40af;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            padding: 0;
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }

        .remove-governorate:hover {
            background: rgba(30, 64, 175, 0.1);
        }

        /* Responsive Design */
        @media (max-width: 640px) {
            .cities-filter-container {
                max-width: 100%;
            }
            
            .cities-trigger {
                padding: 10px 12px;
                min-height: 44px;
            }
            
            .trigger-text {
                font-size: 14px;
            }
            
            .cities-dropdown {
                max-height: 300px;
            }
            
            .cities-list {
                max-height: 200px;
            }
        }
        
        /* Global Error Banner Styles */
        #global-error-banner {
            background-color: #dc2626;
            color: white;
            border-radius: 0.5rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            margin-bottom: 1.5rem;
            transition: all 0.3s ease-in-out;
        }
        
        #global-error-banner.show {
            opacity: 1;
            transform: scale(1);
        }
        
        #global-error-banner.hidden {
            opacity: 0;
            transform: scale(0.95);
            display: none;
        }
        
        #close-error-banner {
            background: none;
            border: none;
            cursor: pointer;
            padding: 8px;
            border-radius: 6px;
            transition: all 0.2s ease;
        }
        
        #close-error-banner:hover {
            background-color: rgba(255, 255, 255, 0.1);
            transform: scale(1.05);
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            #global-error-banner .container {
                padding-left: 16px;
                padding-right: 16px;
            }
            
            #global-error-banner h3 {
                font-size: 16px;
            }
            
            #global-error-banner p {
                font-size: 14px;
            }
        }
        

    </style>
</head>
<body class="text-gray-700">
    <!-- Header -->
    <header class="sticky top-0 z-50 bg-white shadow-sm gold-border" style="display: block !important; visibility: visible !important; opacity: 1 !important;">
        <div class="container mx-auto px-4 py-2 flex items-center justify-between" style="display: flex !important;">
            <!-- Logo -->
            <div class="flex items-center mr-2">
                <span class="logo-text">زِينَة</span>
            </div>
            
            <!-- التصنيفات والروابط للشاشات الكبيرة -->
            <div class="hidden lg:flex items-center space-x-6 space-x-reverse">
                <a href="pages/category-koshat.html" class="text-gray-600 hover:text-yellow-600 transition-colors text-sm font-medium">كوشات</a>
                                        <a href="pages/category-cake.html" class="text-gray-600 hover:text-yellow-600 transition-colors text-sm font-medium">تورتات وشكولاتات</a>
                <a href="pages/category-mirr.html" class="text-gray-600 hover:text-yellow-600 transition-colors text-sm font-medium">مرايا</a>
                <a href="pages/category-other.html" class="text-gray-600 hover:text-yellow-600 transition-colors text-sm font-medium">ديكورات متنوعة</a>
                <a href="pages/category-invitations.html" class="text-gray-600 hover:text-yellow-600 transition-colors text-sm font-medium">دعوات وتوزيعات</a>
                <span class="text-gray-300">|</span>
                <a href="pages/about-us.html" class="text-gray-600 hover:text-yellow-600 transition-colors text-sm font-medium">من نحن</a>
                <a href="pages/contact-us.html" class="text-gray-600 hover:text-yellow-600 transition-colors text-sm font-medium">اتصل بنا</a>
            </div>
            
                            <!-- Desktop Action Buttons -->
                <div class="hidden lg:flex items-center space-x-3 space-x-reverse">
                    <!-- Desktop Favorites Button -->
                    <a href="pages/favorites.html" class="text-pink-500 hover:text-pink-600 transition-colors flex items-center space-x-2 space-x-reverse relative">
                        <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                        </svg>
                        <span id="favorites-count-badge-desktop" class="absolute -top-2 -right-2 bg-yellow-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold hidden">0</span>
                    </a>
                    
                    <!-- Desktop Advertise Button -->
                    <a href="pages/advertise-with-us.html" class="bg-gradient-to-r from-yellow-500 to-yellow-600 text-white text-xs px-3 py-2 rounded-lg font-semibold hover:from-yellow-600 hover:to-yellow-700 transform hover:scale-105 transition-all duration-200">
                        <span class="flex items-center space-x-1 space-x-reverse">
                            <span>⭐</span>
                            <span>أعلن معنا</span>
                        </span>
                    </a>
                    
                    <!-- Desktop Add Product Request Button -->
                    <a href="javascript:void(0)" class="bg-gradient-to-r from-green-500 to-green-600 text-white text-xs px-3 py-2 rounded-lg font-semibold hover:from-green-600 hover:to-green-700 transform hover:scale-105 transition-all duration-200" id="add-product-request-btn" onclick="scrollToProductRequestSection()">
                        <span class="flex items-center space-x-1 space-x-reverse">
                            <span>➕</span>
                            <span>أضف منتجك</span>
                        </span>
                    </a>
                
                <!-- Desktop Admin Dashboard Button (Hidden by default) -->
                <a href="admin/admin-dashboard.html" class="bg-gradient-to-r from-red-500 to-red-600 text-white text-xs px-3 py-2 rounded-lg font-semibold hover:from-red-600 hover:to-red-700 transform hover:scale-105 transition-all duration-200 hidden" id="admin-dashboard-btn-desktop">
                    <span class="flex items-center space-x-1 space-x-reverse">
                        <span>⚙️</span>
                        <span>لوحة الأدمن</span>
                    </span>
                </a>
            </div>
            
            <!-- تم إزالة Desktop Auth Buttons -->
            
            <!-- Mobile Menu Button -->
            <div class="lg:hidden flex items-center space-x-2 space-x-reverse">
                <!-- Mobile Favorites Button -->
                <a href="pages/favorites.html" class="text-pink-500 hover:text-pink-600 transition-colors flex items-center space-x-2 space-x-reverse relative">
                    <svg class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                    </svg>
                    <span id="favorites-count-badge-mobile" class="absolute -top-2 -right-2 bg-yellow-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center font-bold hidden">0</span>
                </a>
                

                
                <!-- Mobile Advertise Button -->
                <a href="pages/advertise-with-us.html" class="bg-gradient-to-r from-yellow-500 to-yellow-600 text-white text-xs px-2 py-2 rounded-lg font-semibold hover:from-yellow-600 hover:to-yellow-700 transform hover:scale-105 transition-all duration-200 text-center">
                    <span class="flex items-center justify-center space-x-1 space-x-reverse">
                        <span>⭐</span>
                        <span>أعلن معنا</span>
                    </span>
                </a>
                
                <!-- Mobile Add Product Request Button -->
                <a href="javascript:void(0)" onclick="scrollToProductRequestSection()" class="bg-gradient-to-r from-green-500 to-green-600 text-white text-xs px-2 py-2 rounded-lg font-semibold hover:from-green-600 hover:to-green-700 transform hover:scale-105 transition-all duration-200 text-center">
                    <span class="flex items-center justify-center space-x-1 space-x-reverse">
                        <span>➕</span>
                        <span>أضف منتجك</span>
                    </span>
                </a>
                
                <!-- Mobile Admin Dashboard Button (Hidden by default) -->
                <a href="admin/admin-dashboard.html" class="bg-gradient-to-r from-red-500 to-red-600 text-white text-xs px-2 py-2 rounded-lg font-semibold hover:from-red-600 hover:to-red-700 transform hover:scale-105 transition-all duration-200 text-center hidden" id="admin-dashboard-btn-mobile">
                    <span class="flex items-center justify-center space-x-1 space-x-reverse">
                        <span>⚙️</span>
                        <span>لوحة الأدمن</span>
                    </span>
                </a>
                
                <!-- Mobile Menu Button -->
                <button id="mobile-menu-btn" class="p-2 text-gray-600 hover:text-yellow-600">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
                    </svg>
                </button>
            </div>
        </div>
        
        <!-- Mobile Menu -->
        <div id="mobile-menu" class="lg:hidden hidden bg-white border-t border-gray-200">
            <div class="px-4 py-2 space-y-2">
                

                
                <!-- التصنيفات -->
                <div class="border-b border-gray-200 pb-3">
                    <h3 class="text-sm font-semibold text-gray-700 mb-2">التصنيفات</h3>
                    <div class="space-y-2">
                        <a href="pages/category-koshat.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">كوشات</a>
                        <a href="pages/category-cake.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">تورتات وشكولاتات</a>
                        <a href="pages/category-mirr.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">مرايا</a>
                        <a href="pages/category-other.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">ديكورات متنوعة</a>
                        <a href="pages/category-invitations.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">دعوات وتوزيعات</a>
                    </div>
                </div>
                
                <!-- روابط مهمة -->
                <div class="border-b border-gray-200 pb-3">
                    <h3 class="text-sm font-semibold text-gray-700 mb-2">روابط مهمة</h3>
                    <div class="space-y-2">
                        <a href="pages/about-us.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">من نحن</a>
                        <a href="pages/contact-us.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">اتصل بنا</a>
                        <a href="pages/faq.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm">الأسئلة الشائعة</a>
                    </div>
                </div>
                

                
                <!-- تواصل معنا -->
                <div class="border-b border-gray-200 pb-3">
                    <h3 class="text-sm font-semibold text-gray-700 mb-2">تواصل معنا</h3>
                    
                    <!-- التواصل الاجتماعي -->
                    <div class="mb-3">
                        <h4 class="text-xs font-medium text-gray-500 mb-2">التواصل الاجتماعي</h4>
                        <div class="space-y-2">
                            <a href="https://facebook.com" target="_blank" class="block py-2 px-3 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200 text-sm flex items-center">
                                <span class="mr-2">📘</span>
                                فيسبوك
                            </a>
                            <a href="https://instagram.com" target="_blank" class="block py-2 px-3 text-gray-600 hover:text-pink-600 hover:bg-pink-50 rounded-lg transition-all duration-200 text-sm flex items-center">
                                <span class="mr-2">📷</span>
                                إنستغرام
                            </a>
                            <a href="https://wa.me/201234567890" target="_blank" class="block py-2 px-3 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-all duration-200 text-sm flex items-center">
                                <span class="mr-2">📱</span>
                                واتساب
                            </a>
                        </div>
                    </div>
                    
                    <!-- التواصل المباشر -->
                    <div>
                        <h4 class="text-xs font-medium text-gray-500 mb-2">التواصل المباشر</h4>
                        <div class="space-y-2">
                            <a href="tel:+201234567890" class="block py-2 px-3 text-gray-600 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all duration-200 text-sm flex items-center">
                                <span class="mr-2">📞</span>
                                اتصل بنا
                            </a>
                            <a href="pages/contact-us.html" class="block py-2 px-3 text-gray-600 hover:text-yellow-600 hover:bg-yellow-50 rounded-lg transition-all duration-200 text-sm flex items-center">
                                <span class="mr-2">📧</span>
                                راسلنا
                            </a>
                        </div>
                    </div>
                </div>
                
                <!-- إضافة منتج في القائمة المتحركة -->
                <div class="border-b border-gray-200 pb-3">
                    <h3 class="text-sm font-semibold text-gray-700 mb-2">إضافة منتج</h3>
                    <div class="space-y-2">
                        <a href="javascript:void(0)" onclick="scrollToProductRequestSection()" class="block py-2 px-3 text-gray-600 hover:text-green-600 hover:bg-green-50 rounded-lg transition-all duration-200 text-sm flex items-center">
                            <span class="mr-2">➕</span>
                            أضف منتجك
                        </a>
                    </div>
                </div>
                
                <!-- لوحة الأدمن في القائمة المتحركة (مخفي افتراضياً) -->
                <div class="border-b border-gray-200 pb-3 hidden" id="admin-menu-mobile">
                    <h3 class="text-sm font-semibold text-gray-700 mb-2">لوحة الإدارة</h3>
                    <div class="space-y-2">
                        <a href="admin/admin-dashboard.html" class="block py-2 px-3 text-gray-600 hover:text-red-600 hover:bg-red-50 rounded-lg transition-all duration-200 text-sm flex items-center">
                            <span class="mr-2">⚙️</span>
                            لوحة الأدمن
                        </a>
                    </div>
                </div>
                
                <!-- Mobile Auth Buttons -->
                <div class="auth-buttons-mobile border-t border-gray-200 pt-2 mt-2">
                    <!-- Auth buttons will be dynamically updated -->
                </div>
            </div>
        </div>
    </header>

    <!-- Global Error Banner - Will be moved to below the form -->

    <!-- Hero Section -->
    <div class="relative overflow-hidden">
        <div id="hero-carousel" class="hero-image transition-all duration-700 ease-in-out flex items-center justify-center" style="background: linear-gradient(135deg, #fdf2f8 0%, #fce7f3 100%);">
            <!-- Carousel content will be dynamically loaded -->
        </div>
        
        <!-- Carousel Indicators -->
        <div id="carousel-indicators" class="absolute bottom-4 left-0 right-0 flex justify-center space-x-2 space-x-reverse">
            <!-- Indicators will be dynamically generated -->
        </div>
    </div>







    <!-- Browse Categories -->
    <section class="container mx-auto px-4 py-12">
        <h2 class="text-3xl font-bold mb-8 text-center gold-text">تصفح التصنيفات</h2>
        
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4 md:gap-6">
            <!-- Koshat Category -->
                            <a href="pages/category-koshat.html" class="group">
                <div class="relative overflow-hidden rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2">
                    <img src="assets/images/koshat.jpg" 
                         alt="كوشات" 
                         class="w-full h-48 md:h-80 object-cover object-center group-hover:scale-110 transition-transform duration-300" loading="lazy">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                    <div class="absolute bottom-0 left-0 right-0 p-3 md:p-6 text-white">
                        <h3 class="text-lg md:text-xl font-bold mb-1 md:mb-2">كوشات</h3>
                        <p class="text-xs md:text-sm opacity-90">تصاميم فريدة لحفلاتكم</p>
                    </div>
                </div>
            </a>

            <!-- Cake Category -->
                            <a href="pages/category-cake.html" class="group">
                <div class="relative overflow-hidden rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2">
                    <img src="assets/images/cake.jpg" 
                         alt="تورتة" 
                         class="w-full h-48 md:h-80 object-cover object-center group-hover:scale-110 transition-transform duration-300" loading="lazy">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                    <div class="absolute bottom-0 left-0 right-0 p-3 md:p-6 text-white">
                        <h3 class="text-lg md:text-xl font-bold mb-1 md:mb-2">تورتات وشكولاتات</h3>
                        <p class="text-xs md:text-sm opacity-90">تورتات وشكولاتات مخصصة ومميزة</p>
                    </div>
                </div>
            </a>

            <!-- Mirror Category -->
                            <a href="pages/category-mirr.html" class="group">
                <div class="relative overflow-hidden rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2">
                                          <img src="assets/images/sarah-penney-1Yk6CJyIjE8-unsplash.jpg"  
                         alt="مرايا ذهبية مزخرفة" 
                         class="w-full h-48 md:h-80 object-cover object-center group-hover:scale-110 transition-transform duration-300" loading="lazy">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                    <div class="absolute bottom-0 left-0 right-0 p-3 md:p-6 text-white">
                        <h3 class="text-lg md:text-xl font-bold mb-1 md:mb-2">مرايا</h3>
                        <p class="text-xs md:text-sm opacity-90">مرايا مزخرفة وأنيقة</p>
                    </div>
                </div>
            </a>

            <!-- Other Category -->
                            <a href="pages/category-other.html" class="group">
                <div class="relative overflow-hidden rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2">
                    <img src="assets/images/decorations.jpg" 
                         alt="ديكورات متنوعة" 
                         class="w-full h-48 md:h-80 object-cover object-center group-hover:scale-110 transition-transform duration-300" loading="lazy">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                    <div class="absolute bottom-0 left-0 right-0 p-3 md:p-6 text-white">
                        <h3 class="text-lg md:text-xl font-bold mb-1 md:mb-2">ديكورات متنوعة</h3>
                        <p class="text-xs md:text-sm opacity-90 mb-2">منتجات متنوعة ومميزة</p>
                        <div class="text-xs opacity-80 space-y-1">
                            <div>🎈 ديكور عيد ميلاد</div>
                            <div>🏥 ديكور استقبال مستشفى</div>
                            <div>👰 ديكور استقبال عروسة</div>
                            <div>🎉 ديكور حفلات بسيطة</div>
                        </div>
                    </div>
                </div>
            </a>

            <!-- Invitations Category -->
            <a href="pages/category-invitations.html" class="group">
                <div class="relative overflow-hidden rounded-lg shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-2">
                    <img src="assets/images/f.jpg" 
                         alt="دعوات الأفراح والخطوبة" 
                         class="w-full h-48 md:h-80 object-cover object-center group-hover:scale-110 transition-transform duration-300" loading="lazy">
                    <div class="absolute inset-0 bg-gradient-to-t from-black/70 to-transparent"></div>
                    <div class="absolute bottom-0 left-0 right-0 p-3 md:p-6 text-white">
                                                    <h3 class="text-lg md:text-xl font-bold mb-1 md:mb-2">دعوات وتوزيعات</h3>
                        <p class="text-xs md:text-sm opacity-90 mb-2">دعوات وتوزيعات</p>
                        <div class="text-xs opacity-80 space-y-1">
                            <div>💒 دعوة زفاف</div>
                            <div>💍 دعوة خطوبة</div>
                            <div>🍫 توزيعات بالشوكولاتة</div>
                            <div>🌸 توزيعات بالبرفان</div>
                        </div>
                    </div>
                </div>
            </a>
        </div>
    </section>

    <!-- Featured Products -->
    <section id="featured-products" class="container mx-auto px-4 py-12">
        <h2 class="text-2xl font-bold mb-6 text-center gold-text">منتجات مميزة</h2>
        
        <!-- Loading Indicator -->
        <div id="products-loading" class="text-center py-8">
            <div class="inline-flex items-center space-x-2 space-x-reverse">
                <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-yellow-600"></div>
                <span class="text-gray-600">جاري تحميل المنتجات...</span>
            </div>
        </div>
        
        <!-- Search Results Count -->
        <div id="search-results-count" class="text-center mb-4 text-gray-600"></div>
        
        <!-- Products Grid -->
        <div id="featured-products-grid" class="flex flex-nowrap overflow-x-auto gap-4 md:gap-6 pb-4">
            <!-- Products will be loaded dynamically -->
        </div>
        
        <!-- No Products Message -->
        <div id="no-products-message" class="text-center py-12 hidden">
            <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4" />
                </svg>
            </div>
            <h3 class="text-lg font-bold text-gray-700 mb-2">لا توجد منتجات متاحة</h3>
            <p class="text-gray-500">لم يتم العثور على منتجات في هذه الفئة حالياً</p>
        </div>

        <!-- Recommended Products Section -->
        <div class="mt-12">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold mb-4 gold-text">منتجات قد تُعجبك</h2>
                <p class="text-gray-600 max-w-2xl mx-auto">
                    اكتشف منتجات مميزة تم اختيارها خصيصاً لك
                </p>
            </div>
            
            <div id="recommended-products-grid" class="flex flex-nowrap overflow-x-auto gap-4 md:gap-6 pb-4">
                <!-- Recommended products will be loaded dynamically -->
            </div>
            
            <!-- Loading state for recommended products -->
            <div id="recommended-loading" class="text-center py-8">
                <div class="inline-flex items-center px-4 py-2 font-semibold leading-6 text-gray-600">
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-gray-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span class="text-gray-600">جاري تحميل المنتجات الموصى بها...</span>
                </div>
            </div>
            
            <!-- No recommended products message -->
            <div id="no-recommended-message" class="text-center py-12 hidden">
                <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                    </svg>
                </div>
                <h3 class="text-lg font-bold text-gray-700 mb-2">لا توجد منتجات موصى بها حالياً</h3>
                <p class="text-gray-500">سنقوم بإضافة منتجات جديدة قريباً</p>
            </div>
        </div>
    </section>

    <!-- Advertise Section -->
    <section class="bg-gradient-to-r from-yellow-50 to-pink-50 py-16">
        <div class="container mx-auto px-4">
            <div class="max-w-4xl mx-auto text-center">
                <h2 class="text-3xl md:text-4xl font-bold text-gray-800 mb-6">أعلن معنا وزد من مبيعاتك</h2>
                <p class="text-xl text-gray-600 mb-8">
                    هل تريد أن تظهر منتجاتك في أماكن بارزة؟ احصل على الإعلانات المميزة ووصل لعملاء جدد
                </p>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                            </svg>
                        </div>
                        <h3 class="font-bold text-lg mb-2">ظهور مميز</h3>
                        <p class="text-gray-600">في الصفحة الرئيسية وصفحات التصنيفات</p>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="w-12 h-12 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-6 h-6 text-pink-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
                            </svg>
                        </div>
                        <h3 class="font-bold text-lg mb-2">جمهور أكبر</h3>
                        <p class="text-gray-600">وصل لعملاء جدد ومهتمين</p>
                    </div>
                    
                    <div class="bg-white p-6 rounded-lg shadow-md">
                        <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <h3 class="font-bold text-lg mb-2">نتائج مضمونة</h3>
                        <p class="text-gray-600">زيادة في المبيعات بنسبة تصل إلى 300%</p>
                    </div>
                </div>
                
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <a href="pages/advertise-with-us.html#contact" class="bg-gradient-to-r from-yellow-500 to-yellow-600 text-white px-8 py-4 rounded-lg text-lg font-semibold hover:from-yellow-600 hover:to-yellow-700 transform hover:scale-105 transition-all duration-200">
                        ابدأ في الإعلان الآن
                    </a>
                    <a href="pages/advertise-with-us.html#features" class="bg-white text-gray-700 px-8 py-4 rounded-lg text-lg font-semibold border-2 border-gray-200 hover:border-yellow-500 transition-colors">
                        تعرف على المميزات
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- About Section -->
    <section class="bg-white py-12">
        <div class="container mx-auto px-4">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold mb-4 gold-text">عن زِينَة</h2>
                <p class="text-gray-600 max-w-2xl mx-auto">
                    زِينَة هي وجهتك الأولى لجميع احتياجات حفلات الخطوبة. نقدم مجموعة متنوعة من الكوشات والحلويات والمشروبات بأعلى جودة وأفضل الأسعار.
                </p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="text-center">
                    <div class="w-16 h-16 bg-pink-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-pink-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                        </svg>
                    </div>
                    <h3 class="font-bold text-lg mb-2">جودة عالية</h3>
                    <p class="text-gray-600">نختار أفضل المواد وأجودها لضمان رضاك التام</p>
                </div>
                
                <div class="text-center">
                    <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <h3 class="font-bold text-lg mb-2">توصيل سريع</h3>
                    <p class="text-gray-600">نضمن وصول طلبك في الوقت المحدد وبأفضل حالة</p>
                </div>
                
                <div class="text-center">
                    <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-yellow-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                        </svg>
                    </div>
                    <h3 class="font-bold text-lg mb-2">خدمة متميزة</h3>
                    <p class="text-gray-600">فريق خدمة العملاء متاح دائماً لمساعدتك</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Product Request Section -->
    <section id="product-request-section" class="bg-gray-50 py-12">
        <div class="container mx-auto px-4">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold mb-4 gold-text">أضف منتجك</h2>
                <p class="text-gray-600 max-w-2xl mx-auto">
                    هل لديك منتجات جميلة تريد عرضها؟ أرسل لنا طلب إضافة منتج وسنقوم بمراجعته وإضافته للموقع
                </p>
            </div>
            
            <div class="max-w-4xl mx-auto">
                <form id="product-request-form" class="bg-white rounded-2xl shadow-xl p-8" novalidate>
                    <!-- تفاصيل المنتج -->
                    <div class="mb-8">
                        <h3 class="text-xl font-bold mb-4 text-gray-800">تفاصيل المنتج</h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label for="request-description" class="block text-sm font-medium text-gray-700 mb-2">وصف المنتج <span class="text-red-500">*</span></label>
                                <textarea id="request-description" name="description" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent" rows="4" placeholder="اكتب وصفاً مفصلاً للمنتج..."></textarea>
                                <div id="request-description-error" class="validation-error hidden"></div>
                            </div>
                            
                            <div>
                                <label for="request-price" class="block text-sm font-medium text-gray-700 mb-2">السعر (ج.م)</label>
                                <input type="number" id="request-price" name="price" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent" placeholder="0" min="0" step="0.01">
                                <p class="text-xs text-gray-500 mt-1">اتركه فارغاً إذا كان السعر عند الطلب</p>
                            </div>
                        </div>
                        
                                                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
                                    <div>
                                        <label for="request-category" class="block text-sm font-medium text-gray-700 mb-2">التصنيف الرئيسي <span class="text-red-500">*</span></label>
                                        <select id="request-category" name="category" required class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent">
                                            <option value="">اختر التصنيف</option>
                                            <option value="koshat">كوشات</option>
                                            <option value="mirr">مرايا</option>
                                            <option value="cake">تورتات وشكولاتات</option>
                                            <option value="other">ديكورات متنوعة</option>
                                            <option value="invitations">دعوات وتوزيعات</option>
                                        </select>
                                        <div id="request-category-error" class="validation-error hidden"></div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-2">المحافظات المتوفرة <span class="text-red-500">*</span></label>
                                        <div class="simple-governorate-filter">
                                            <div class="filter-dropdown">
                                                <button type="button" id="request-governorate-dropdown-btn" class="dropdown-btn">
                                                    <span id="request-governorate-placeholder">اختر المحافظات</span>
                                                    <svg class="dropdown-arrow" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <polyline points="6,9 12,15 18,9"></polyline>
                                                    </svg>
                                                </button>
                                                <div id="request-governorate-dropdown-content" class="dropdown-content hidden">
                                                    <div class="governorate-options">
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="القاهرة" class="governorate-checkbox">
                                                            <span>القاهرة</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="الجيزة" class="governorate-checkbox">
                                                            <span>الجيزة</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="الإسكندرية" class="governorate-checkbox">
                                                            <span>الإسكندرية</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="الشرقية" class="governorate-checkbox">
                                                            <span>الشرقية</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="الغربية" class="governorate-checkbox">
                                                            <span>الغربية</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="المنوفية" class="governorate-checkbox">
                                                            <span>المنوفية</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="القليوبية" class="governorate-checkbox">
                                                            <span>القليوبية</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="البحيرة" class="governorate-checkbox">
                                                            <span>البحيرة</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="كفر الشيخ" class="governorate-checkbox">
                                                            <span>كفر الشيخ</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="دمياط" class="governorate-checkbox">
                                                            <span>دمياط</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="الدقهلية" class="governorate-checkbox">
                                                            <span>الدقهلية</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="المنيا" class="governorate-checkbox">
                                                            <span>المنيا</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="أسيوط" class="governorate-checkbox">
                                                            <span>أسيوط</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="سوهاج" class="governorate-checkbox">
                                                            <span>سوهاج</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="قنا" class="governorate-checkbox">
                                                            <span>قنا</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="الأقصر" class="governorate-checkbox">
                                                            <span>الأقصر</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="أسوان" class="governorate-checkbox">
                                                            <span>أسوان</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="بني سويف" class="governorate-checkbox">
                                                            <span>بني سويف</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="الفيوم" class="governorate-checkbox">
                                                            <span>الفيوم</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="الوادي الجديد" class="governorate-checkbox">
                                                            <span>الوادي الجديد</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="مطروح" class="governorate-checkbox">
                                                            <span>مطروح</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="شمال سيناء" class="governorate-checkbox">
                                                            <span>شمال سيناء</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="جنوب سيناء" class="governorate-checkbox">
                                                            <span>جنوب سيناء</span>
                                                        </label>
                                                        <label class="governorate-option">
                                                            <input type="checkbox" value="البحر الأحمر" class="governorate-checkbox">
                                                            <span>البحر الأحمر</span>
                                                        </label>
                                                    </div>
                                                    <div class="dropdown-actions">
                                                        <button type="button" id="request-select-all-governorates" class="action-btn">تحديد الكل</button>
                                                        <button type="button" id="request-clear-all-governorates" class="action-btn">إلغاء الكل</button>
                                                    </div>
                                                </div>
                                            </div>
                                            <div id="request-selected-governorates" class="selected-governorates mt-2"></div>
                                            <div id="request-governorate-error" class="validation-error hidden"></div>
                                        </div>
                                        <p class="text-xs text-gray-500 mt-1">يمكنك اختيار أكثر من محافظة إذا كان المنتج متوفر في عدة محافظات</p>
                                    </div>
                                </div>
                                
                                <!-- التصنيف الفرعي -->
                                <div class="mt-6" id="request-subcategory-group" style="display: none;">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">التصنيف الفرعي <span class="text-red-500">*</span></label>
                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3" id="request-subcategory-options">
                                        <!-- خيارات التصنيف الفرعي ستظهر هنا -->
                                    </div>
                                    <div id="request-subcategory-error" class="validation-error hidden"></div>
                                    <p class="text-xs text-gray-500 mt-1">اختر التصنيف الفرعي المناسب</p>
                                </div>
                                
                                <!-- المناطق/المدن -->
                                <div class="mt-6" id="request-cities-group" style="display: none;">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">المناطق/المدن المتوفرة (اختياري)</label>
                                    <div id="request-cities-container">
                                        <div class="cities-filter-container">
                                            <div class="cities-header">
                                                <div class="cities-trigger" id="request-cities-trigger">
                                                    <div class="trigger-content">
                                                        <svg class="location-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                                                            <circle cx="12" cy="10" r="3"></circle>
                                                        </svg>
                                                        <span class="trigger-text">اختر المناطق/المدن (اختياري)</span>
                                                        <span class="selected-count" id="request-cities-selected-count"></span>
                                                    </div>
                                                    <svg class="chevron-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                        <polyline points="6,9 12,15 18,9"></polyline>
                                                    </svg>
                                                </div>
                                            </div>
                                            
                                            <div class="cities-dropdown" id="request-cities-dropdown">
                                                <div class="dropdown-header">
                                                    <div class="search-container">
                                                        <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <circle cx="11" cy="11" r="8"></circle>
                                                            <path d="m21 21-4.35-4.35"></path>
                                                        </svg>
                                                        <input type="text" id="request-cities-search" placeholder="ابحث عن منطقة..." class="search-input">
                                                    </div>
                                                    <div class="actions">
                                                        <button type="button" id="request-select-all-cities-btn" class="action-btn">تحديد الكل</button>
                                                        <button type="button" id="request-clear-all-cities-btn" class="action-btn">إلغاء الكل</button>
                                                    </div>
                                                </div>
                                                
                                                <div class="cities-list" id="request-cities-list">
                                                    <!-- المدن ستظهر هنا -->
                                                </div>
                                                
                                                <div class="dropdown-footer">
                                                    <button type="button" id="request-apply-cities-filter" class="apply-btn">
                                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                                            <polyline points="20,6 9,17 4,12"></polyline>
                                                        </svg>
                                                        تطبيق الفلتر
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                        <div id="request-selected-cities" class="selected-cities"></div>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">اختر المناطق أو المدن المتوفرة داخل المحافظات المختارة (اختياري - يمكنك تخطي هذا الحقل)</p>
                                </div>
                    </div>
                    
                    <!-- معلومات التواصل -->
                    <div class="mb-8">
                        <h3 class="text-xl font-bold mb-4 text-gray-800">معلومات التواصل</h3>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">وسائل التواصل الاجتماعي <span class="text-red-500">*</span></label>
                            <p class="text-sm text-gray-500 mb-3">يجب ملء حقل واحد على الأقل من الحقول التالية:</p>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                                <div>
                                    <label for="request-whatsapp" class="block text-sm font-medium text-gray-600 mb-2">رقم الواتساب</label>
                                    <input type="tel" id="request-whatsapp" name="whatsapp" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent" placeholder="+20 123 456 7890">
                                    <div id="request-whatsapp-error" class="validation-error hidden"></div>
                                </div>
                                
                                <div>
                                                                    <label for="request-facebook" class="block text-sm font-medium text-gray-600 mb-2">رابط فيسبوك</label>
                                <input type="url" id="request-facebook" name="facebook" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent" placeholder="https://facebook.com/username">
                                <p class="text-xs text-gray-500 mt-1">يقبل جميع أنواع روابط الفيس بوك: صفحات، مجموعات، أحداث، منشورات، صور، فيديوهات، hashtags، روابط قصيرة (fb.me)</p>
                                <div id="request-facebook-error" class="validation-error hidden"></div>
                                </div>
                                
                                <div>
                                    <label for="request-instagram" class="block text-sm font-medium text-gray-600 mb-2">اسم المستخدم في الإنستجرام</label>
                                    <input type="text" id="request-instagram" name="instagram" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent" placeholder="username">
                                    <div id="request-instagram-error" class="validation-error hidden"></div>
                                </div>
                            </div>
                            
                            <div id="social-media-error" class="validation-error hidden mt-2">
                                يجب ملء حقل واحد على الأقل من وسائل التواصل الاجتماعي
                            </div>
                        </div>
                    </div>
                    
                                                    <!-- رفع الصور -->
                                <div class="mb-8">
                                    <h3 class="text-xl font-bold mb-4 text-gray-800">صور المنتج</h3>
                                    
                                    <!-- عداد الصور -->
                                    <div class="flex items-center justify-between mb-3">
                                        <span class="text-sm text-gray-600">عدد الصور المرفوعة:</span>
                                        <span id="image-counter" class="text-sm font-semibold text-green-500">0/3</span>
                                    </div>
                                    
                                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-yellow-500 transition-colors" id="request-upload-area">
                                        <input type="file" id="request-image-upload" multiple accept="image/*" class="hidden">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                                        </svg>
                                        <p class="text-lg font-medium text-gray-600 mb-2">اسحب الصور هنا أو اضغط للاختيار</p>
                                        <p class="text-sm text-gray-500">يمكنك رفع 3 صور كحد أقصى - سيتم ضغط الصور تلقائياً لتوفير المساحة</p>
                                    </div>
                                    
                                    <div id="request-image-preview" class="grid grid-cols-2 md:grid-cols-4 gap-4 mt-4">
                                        <div class="image-sort-instructions mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg col-span-2 md:col-span-4">
                                            <div class="flex items-center text-blue-700">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                                                </svg>
                                                <span class="text-sm font-medium">اسحب الصور لترتيبها - الصورة الأولى ستكون الصورة الرئيسية</span>
                                            </div>
                                        </div>
                                        <!-- معاينة الصور ستظهر هنا -->
                                                        </div>
                </div>
                    
                    <!-- Global Error Banner - Below the form, above submit button -->
                    <div id="global-error-banner" class="hidden mb-6 bg-red-600 text-white rounded-lg shadow-lg">
                        <div class="p-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-3 space-x-reverse">
                                    <svg class="w-6 h-6 text-white flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                    </svg>
                                    <div>
                                        <h3 class="font-semibold text-lg">الرجاء استكمال الحقول المطلوبة</h3>
                                        <p class="text-sm opacity-90">هناك حقول تحتاج إلى الانتباه. يُرجى مراجعة الملاحظات أسفل كل حقل.</p>
                                    </div>
                                </div>
                                <button id="close-error-banner" class="text-white hover:text-red-200 transition-colors p-2 rounded-lg hover:bg-red-700">
                                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    
                    <!-- زر الإرسال -->
                    <div class="text-center">
                        <button type="submit" class="bg-gradient-to-r from-yellow-500 to-yellow-600 text-white px-8 py-3 rounded-lg font-semibold text-lg hover:from-yellow-600 hover:to-yellow-700 transform hover:scale-105 transition-all duration-200">
                            إرسال الطلب
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <div>
                    <h3 class="font-bold text-lg mb-4">زِينَة</h3>
                    <p class="text-gray-300">وجهتك الأولى لجميع احتياجات حفلات الخطوبة</p>
                </div>
                
                <div>
                    <h4 class="font-bold mb-4">روابط سريعة</h4>
                    <ul class="space-y-2">
                        <li><a href="index.html" class="text-gray-300 hover:text-white">الرئيسية</a></li>
                        <li><a href="pages/about-us.html" class="text-gray-300 hover:text-white">من نحن</a></li>
                        <li><a href="pages/contact-us.html" class="text-gray-300 hover:text-white">اتصل بنا</a></li>
                        <li><a href="pages/advertise-with-us.html" class="text-yellow-400 hover:text-yellow-300 font-medium">⭐ أعلن معنا</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="font-bold mb-4">الفئات</h4>
                    <ul class="space-y-2">
                        <li><a href="pages/category-koshat.html" class="text-gray-300 hover:text-white">كوشات</a></li>
                        <li><a href="pages/category-mirr.html" class="text-gray-300 hover:text-white">مرايا</a></li>
                        <li><a href="pages/category-cake.html" class="text-gray-300 hover:text-white">تورتات وشكولاتات</a></li>
                        <li><a href="pages/category-other.html" class="text-gray-300 hover:text-white">ديكورات متنوعة</a></li>
                        <li><a href="pages/category-invitations.html" class="text-gray-300 hover:text-white">دعوات وتوزيعات</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="font-bold mb-4">السياسات</h4>
                    <ul class="space-y-2">
                        <li><a href="legal/privacy-policy.html" class="text-gray-300 hover:text-white">سياسة الخصوصية</a></li>
                        <li><a href="legal/terms-of-use.html" class="text-gray-300 hover:text-white">شروط الاستخدام</a></li>
                        <li><a href="legal/cookies-policy.html" class="text-gray-300 hover:text-white">سياسة الكوكيز</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="font-bold mb-4">تواصل معنا</h4>
                    <div class="space-y-2">
                        <p class="text-gray-300">الهاتف: 01016436007</p>
                        <p class="text-gray-300">البريد الإلكتروني: amrreda1945@outlook.sa</p>
                        <div class="flex space-x-4 space-x-reverse mt-4">
                            <a href="#" class="text-gray-300 hover:text-white">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"/>
                                </svg>
                            </a>
                            <a href="#" class="text-gray-300 hover:text-white">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M22.46 6c-.77.35-1.6.58-2.46.69.88-.53 1.56-1.37 1.88-2.38-.83.5-1.75.85-2.72 1.05C18.37 4.5 17.26 4 16 4c-2.35 0-4.27 1.92-4.27 4.29 0 .34.04.67.11.98C8.28 9.09 5.11 7.38 3 4.79c-.37.63-.58 1.37-.58 2.15 0 1.49.75 2.81 1.91 3.56-.71 0-1.37-.2-1.95-.5v.03c0 2.08 1.48 3.82 3.44 4.21a4.22 4.22 0 0 1-1.93.07 4.28 4.28 0 0 0 4 2.98 8.521 8.521 0 0 1-5.33 1.84c-.34 0-.68-.02-1.02-.06C3.44 20.29 5.7 21 8.12 21 16 21 20.33 14.46 20.33 8.79c0-.19 0-.37-.01-.56.84-.6 1.56-1.36 2.14-2.23z"/>
                                </svg>
                            </a>
                            <a href="#" class="text-gray-300 hover:text-white">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24">
                                    <path d="M12.017 0C5.396 0 .029 5.367.029 11.987c0 5.079 3.158 9.417 7.618 11.174-.105-.949-.199-2.403.041-3.439.219-.937 1.406-5.957 1.406-5.957s-.359-.72-.359-1.781c0-1.663.967-2.911 2.168-2.911 1.024 0 1.518.769 1.518 1.688 0 1.029-.653 2.567-.992 3.992-.285 1.193.6 2.165 1.775 2.165 2.128 0 3.768-2.245 3.768-5.487 0-2.861-2.063-4.869-5.008-4.869-3.41 0-5.409 2.562-5.409 5.199 0 1.033.394 2.143.889 2.741.099.12.112.225.085.345-.09.375-.293 1.199-.334 1.363-.053.225-.172.271-.402.165-1.495-.69-2.433-2.878-2.433-4.646 0-3.776 2.748-7.252 7.92-7.252 4.158 0 7.392 2.967 7.392 6.923 0 4.135-2.607 7.462-6.233 7.462-1.214 0-2.357-.629-2.746-1.378l-.748 2.853c-.271 1.043-1.002 2.35-1.492 3.146C9.57 23.812 10.763 24.009 12.017 24.009c6.624 0 11.99-5.367 11.99-11.988C24.007 5.367 18.641.001 12.017.001z"/>
                                </svg>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="border-t border-gray-700 mt-8 pt-8 text-center">
                <p class="text-gray-300">&copy; 2024 زِينَة. جميع الحقوق محفوظة.</p>
            </div>
        </div>
    </footer>

    <!-- Custom Sign Out Confirmation Modal -->
    <div id="signout-confirm-modal" class="custom-modal-overlay">
        <div class="custom-modal-content">
            <div class="custom-modal-icon warning">
                ⚠️
            </div>
            <h3 class="custom-modal-title">تأكيد تسجيل الخروج</h3>
            <p class="custom-modal-message">هل أنت متأكد من تسجيل الخروج؟ سيتم إغلاق جلستك الحالية.</p>
            <div class="custom-modal-buttons">
                <button class="custom-modal-btn cancel" onclick="closeSignOutModal()">إلغاء</button>
                <button class="custom-modal-btn confirm" onclick="proceedSignOut()">تأكيد الخروج</button>
            </div>
        </div>
    </div>

    <!-- Custom Success Modal -->
    <div id="signout-success-modal" class="custom-modal-overlay">
        <div class="custom-modal-content">
            <div class="custom-modal-icon success">
                ✅
            </div>
            <h3 class="custom-modal-title">تم تسجيل الخروج بنجاح</h3>
            <p class="custom-modal-message">سيتم توجيهك للصفحة الرئيسية...</p>
            <div class="custom-modal-buttons">
                <button class="custom-modal-btn success" onclick="redirectToHome()">حسناً</button>
            </div>
        </div>
    </div>



            <script>
            // Global variables
            let allProducts = [];
            let currentFilter = 'all';
            
            // UI Helper for managing navigation and UI updates
            const UIHelper = {
                // Update navigation based on user authentication and admin status
                async updateNavigation() {
                    try {
                        // Wait for AuthService to be available
                        if (!window.AuthService) {
                            console.log('⏳ Waiting for AuthService to load...');
                            await new Promise((resolve) => {
                                const checkInterval = setInterval(() => {
                                    if (window.AuthService) {
                                        clearInterval(checkInterval);
                                        console.log('✅ AuthService loaded');
                                        resolve();
                                    }
                                }, 100);
                                
                                setTimeout(() => {
                                    clearInterval(checkInterval);
                                    console.error('❌ AuthService not loaded after 5 seconds');
                                    resolve();
                                }, 5000);
                            });
                        }
                        
                        if (!window.AuthService) {
                            console.error('❌ AuthService not available');
                            return;
                        }
                        
                        const isLoggedIn = await window.AuthService.isLoggedIn();
                        const user = await window.AuthService.getCurrentUser();
                        
                        // Check if user is admin
                        let isAdmin = false;
                        if (isLoggedIn && user) {
                            try {
                                // Check user role from database
                                const { data: userProfile, error } = await window.supabaseClient
                                    .from('users')
                                    .select('role')
                                    .eq('id', user.id)
                                    .single();
                                
                                if (!error && userProfile) {
                                    isAdmin = userProfile.role === 'admin';
                                }
                            } catch (error) {
                                console.error('Error checking admin status:', error);
                            }
                        }
                        
                        // Update desktop navigation - Show admin dashboard button in header
                        const adminDashboardBtnDesktop = document.getElementById('admin-dashboard-btn-desktop');
                        if (adminDashboardBtnDesktop) {
                            if (isAdmin) {
                                adminDashboardBtnDesktop.classList.remove('hidden');
                                console.log('✅ Admin dashboard button shown in desktop header');
                            } else {
                                adminDashboardBtnDesktop.classList.add('hidden');
                            }
                        }
                        
                        // Update mobile navigation - Show admin dashboard button in header
                        const adminDashboardBtnMobile = document.getElementById('admin-dashboard-btn-mobile');
                        if (adminDashboardBtnMobile) {
                            if (isAdmin) {
                                adminDashboardBtnMobile.classList.remove('hidden');
                                console.log('✅ Admin dashboard button shown in mobile header');
                            } else {
                                adminDashboardBtnMobile.classList.add('hidden');
                            }
                        }
                        
                        // Update mobile menu - Show admin section
                        const adminMenuMobile = document.getElementById('admin-menu-mobile');
                        if (adminMenuMobile) {
                            if (isAdmin) {
                                adminMenuMobile.classList.remove('hidden');
                                console.log('✅ Admin menu shown in mobile menu');
                            } else {
                                adminMenuMobile.classList.add('hidden');
                            }
                        }
                        
                        // Mobile navigation is now handled by the buttons in header
                        
                        console.log('✅ Navigation updated successfully');
                    } catch (error) {
                        console.error('❌ Error updating navigation:', error);
                    }
                },
                
                // Show success message
                showSuccess(message) {
                    console.log('✅ Success:', message);
                    
                    // Create success notification
                    const successDiv = document.createElement('div');
                    successDiv.className = 'fixed top-4 right-4 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg z-50';
                    successDiv.innerHTML = `
                        <div class="flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                            </svg>
                            ${message}
                        </div>
                    `;
                    document.body.appendChild(successDiv);
                    
                    // Remove after 3 seconds
                    setTimeout(() => {
                        successDiv.remove();
                    }, 3000);
                }
            };
            

        

            
            // Confirm sign out function
            function confirmSignOut() {
                document.getElementById('signout-confirm-modal').classList.add('active');
            }
            
            // Close sign out confirmation modal
            function closeSignOutModal() {
                document.getElementById('signout-confirm-modal').classList.remove('active');
            }
            
            // Proceed with sign out
            async function proceedSignOut() {
                closeSignOutModal();
                await handleSignOut();
            }
            
            // Show success modal and redirect
            function showSignOutSuccess() {
                document.getElementById('signout-success-modal').classList.add('active');
            }
            
            // Redirect to home page
            function redirectToHome() {
                window.location.href = 'index.html';
            }
            
            // Global sign out function
            async function handleSignOut() {
                try {
                    // Wait for AuthService to be available
                    if (!window.AuthService) {
                        console.error('❌ AuthService not available');
                        alert('خطأ في تحميل خدمة المصادقة');
                        return;
                    }
                    
                    const result = await window.AuthService.signOut();
                    if (result.success) {
                        showSignOutSuccess();
                        // Redirect after 2 seconds
                        setTimeout(() => {
                            redirectToHome();
                        }, 2000);
                    } else {
                        alert('حدث خطأ أثناء تسجيل الخروج: ' + (result.error || 'خطأ غير معروف'));
                    }
                } catch (error) {
                    console.error('Sign out error:', error);
                    alert('حدث خطأ أثناء تسجيل الخروج: ' + error.message);
                }
            }
            
        // Update favorites count badge
        function updateFavoritesCountBadge() {
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            const count = favorites.length;
            
            console.log('🔄 Updating favorites count badge:', count);
            console.log('📋 Favorites:', favorites);
            
            // Update all badges
            const badges = [
                'favorites-count-badge',
                'favorites-count-badge-mobile',
                'favorites-count-badge-auth',
                'favorites-count-badge-mobile-auth',
                'favorites-count-badge-desktop'
            ];
            
            badges.forEach(badgeId => {
                const badge = document.getElementById(badgeId);
                if (badge) {
                    console.log(`✅ Found badge: ${badgeId}`);
                    if (count > 0) {
                        badge.textContent = count;
                        badge.classList.remove('hidden');
                        console.log(`📊 Updated ${badgeId} to show: ${count}`);
                    } else {
                        badge.classList.add('hidden');
                        console.log(`📊 Hidden ${badgeId} (count: 0)`);
                    }
                } else {
                    console.log(`❌ Badge not found: ${badgeId}`);
                }
            });
        }

        // Update auth buttons (mobile and desktop)
        async function updateMobileAuthButtons() {
                // Wait for AuthService to be available
                if (!window.AuthService) {
                    console.log('⏳ Waiting for AuthService to load...');
                    await new Promise((resolve) => {
                        const checkInterval = setInterval(() => {
                            if (window.AuthService) {
                                clearInterval(checkInterval);
                                console.log('✅ AuthService loaded');
                                resolve();
                            }
                        }, 100);
                        
                        setTimeout(() => {
                            clearInterval(checkInterval);
                            console.error('❌ AuthService not loaded after 5 seconds');
                            resolve();
                        }, 5000);
                    });
                }
                
                if (!window.AuthService) {
                    console.error('❌ AuthService not available');
                    return;
                }
                
                const isLoggedIn = await window.AuthService.isLoggedIn();
                const user = await window.AuthService.getCurrentUser();
                const mobileAuthButtons = document.querySelector('.auth-buttons-mobile');
                const desktopAuthButtons = document.querySelector('.auth-buttons');
                
                
                // Update mobile auth buttons
                if (mobileAuthButtons) {
                    if (isLoggedIn) {
                        mobileAuthButtons.innerHTML = `
                            <span class="block py-2 text-gray-700">مرحباً، ${user?.user_metadata?.full_name || user?.email}</span>
                            <button onclick="confirmSignOut()" class="block py-2 text-red-600 font-medium">تسجيل الخروج</button>
                        `;
            
                    } else {
                        mobileAuthButtons.innerHTML = `
                            <!-- تم إزالة المفضلة لأنها موجودة في الهيدر -->
                        `;
            
                    }
                }
                
                // Update desktop auth buttons
                if (desktopAuthButtons) {
                    if (isLoggedIn) {
                        desktopAuthButtons.innerHTML = `
                            <span class="text-gray-700 mr-2">مرحباً، ${user?.user_metadata?.full_name || user?.email}</span>
                            <button onclick="confirmSignOut()" class="px-6 py-2 text-red-600 border-2 border-red-600 rounded-full font-medium hover:bg-red-600 hover:text-white transition-all">
                                تسجيل الخروج
                            </button>
                        `;
            
                    } else {
                        desktopAuthButtons.innerHTML = `
                            <!-- تم إزالة زر تسجيل الدخول -->
                        `;
            
                    }
                }
                
                // Update navigation (including admin button)
                await UIHelper.updateNavigation();
                
                // Update favorites count badge
                updateFavoritesCountBadge();
            }
            
            // Load and display products
            async function loadProducts() {
                try {
                    console.log('🎯 loadProducts() called - Starting to load featured advertisements...');
                    
                    // إظهار مؤشر التحميل
                    const loadingIndicator = document.getElementById('products-loading');
                    const productsGrid = document.getElementById('featured-products-grid');
                    const noProductsMessage = document.getElementById('no-products-message');
                    
                    if (loadingIndicator) {
                        loadingIndicator.style.display = 'block';
                        console.log('📱 Loading indicator shown');
                    }
                    if (productsGrid) {
                        productsGrid.style.display = 'none';
                        console.log('📱 Products grid hidden');
                    }
                    if (noProductsMessage) {
                        noProductsMessage.style.display = 'none';
                        console.log('📱 No products message hidden');
                    }
                    
                    // التحقق من خدمة الإعلانات
                    if (!window.advertisingService) {
                        console.error('❌ AdvertisingService not available!');
                        throw new Error('AdvertisingService not available');
                    }
                    
                    console.log('✅ AdvertisingService is available, proceeding...');
                    
                    // استخدام خدمة الإعلانات لجلب المنتجات المميزة
                    console.log('🔍 Calling advertisingService.getFeaturedProducts(8)...');
                    const featuredAds = await window.advertisingService.getFeaturedProducts(8);
                    console.log('📊 Featured advertisements result:', featuredAds);
                    console.log('📊 Featured advertisements length:', featuredAds ? featuredAds.length : 'null');
                    
                    // إخفاء مؤشر التحميل
                    if (loadingIndicator) {
                        loadingIndicator.style.display = 'none';
                        console.log('📱 Loading indicator hidden');
                    }
                    
                    if (featuredAds && featuredAds.length > 0) {
                        console.log(`✅ Successfully loaded ${featuredAds.length} featured advertisements`);
                        
                        // تعيين المنتجات
                        allProducts = featuredAds;
                        console.log('📦 allProducts set to:', allProducts);
                        
                        // خلط المنتجات عشوائياً
                        shuffleProducts();
                        console.log(`🔄 After shuffle: ${allProducts.length} products`);
                        
                        // جعل البيانات متاحة عالمياً للنظام
                        window.allProducts = allProducts;
                        console.log('🌍 window.allProducts set');
                        
                        // تطبيق الفلتر
                        applyFilter(currentFilter);
                        console.log('🔍 Filter applied');
                        
                        // إظهار الشبكة
                        if (productsGrid) {
                            productsGrid.style.display = 'flex';
                            console.log('📱 Products grid shown');
                        }
                        
                        // تسجيل ظهور الإعلانات
                        featuredAds.forEach(product => {
                            if (product.ad_id) {
                                console.log(`📊 Recording impression for ad: ${product.ad_id}`);
                                window.advertisingService.recordImpression(product.ad_id);
                            }
                        });
                        
                    } else {
                        console.log('⚠️ No featured advertisements found, trying regular products...');
                        // إذا لم توجد إعلانات، جرب المنتجات العادية
                        if (window.ProductService) {
                            const featuredResult = await window.ProductService.getFeaturedProducts(4);
                            if (featuredResult.success) {
                                allProducts = featuredResult.data;
                                shuffleProducts();
                                window.allProducts = allProducts;
                                applyFilter(currentFilter);
                                
                                if (productsGrid) {
                                    productsGrid.style.display = 'flex';
                                }
                            }
                        } else {
                            // إظهار رسالة عدم وجود منتجات
                            if (noProductsMessage) {
                                noProductsMessage.style.display = 'block';
                                console.log('📱 No products message shown');
                            }
                        }
                    }
                } catch (error) {
                    console.error('❌ خطأ في تحميل المنتجات المميزة:', error);
                    // إخفاء مؤشر التحميل
                    const loadingIndicator = document.getElementById('products-loading');
                    if (loadingIndicator) {
                        loadingIndicator.style.display = 'none';
                        console.log('📱 Loading indicator hidden due to error');
                    }
                    
                    // إظهار رسالة الخطأ
                    const noProductsMessage = document.getElementById('no-products-message');
                    if (noProductsMessage) {
                        noProductsMessage.querySelector('h3').textContent = 'خطأ في تحميل المنتجات';
                        noProductsMessage.querySelector('p').textContent = 'حدث خطأ أثناء تحميل المنتجات. يرجى المحاولة مرة أخرى.';
                        noProductsMessage.style.display = 'block';
                        console.log('📱 Error message shown');
                    }
                }
            }
            
            // خلط المنتجات عشوائياً (جميع المنتجات من جميع الفئات)
            function shuffleProducts() {
                console.log('🔄 Starting shuffleProducts, initial count:', allProducts ? allProducts.length : 0);
                
                if (allProducts && allProducts.length > 1) {
                    // خلط جميع المنتجات عشوائياً
                    const shuffled = [...allProducts];
                    for (let i = shuffled.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                    }
                    allProducts = shuffled;
                    console.log('🔄 تم خلط جميع المنتجات عشوائياً');
                } else {
                    console.log('⚠️ No products to shuffle or only one product');
                }
            }
            
            // Display products in grid
            function displayProducts(products, containerId) {
                console.log('🎨 Displaying products:', products ? products.length : 0, 'in container:', containerId);
                console.log('📋 Products data:', products);
                
                const container = document.getElementById(containerId);
                let noProductsMessage;
                
                // البحث عن رسالة عدم وجود منتجات حسب نوع الحاوية
                if (containerId === 'recommended-products-grid') {
                    noProductsMessage = document.getElementById('no-recommended-message');
                } else {
                    noProductsMessage = document.getElementById('no-products-message');
                }
                
                if (!container) {
                    console.error('❌ لم يتم العثور على الحاوية:', containerId);
                    return;
                }
                
                console.log('📦 Container found:', container);
                
                if (!products || products.length === 0) {
                    console.log('⚠️ No products to display');
                    container.style.display = 'none';
                    if (noProductsMessage) {
                        noProductsMessage.style.display = 'block';
                    }
                    return;
                }
                
                // إظهار الشبكة وإخفاء رسالة عدم وجود منتجات
                container.style.display = 'flex';
                if (noProductsMessage) {
                    noProductsMessage.style.display = 'none';
                }
                
                container.innerHTML = products.map(product => {
                    console.log('🎯 Processing product:', product);
                    console.log('📢 معرف الإعلان:', product.ad_id);
                    console.log('🆔 معرف المنتج:', product.product_id || product.id);
                    
                    // التعامل مع الإعلانات والمنتجات العادية
                    let imageUrls, mainImageUrl, hasMultipleImages, productName, productPrice;
                    
                    if (product.ad_id) {
                        // هذا إعلان
                        console.log('✅ هذا منتج إعلاني مع معرف:', product.ad_id);
                        imageUrls = product.image_url ? [product.image_url] : ['https://placehold.co/300x200/EEE/31343C?text=لا+توجد+صورة'];
                        mainImageUrl = imageUrls[0];
                        hasMultipleImages = false;
                        productName = product.name || product.description || 'منتج مميز';
                        productPrice = product.price || 0;
                    } else {
                        // هذا منتج عادي
                        console.log('ℹ️ هذا منتج عادي بدون إعلان');
                        imageUrls = product.image_urls && product.image_urls.length > 0 
                            ? product.image_urls 
                            : ['https://placehold.co/300x200/EEE/31343C?text=لا+توجد+صورة'];
                        mainImageUrl = imageUrls[0];
                        hasMultipleImages = imageUrls.length > 1;
                        productName = product.description || 'منتج';
                        productPrice = product.price || 0;
                    }
                    
                    return `
                    <div class="product-card bg-white rounded-lg overflow-hidden ${product.product_id ? 'cursor-pointer' : 'cursor-default'} flex-shrink-0 w-80" data-product-id="${product.product_id || product.id}" data-ad-id="${product.ad_id || ''}" ${product.product_id ? `onclick="openProductDetails('${product.product_id}', '${product.ad_id || ''}')"` : ''}>
                        <div class="relative product-image-container" style="height: 192px;">
                            <!-- حاوية السلايدر -->
                            <div class="slideshow-container" data-product-id="${product.product_id || product.id}" data-images='${JSON.stringify(imageUrls)}'>
                                ${imageUrls.map((url, index) => `
                                    <img src="${url}" 
                                         alt="${productName}" 
                                         class="slideshow-image ${index === 0 ? 'active' : ''}"
                                         loading="lazy"
                                         decoding="async">
                                `).join('')}
                                
                                <!-- مؤشرات الصور -->
                                ${imageUrls.length > 1 ? `
                                    <div class="slideshow-indicators">
                                        ${imageUrls.map((_, index) => `
                                            <span class="indicator ${index === 0 ? 'active' : ''}" data-slide="${index}"></span>
                                        `).join('')}
                                    </div>
                                ` : ''}
                                
                                <!-- شارة عدد الصور -->
                                ${imageUrls.length > 1 ? `
                                    <div class="multiple-images-badge">
                                        ${imageUrls.length} صور
                                    </div>
                                ` : ''}
                            </div>
                            
                            <div class="absolute top-2 left-2 bg-green-500 text-white text-xs px-2 py-1 rounded-full">متاح</div>
                            ${product.is_paid_ad ? '<div class="absolute top-2 right-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold">مدفوع</div>' : (product.ad_id ? '<div class="absolute top-2 right-2 bg-yellow-500 text-white text-xs px-2 py-1 rounded-full">مميز</div>' : '')}
                            
                            <!-- أيقونة المفضلة -->
                            <div class="absolute bottom-2 right-2" style="z-index: 20;">
                                <button class="favorite-btn bg-white rounded-full p-2 shadow-lg hover:bg-pink-50 transition-all duration-200" 
                                        data-product-id="${product.product_id || product.id}"
                                        data-product-name="${productName}"
                                        data-product-image="${mainImageUrl}"
                                        data-product-price="${productPrice}"
                                        data-product-governorate="${product.governorate || ''}"
                                        data-product-cities="${product.cities || ''}"
                                        data-product-subcategory="${JSON.stringify(product.subcategory || [])}">
                                    <svg class="w-5 h-5 ${isFavorite(product.product_id || product.id) ? 'text-red-500 fill-current' : 'text-gray-400'}" viewBox="0 0 24 24">
                                        <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="p-4">
                            <div class="mb-2">
                                <span class="text-gray-500 text-sm">${getCategoryName(product.category)}</span>
                            </div>
                            <div class="mb-2">
                                ${(() => {
                                    if (product.subcategory) {
                                        let subcategoryValue = null;
                                        
                                        // Handle different formats of subcategory
                                        if (Array.isArray(product.subcategory) && product.subcategory.length > 0) {
                                            subcategoryValue = product.subcategory[0];
                                        } else if (typeof product.subcategory === 'string') {
                                            // Try to parse JSON string
                                            try {
                                                const parsed = JSON.parse(product.subcategory);
                                                if (Array.isArray(parsed) && parsed.length > 0) {
                                                    subcategoryValue = parsed[0];
                                                } else if (typeof parsed === 'string') {
                                                    subcategoryValue = parsed;
                                                }
                                            } catch (e) {
                                                // If not JSON, treat as regular string
                                                if (product.subcategory.trim() !== '') {
                                                    subcategoryValue = product.subcategory;
                                                }
                                            }
                                        }
                                        
                                        if (subcategoryValue) {
                                            return `<span class='inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full mr-1 mb-1'>${getSubcategoryName(subcategoryValue)}</span>`;
                                        }
                                    }
                                    return '';
                                })()}
                            </div>

                            <div class="mb-2">
                                <span class="font-bold gold-text">${productPrice > 0 ? productPrice + ' جنيه' : 'السعر عند الطلب'}</span>
                            </div>
                            <div class="mb-2">
                                <div class="flex flex-wrap gap-1">
                                    ${product.governorate ? `<span class="inline-flex items-center bg-gray-100 text-gray-800 text-xs px-2 py-1 rounded-full whitespace-nowrap">${product.governorate}</span>` : ''}
                                    ${product.cities ? `<span class="inline-flex items-center bg-blue-100 text-blue-700 text-xs px-2 py-1 rounded-full whitespace-nowrap">${product.cities.split(',')[0].trim()}</span>` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                }).join('');
                
                // تهيئة العرض المتحرك التلقائي المحسن للصور بعد إنشاء البطاقات
                setTimeout(() => {
                    if (window.enhancedAutoSlideshow) {
                        window.enhancedAutoSlideshow.setupSlideshows();
                    }
                }, 100); // Reduced timeout for faster initialization
                
                // إعداد سلايدر المنتجات الجديد
                setTimeout(() => {
                    setupProductSlideshows();
                }, 150);
                
                // تحديث أيقونات المفضلة بعد عرض المنتجات
                setTimeout(() => {
                    updateAllFavoriteIcons();
                    setupFavoriteButtons();
                }, 200);

            }

        // ===== وظائف إدارة المفضلة =====
        
        // إعداد سلايدر المنتجات
        function setupProductSlideshows() {
            // تنظيف السلايدرات القديمة
            const oldSlideshows = document.querySelectorAll('.slideshow-container[data-initialized="true"]');
            oldSlideshows.forEach(container => {
                const interval = container.dataset.slideInterval;
                if (interval) {
                    clearInterval(parseInt(interval));
                }
                container.removeEventListener('mouseenter', container._stopAutoSlide);
                container.removeEventListener('mouseleave', container._startAutoSlide);
                delete container.dataset.initialized;
                delete container.dataset.slideInterval;
                delete container._stopAutoSlide;
                delete container._startAutoSlide;
            });
            
            const slideshowContainers = document.querySelectorAll('.slideshow-container:not([data-initialized="true"])');
            console.log('🖼️ Setting up product slideshows:', slideshowContainers.length);
            
            slideshowContainers.forEach((container, index) => {
                const images = container.querySelectorAll('.slideshow-image');
                const indicators = container.querySelectorAll('.indicator');
                
                if (images.length <= 1) return;
                
                let currentSlide = 0;
                let slideInterval;
                
                // دالة إظهار صورة معينة
                const showSlide = (slideIndex) => {
                    // إخفاء جميع الصور
                    images.forEach(img => img.classList.remove('active'));
                    
                    // إظهار الصورة المحددة
                    if (images[slideIndex]) {
                        images[slideIndex].classList.add('active');
                    }
                    
                    // تحديث المؤشرات
                    indicators.forEach(ind => ind.classList.remove('active'));
                    if (indicators[slideIndex]) {
                        indicators[slideIndex].classList.add('active');
                    }
                    
                    currentSlide = slideIndex;
                };
                
                // دالة الانتقال للصورة التالية
                const nextSlide = () => {
                    const next = (currentSlide + 1) % images.length;
                    showSlide(next);
                };
                
                // بدء العرض التلقائي
                const startAutoSlide = () => {
                    slideInterval = setInterval(nextSlide, 3000); // 3 ثواني
                    container.dataset.slideInterval = slideInterval;
                };
                
                // إيقاف العرض التلقائي
                const stopAutoSlide = () => {
                    if (slideInterval) {
                        clearInterval(slideInterval);
                    }
                };
                
                // حفظ الدوال للتنظيف لاحقاً
                container._startAutoSlide = startAutoSlide;
                container._stopAutoSlide = stopAutoSlide;
                
                // إضافة أحداث النقر على المؤشرات
                indicators.forEach((indicator, indIndex) => {
                    indicator.addEventListener('click', () => {
                        showSlide(indIndex);
                        stopAutoSlide();
                        startAutoSlide(); // إعادة تشغيل
                    });
                });
                
                // إضافة أحداث التمرير
                container.addEventListener('mouseenter', stopAutoSlide);
                container.addEventListener('mouseleave', startAutoSlide);
                
                // إضافة معالجة الأخطاء للصور
                images.forEach((img, imgIndex) => {
                    img.addEventListener('error', () => {
                        console.warn(`⚠️ Image ${imgIndex + 1} failed to load in slideshow ${index + 1}`);
                        img.src = 'https://placehold.co/300x200/EEE/31343C?text=خطأ+في+تحميل+الصورة';
                    });
                    
                    img.addEventListener('load', () => {
                        console.log(`✅ Image ${imgIndex + 1} loaded successfully in slideshow ${index + 1}`);
                    });
                });
                
                // بدء العرض التلقائي
                startAutoSlide();
                
                // تحديد أن السلايدر تم تهيئته
                container.dataset.initialized = "true";
                
                console.log(`✅ Slideshow ${index + 1} setup complete with ${images.length} images`);
            });
        }
        
        // إعداد أزرار المفضلة
        function setupFavoriteButtons() {
            const favoriteButtons = document.querySelectorAll('.favorite-btn');
            console.log('🔘 Setting up favorite buttons:', favoriteButtons.length);
            
            favoriteButtons.forEach(button => {
                // إزالة event listeners السابقة لتجنب التكرار
                button.removeEventListener('click', handleFavoriteClick);
                
                // إضافة event listener جديد
                button.addEventListener('click', handleFavoriteClick);
            });
        }
        
        // معالج النقر على أزرار المفضلة
        function handleFavoriteClick(event) {
            event.stopPropagation(); // منع انتقال الحدث للعنصر الأب
            event.preventDefault(); // منع السلوك الافتراضي
            
            console.log('❤️ Favorite button clicked!');
            
            const button = event.currentTarget;
            const productId = button.getAttribute('data-product-id');
            const productName = button.getAttribute('data-product-name');
            const productImage = button.getAttribute('data-product-image');
            const productPrice = parseInt(button.getAttribute('data-product-price')) || 0;
            const productGovernorate = button.getAttribute('data-product-governorate');
            const productCities = button.getAttribute('data-product-cities');
            const productSubcategory = button.getAttribute('data-product-subcategory');
            
            console.log('❤️ Product data:', {
                id: productId,
                name: productName,
                image: productImage,
                price: productPrice,
                governorate: productGovernorate,
                cities: productCities,
                subcategory: productSubcategory
            });
            
            if (!productId) {
                console.error('❌ No product ID found!');
                showNotification('خطأ: لم يتم العثور على معرف المنتج', 'error');
                return;
            }
            
            toggleFavorite(event, productId, productName, productImage, productPrice, productGovernorate, productCities, productSubcategory);
        }
        
        // التحقق من وجود منتج في المفضلة
        function isFavorite(productId) {
            if (!productId) return false;
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            return favorites.some(item => item.id === productId);
        }

        // تبديل حالة المفضلة (إضافة/إزالة)
        function toggleFavorite(event, productId, title, imageUrl, price, governorate, cities, subcategories) {
            console.log('🔄 toggleFavorite called!');
            console.log('🔄 Toggle favorite for product:', {
                id: productId,
                title: title,
                imageUrl: imageUrl,
                price: price,
                governorate: governorate,
                cities: cities,
                subcategories: subcategories
            });
            
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            console.log('📋 Current favorites before toggle:', favorites);
            
            const existingIndex = favorites.findIndex(item => item.id === productId);
            console.log('🔍 Existing index:', existingIndex);
            
            if (existingIndex > -1) {
                // إزالة من المفضلة
                favorites.splice(existingIndex, 1);
                showNotification('تم إزالة المنتج من المفضلة', 'info');
                console.log('❌ Removed from favorites');
            } else {
                // إضافة إلى المفضلة
                const productData = {
                    id: productId,
                    title: title || 'منتج',
                    imageUrl: imageUrl,
                    price: price || 0,
                    governorate: governorate || '',
                    cities: cities || '',
                    subcategories: subcategories || '',
                    addedAt: new Date().toISOString()
                };
                favorites.push(productData);
                showNotification('تم إضافة المنتج إلى المفضلة', 'success');
                console.log('✅ Added to favorites:', productData);
            }
            
            // حفظ في Local Storage
            localStorage.setItem('favorites', JSON.stringify(favorites));
            
            // إرسال حدث مخصص لضمان التزامن مع الصفحات الأخرى
            window.dispatchEvent(new CustomEvent('favoritesChanged', {
                detail: { favorites: favorites }
            }));
            console.log('💾 Saved to localStorage, total favorites:', favorites.length);
            console.log('💾 Current localStorage favorites:', JSON.parse(localStorage.getItem('favorites')));
            
            // تحديث أيقونة القلب
            updateFavoriteIcon(productId);
            
            // تحديث عداد المفضلة
            console.log('🔄 Calling updateFavoritesCountBadge from toggleFavorite');
            updateFavoritesCountBadge();
            
            // إضافة تأكيد إضافي
            setTimeout(() => {
                const storedFavorites = JSON.parse(localStorage.getItem('favorites') || '[]');
                console.log('🔍 Verification - Stored favorites after 100ms:', storedFavorites);
                console.log('🔄 Calling updateFavoritesCountBadge again after delay');
                updateFavoritesCountBadge();
            }, 100);
        }

        // تحديث أيقونة القلب
        function updateFavoriteIcon(productId) {
            const favoriteBtn = document.querySelector(`[data-product-id="${productId}"] .favorite-btn svg`);
            if (favoriteBtn) {
                if (isFavorite(productId)) {
                    favoriteBtn.classList.remove('text-gray-400');
                    favoriteBtn.classList.add('text-red-500', 'fill-current');
                    console.log(`✅ Updated favorite icon for product ${productId}: FAVORITE (RED)`);
                } else {
                    favoriteBtn.classList.remove('text-red-500', 'fill-current');
                    favoriteBtn.classList.add('text-gray-400');
                    console.log(`✅ Updated favorite icon for product ${productId}: NOT_FAVORITE (GRAY)`);
                }
            } else {
                console.log(`⚠️ Favorite button not found for product: ${productId}`);
            }
        }

        // تحديث جميع أيقونات المفضلة
        function updateAllFavoriteIcons() {
            const productCards = document.querySelectorAll('.product-card');
            console.log('🔄 Updating favorite icons for', productCards.length, 'product cards');
            
            productCards.forEach(card => {
                const productId = card.getAttribute('data-product-id');
                if (productId) {
                    updateFavoriteIcon(productId);
                    console.log('✅ Updated icon for product:', productId);
                } else {
                    console.log('⚠️ No product ID found for card:', card);
                }
            });
            
            // تحديث عداد المفضلة أيضاً
            updateFavoritesCountBadge();
        }

        // عرض إشعار
        function showNotification(message, type = 'info') {
            // إزالة الإشعارات السابقة
            const existingNotification = document.querySelector('.notification');
            if (existingNotification) {
                existingNotification.remove();
            }

            const notification = document.createElement('div');
            notification.className = `notification fixed top-4 left-4 z-50 px-4 py-2 rounded-lg shadow-lg text-white text-sm font-medium transform transition-all duration-300 translate-x-0`;
            
            // تحديد لون الإشعار حسب النوع
            if (type === 'success') {
                notification.style.backgroundColor = '#10b981'; // أخضر
            } else if (type === 'error') {
                notification.style.backgroundColor = '#ef4444'; // أحمر
            } else {
                notification.style.backgroundColor = '#3b82f6'; // أزرق
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);

            // إخفاء الإشعار بعد 3 ثوان
            setTimeout(() => {
                notification.style.transform = 'translateX(-100%)';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }
        
        // Get category name in Arabic
        function getCategoryName(category) {
                const categories = {
                    'koshat': 'كوشات',
                    'mirr': 'مرايا',
                    'cake': 'تورتات',
                    'other': 'ديكورات متنوعة',
                    'invitations': 'دعوات وتوزيعات'
                };
                return categories[category] || category;
            }
            
            // Get subcategory name in Arabic
            function getSubcategoryName(subcategory) {
                const subcategories = {
                    // كوشات
                    'koshat-wedding': 'كوشات زفاف',
                    'koshat-engagement': 'كوشات خطوبة',
                    'koshat-birthday': 'كوشات عيد ميلاد',
                    'koshat-party': 'كوشات حفلات',
                    'koshat-corporate': 'كوشات شركات',
                    
                    // مرايا
                    'mirr-wedding': 'مرايا زفاف',
                    'mirr-engagement': 'مرايا خطوبة',
                    'mirr-birthday': 'مرايا عيد ميلاد',
                    'mirr-decorative': 'مرايا ديكور',
                    'mirr-custom': 'مرايا مخصصة',
                    
                    // تورتة
                    'cake-wedding': 'تورتة زفاف',
                    'cake-engagement': 'تورتة خطوبة',
                    'cake-birthday': 'تورتة عيد ميلاد',
                    'cake-chocolate': 'تورتة شوكولاتة',
                    'cake-fruit': 'تورتة فواكه',
                    'cake-custom': 'تورتة مخصصة',
                    
                    // ديكورات متنوعة
                    'other-birthday': 'ديكور عيد ميلاد',
                    'other-hospital': 'ديكور استقبال مستشفى',
                    'other-bride': 'ديكور استقبال عروسة',
                    'other-party': 'ديكور حفلات بسيطة',
                    'other-balloons': 'بالونات وهدايا',
                    'other-flowers': 'زهور وأزهار',
                    'other-lights': 'إضاءات ديكور',
                    
                    // دعوات
                    'invitation-wedding': 'دعوة زفاف',
                    'invitation-engagement': 'دعوة خطوبة',
                    'invitation-birthday': 'دعوة عيد ميلاد',
                    'invitation-party': 'دعوة حفلة',
                    'invitation-corporate': 'دعوة شركة'
                };
                return subcategories[subcategory] || subcategory;
        }
            
            // Format date
            function formatDate(dateString) {
                const date = new Date(dateString);
                return date.toLocaleDateString('ar-EG');
            }
            
            // Open product details page
            function openProductDetails(productId, adId = null) {
                console.log('🖱️ تم النقر على المنتج:', productId);
                
                // تسجيل النقر على الإعلان إذا كان موجوداً
                if (adId && window.advertisingService) {
                    console.log('📢 تسجيل النقر على الإعلان:', adId);
                    try {
                        window.advertisingService.recordClick(adId);
                        console.log('✅ تم تسجيل النقر بنجاح!');
                    } catch (error) {
                        console.error('❌ خطأ في تسجيل النقر:', error);
                    }
                } else {
                    // محاولة العثور على معرف الإعلان من العنصر
                    const productElement = document.querySelector(`[data-product-id="${productId}"]`);
                    if (productElement) {
                        const elementAdId = productElement.getAttribute('data-ad-id');
                        if (elementAdId && window.advertisingService) {
                            console.log('📢 تم العثور على معرف الإعلان من العنصر:', elementAdId);
                            try {
                                window.advertisingService.recordClick(elementAdId);
                                console.log('✅ تم تسجيل النقر بنجاح!');
                            } catch (error) {
                                console.error('❌ خطأ في تسجيل النقر:', error);
                            }
                        }
                    }
                }
                
                // الانتقال إلى صفحة تفاصيل المنتج
                window.location.href = `pages/product-details.html?id=${productId}`;
            }

            // Filter products by category
            function filterProducts(category) {
                if (category === 'all') {
                    return allProducts;
                }
                
                // Map Arabic category names to database values
                const categoryMap = {
                    'koshat': 'koshat',
                    'cake': 'cake',
                    'decor': 'mirr', // Assuming 'decor' maps to 'mirr' (mirrors)
                    'other': 'other'
                };
                
                const dbCategory = categoryMap[category];
                return allProducts.filter(product => product.category === dbCategory);
            }

            // Apply filter and update display
            function applyFilter(category) {
                console.log('🔍 Applying filter:', category);
                console.log('📊 All products count:', allProducts ? allProducts.length : 0);
                
                currentFilter = category;
                
                // Filter and display products
                const filteredProducts = filterProducts(category);
                console.log('📊 Filtered products count:', filteredProducts ? filteredProducts.length : 0);
                
                displayProducts(filteredProducts, 'featured-products-grid');
            }
            
            // Make loadProducts available globally
            window.loadProducts = loadProducts;

            // تحميل المنتجات المميزة والموصى بها
            async function loadFeaturedAndRecommendedProducts() {
                try {
                    console.log('🔄 بدء تحميل المنتجات المميزة والموصى بها...');
                    
                    // انتظار تحميل خدمة الإعلانات
                    let attempts = 0;
                    while (!window.advertisingService && attempts < 100) {
                        await new Promise(resolve => setTimeout(resolve, 100));
                        attempts++;
                        if (attempts % 10 === 0) {
                            console.log(`⏳ انتظار خدمة الإعلانات... (محاولة ${attempts}/100)`);
                        }
                    }
                    
                    if (!window.advertisingService) {
                        console.error('❌ فشل في تحميل خدمة الإعلانات بعد 100 محاولة');
                        return;
                    }
                    
                    console.log('✅ خدمة الإعلانات متوفرة:', window.advertisingService);

                    // تحميل المنتجات المميزة
                    const featuredProducts = await window.advertisingService.getFeaturedProducts(8);
                    if (featuredProducts && featuredProducts.length > 0) {
                        displayProducts(featuredProducts, 'featured-products-grid');
                        // تسجيل ظهور الإعلانات
                        featuredProducts.forEach(product => {
                            if (product.ad_id) {
                                window.advertisingService.recordImpression(product.ad_id);
                            }
                        });
                    }

                    // تحميل المنتجات الموصى بها
                    console.log('🔄 Loading recommended products...');
                    // تحميل المنتجات الموصى بها (5 منتجات: 1 إعلان مدفوع + 4 منتجات عشوائية)
                    const recommendedProducts = await window.advertisingService.getRecommendedProducts(5);
                    console.log('📊 Recommended products loaded:', recommendedProducts);
                    
                    if (recommendedProducts && recommendedProducts.length > 0) {
                        console.log('✅ Found recommended products, displaying...');
                        displayProducts(recommendedProducts, 'recommended-products-grid');
                        
                        // تسجيل ظهور الإعلانات
                        recommendedProducts.forEach(product => {
                            if (product.ad_id) {
                                window.advertisingService.recordImpression(product.ad_id);
                            }
                        });
                        
                                            // إخفاء رسالة التحميل
                    document.getElementById('recommended-loading').classList.add('hidden');
                    
                    // تحديث أيقونات المفضلة بعد تحميل جميع المنتجات
                    setTimeout(() => {
                        updateAllFavoriteIcons();
                        setupFavoriteButtons();
                        setupProductSlideshows();
                    }, 300);
                } else {
                    console.log('ℹ️ No recommended products available');
                    // إظهار رسالة عدم وجود منتجات موصى بها
                    document.getElementById('recommended-loading').classList.add('hidden');
                    document.getElementById('no-recommended-message').classList.remove('hidden');
                }
                } catch (error) {
                    console.error('خطأ في تحميل المنتجات المميزة والموصى بها:', error);
                    // إظهار رسالة الخطأ
                    document.getElementById('recommended-loading').classList.add('hidden');
                    document.getElementById('no-recommended-message').classList.remove('hidden');
                } finally {
                    // تحديث أيقونات المفضلة في جميع الحالات
                    setTimeout(() => {
                        updateAllFavoriteIcons();
                        setupFavoriteButtons();
                        setupProductSlideshows();
                    }, 500);
                }
            }

            // تحميل المنتجات عند تحميل الصفحة
            document.addEventListener('DOMContentLoaded', function() {
                console.log('🚀 DOM Content Loaded - Starting to load products...');
                
                // انتظار تحميل خدمة الإعلانات ثم تحميل المنتجات
                waitForAdvertisingService();
                

            });
            
            // انتظار تحميل خدمة الإعلانات
            async function waitForAdvertisingService() {
                try {
                    console.log('⏳ Waiting for AdvertisingService...');
                    
                    // انتظار خدمة الإعلانات
                    while (!window.advertisingService) {
                        await new Promise(resolve => setTimeout(resolve, 100));
                        console.log('⏳ Still waiting for AdvertisingService...');
                    }
                    
                    console.log('✅ AdvertisingService loaded, now loading products...');
                    
                    // تحميل المنتجات المميزة (الإعلانات)
                    await loadProducts();
                    
                    // تحميل المنتجات الموصى بها
                    setTimeout(loadFeaturedAndRecommendedProducts, 500);
                    
                } catch (error) {
                    console.error('❌ Error waiting for AdvertisingService:', error);
                }
            }
            
            // إضافة زر اختبار للإعلانات
            function addTestButton() {
                const container = document.querySelector('.container');
                if (container) {
                    const testButton = document.createElement('button');
                    testButton.innerHTML = '🧪 اختبار الإعلانات';
                    testButton.className = 'fixed bottom-4 right-4 bg-yellow-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                    testButton.onclick = async function() {
                        try {
                            if (window.advertisingService) {
                                const result = await window.advertisingService.debugGetAllAdvertisements();
                                if (result) {
                                    alert(`نتائج اختبار الإعلانات:\n\n📊 جميع الإعلانات: ${result.all?.length || 0}\n✅ الإعلانات النشطة: ${result.active?.length || 0}\n📅 الإعلانات بمواعيد صحيحة: ${result.validDates?.length || 0}`);
                                }
                            } else {
                                alert('خدمة الإعلانات غير متوفرة');
                            }
                        } catch (error) {
                            alert('خطأ في اختبار الإعلانات: ' + error.message);
                        }
                    };
                    document.body.appendChild(testButton);
                    
                    // إضافة زر إعادة تحميل المنتجات
                    const reloadButton = document.createElement('button');
                    reloadButton.innerHTML = '🔄 إعادة تحميل';
                    reloadButton.className = 'fixed bottom-4 right-32 bg-blue-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                    reloadButton.onclick = async function() {
                        try {
                            console.log('🔄 Manual reload triggered...');
                            await loadProducts();
                        } catch (error) {
                            console.error('❌ Error in manual reload:', error);
                            alert('خطأ في إعادة التحميل: ' + error.message);
                        }
                    };
                    document.body.appendChild(reloadButton);

                    // إضافة زر تنظيف فوري
                    const cleanupButton = document.createElement('button');
                    cleanupButton.innerHTML = '🧹 تنظيف فوري';
                    cleanupButton.className = 'fixed bottom-4 right-60 bg-red-500 text-white px-4 py-2 rounded-lg shadow-lg z-50';
                    cleanupButton.onclick = async function() {
                        try {
                            if (window.advertisingService) {
                                console.log('🧹 بدء التنظيف الفوري...');
                                await window.advertisingService.autoCleanup();
                                alert('تم التنظيف! سيتم تحديث الصفحة تلقائياً');
                                setTimeout(() => location.reload(), 2000);
                            } else {
                                alert('خدمة الإعلانات غير متوفرة');
                            }
                        } catch (error) {
                            console.error('❌ خطأ في التنظيف:', error);
                            alert('خطأ في التنظيف: ' + error.message);
                        }
                    };
                    document.body.appendChild(cleanupButton);
                }
            }
        
        // Hero Carousel JavaScript
        class HeroCarousel {
            constructor() {
                this.currentSlide = 0;
                this.slides = [
                    {
                        title: 'مرحبًا بك في زينة',
                        description: 'موقعك الأول لاختيار كل ما يخص المناسبات والأفراح. كوشات، تورتات، شوكولاتة، دعوات وديكورات.. كل ما تحتاجه لتجعل يومك مميزًا في مكان واحد.',
                        buttonText: 'ابدأ رحلتك',
                        buttonLink: '#featured-products'
                    },
                    {
                        title: 'تنوع يلبي كل الأذواق',
                        description: 'من الكوشات الفخمة إلى المرايا والدعوات الأنيقة، نوفر لك خيارات واسعة تناسب جميع الأذواق والمناسبات.',
                        buttonText: 'تصفح التصنيفات',
                        buttonLink: '#categories'
                    },
                    {
                        title: 'لأن لحظاتك تستحق الأفضل',
                        description: 'في زينة نهتم بالجودة والتفاصيل، لتجد منتجات تعكس شخصيتك وتترك أثرًا لا يُنسى في مناسبتك الخاصة.',
                        buttonText: 'اكتشف المنتجات',
                        buttonLink: '#featured-products'
                    },
                    {
                        title: 'زينة.. لمناسبات تبقى في الذاكرة',
                        description: 'ابدأ رحلتك الآن مع زينة، واختر من بين أجمل المنتجات لتصنع لحظاتك المميزة.',
                        buttonText: 'ابدأ الآن',
                        buttonLink: '#featured-products'
                    }
                ];
                
                this.carousel = document.getElementById('hero-carousel');
                this.indicatorsContainer = document.getElementById('carousel-indicators');
                
                this.init();
            }
            
            init() {
                this.createIndicators();
                this.showSlide(0);
                this.setupEventListeners();
                this.startAutoPlay();
            }
            
            createIndicators() {
                this.indicatorsContainer.innerHTML = '';
                this.slides.forEach((_, index) => {
                    const indicator = document.createElement('button');
                    indicator.className = 'carousel-indicator';
                    indicator.addEventListener('click', () => this.showSlide(index));
                    this.indicatorsContainer.appendChild(indicator);
                });
            }
            
            showSlide(index) {
                this.currentSlide = index;
                const slide = this.slides[index];
                
                // Update indicators
                const indicators = this.indicatorsContainer.querySelectorAll('.carousel-indicator');
                indicators.forEach((indicator, i) => {
                    indicator.classList.toggle('active', i === index);
                });
                
                // Update content
                this.carousel.innerHTML = `
                    <div class="flex items-center justify-center h-full">
                        <!-- Content -->
                        <div class="text-center text-gray-800 px-8 max-w-4xl">
                            <h1 class="text-3xl md:text-5xl lg:text-6xl font-bold mb-6 text-shadow-lg leading-tight">${slide.title}</h1>
                            <p class="text-lg md:text-xl lg:text-2xl text-shadow max-w-3xl mx-auto leading-relaxed opacity-90">${slide.description}</p>
                        </div>
                    </div>
                `;
            }
            
            nextSlide() {
                const nextIndex = (this.currentSlide + 1) % this.slides.length;
                this.showSlide(nextIndex);
            }
            
            prevSlide() {
                const prevIndex = (this.currentSlide - 1 + this.slides.length) % this.slides.length;
                this.showSlide(prevIndex);
            }
            
            setupEventListeners() {
                // Keyboard navigation
                document.addEventListener('keydown', (e) => {
                    if (e.key === 'ArrowLeft') {
                        this.prevSlide();
                    } else if (e.key === 'ArrowRight') {
                        this.nextSlide();
                    }
                });
            }
            
            startAutoPlay() {
                setInterval(() => {
                    this.nextSlide();
                }, 4000); // Change slide every 4 seconds
            }
        }

        // منع التمرير التلقائي عند تحميل الصفحة
        if (window.location.hash) {
            // إزالة hash من URL بدون تمرير
            history.replaceState(null, null, window.location.pathname);
        }
        
        // Simple JavaScript for basic interactions
        document.addEventListener('DOMContentLoaded', async function() {
            // Add styles for governorate display
            GovernorateDisplay.addStyles();
            
            // Initialize hero carousel
            const heroCarousel = new HeroCarousel();
            window.heroCarousel = heroCarousel; // Make it globally accessible
            
            // Update mobile auth buttons and navigation
            await updateMobileAuthButtons();
            
            // Load products immediately for better performance
            loadProducts().catch(error => {
                console.error('Error loading products:', error);
            });
            
                    // ضمان ظهور الهيدر
        function ensureHeaderVisibility() {
            const header = document.querySelector('header');
            if (header) {
                header.style.display = 'block';
                header.style.visibility = 'visible';
                header.style.opacity = '1';
                header.style.position = 'sticky';
                header.style.top = '0';
                header.style.zIndex = '50';
                header.style.backgroundColor = 'white';
                console.log('✅ تم ضمان ظهور الهيدر');
            }
        }
        
        // Mobile menu functionality
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        
        if (mobileMenuBtn && mobileMenu) {
            mobileMenuBtn.addEventListener('click', function() {
                mobileMenu.classList.toggle('hidden');
            });
        }
        
        // التأكد من ظهور الهيدر عند تحميل الصفحة
        document.addEventListener('DOMContentLoaded', ensureHeaderVisibility);
        window.addEventListener('load', ensureHeaderVisibility);
        // إعادة التأكد بعد فترة قصيرة
        setTimeout(ensureHeaderVisibility, 100);
        setTimeout(ensureHeaderVisibility, 500);
        setTimeout(ensureHeaderVisibility, 1000);
        
        // معالجة التغييرات في hash
        window.addEventListener('hashchange', function() {
            if (window.location.hash === '#product-request-section') {
                // عند تغيير hash، نتمرير إلى القسم
                setTimeout(() => {
                    const productRequestSection = document.getElementById('product-request-section');
                    if (productRequestSection) {
                        const header = document.querySelector('header.sticky');
                        const headerHeight = header ? header.offsetHeight : 0;
                        const sectionTop = productRequestSection.offsetTop;
                        const targetScrollPosition = sectionTop - headerHeight - 20;
                        
                        window.scrollTo({
                            top: targetScrollPosition,
                            behavior: 'smooth'
                        });
                    }
                }, 100);
            }
        });
            

            

            

            

            

            
            // Add search event listeners

            

            

            


            
            // Product card click handlers - Removed as cards now have onclick handlers
            

            

            
            // Make functions available globally
            window.handleSignOut = handleSignOut;
            window.confirmSignOut = confirmSignOut;
            window.closeSignOutModal = closeSignOutModal;
            window.proceedSignOut = proceedSignOut;
            window.showSignOutSuccess = showSignOutSuccess;
            window.redirectToHome = redirectToHome;
            
            // Close custom modals when clicking outside
            document.addEventListener('click', function(e) {
                const signoutConfirmModal = document.getElementById('signout-confirm-modal');
                const signoutSuccessModal = document.getElementById('signout-success-modal');
                
                if (signoutConfirmModal && e.target === signoutConfirmModal) {
                    closeSignOutModal();
                }
                
                if (signoutSuccessModal && e.target === signoutSuccessModal) {
                    redirectToHome();
                }
            });
            
            // Close modals with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeSignOutModal();
                }
            });
            
            // Listen for auth state changes
            if (window.AuthService) {
                window.AuthService.onAuthStateChange(async (event, session) => {
                    if (event === 'SIGNED_IN') {
                        await UIHelper.updateNavigation();
                        await updateMobileAuthButtons();
                        await loadProducts(); // Reload products to show user's products
                        UIHelper.showSuccess('تم تسجيل الدخول بنجاح!');
                    } else if (event === 'SIGNED_OUT') {
                        await UIHelper.updateNavigation();
                        await updateMobileAuthButtons();
                        await loadProducts(); // Reload products to hide user's products
                        UIHelper.showSuccess('تم تسجيل الخروج بنجاح!');
                    }
                });
            }
            
            // Update favorites count badge on page load
            updateFavoritesCountBadge();
            
            // Force update after a short delay to ensure DOM is ready
            setTimeout(() => {
                updateFavoritesCountBadge();
                console.log('🔄 Force update after delay');
            }, 500);
            
            // تهيئة المفضلة بعد تحميل الصفحة
            setTimeout(() => {
                updateAllFavoriteIcons();
                setupFavoriteButtons();
                setupProductSlideshows();
                console.log('🔄 Initializing favorite icons, buttons and slideshows after page load');
            }, 1000);
            
            // Listen for changes in localStorage (favorites)
            window.addEventListener('storage', function(e) {
                if (e.key === 'favorites') {
                    updateFavoritesCountBadge();
                }
            });
            
            // مستمع للحدث المخصص لضمان التزامن
            window.addEventListener('favoritesChanged', function(e) {
                console.log('🔄 Favorites changed via custom event, updating favorites...');
                updateFavoritesCountBadge();
            });

                    // إعداد أزرار "أضف منتجك" في الهيدر
        setupHeaderButtons();
        
        // إعداد نموذج طلب المنتج بعد تحميل الصفحة بالكامل
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', setupProductRequestForm);
        } else {
            // Page already loaded, wait a bit more for scripts
            setTimeout(setupProductRequestForm, 1000);
        }
        });
        
        // إعداد أزرار الهيدر
        function setupHeaderButtons() {
            console.log('🔄 Setting up header buttons...');
            
            // زر "أضف منتجك" في الهيدر
            const addProductRequestBtn = document.getElementById('add-product-request-btn');
            if (addProductRequestBtn) {
                console.log('✅ Found add product request button');
                addProductRequestBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log('🖱️ Button clicked, scrolling to section...');
                    // تمرير فوري بدون تأخير
                    scrollToProductRequestSection();
                });
            } else {
                console.error('❌ Add product request button not found');
            }
            
            // أزرار "أضف منتجك" في القائمة المتحركة
            const mobileAddProductRequestBtns = document.querySelectorAll('a[href="#product-request-section"]');
            console.log(`📱 Found ${mobileAddProductRequestBtns.length} mobile buttons`);
            mobileAddProductRequestBtns.forEach((btn, index) => {
                btn.addEventListener('click', function(e) {
                    e.preventDefault();
                    console.log(`🖱️ Mobile button ${index + 1} clicked, scrolling to section...`);
                    // تمرير فوري بدون تأخير
                    scrollToProductRequestSection();
                });
            });
        }
        


        // إعداد نموذج طلب المنتج
        let citiesService;
        let selectedCities = new Set();
        let currentGovernorates = [];
        let uploadedImages = [];
        let draggedElement = null;
        let draggedIndex = null;

        function setupProductRequestForm() {
            console.log('🚀 Setting up Product Request Form...');
            
            // Wait for all required services to be available
            waitForServices().then(() => {
                // Initialize advanced governorate filter
                setupAdvancedGovernorateFilter();
                
                // Initialize cities filter
                initializeCitiesFilter();
                
                // Setup form event listeners
                setupFormEventListeners();
                
                // Setup image upload
                setupImageUpload();
                
                // Setup global error banner
                setupGlobalErrorBanner();
                
                console.log('✅ Product Request Form setup completed');
            }).catch(error => {
                console.error('❌ Failed to setup Product Request Form:', error);
            });
        }
        
        // Wait for all required services to be available
        function waitForServices() {
            return new Promise((resolve, reject) => {
                const maxAttempts = 50; // 5 seconds max
                let attempts = 0;
                
                const checkServices = () => {
                    attempts++;
                    
                    const services = {
                        'CitiesService': typeof CitiesService !== 'undefined',
                        'ProductRequestsService': typeof ProductRequestsService !== 'undefined',
                        'Supabase': typeof supabaseClient !== 'undefined'
                    };
                    
                    console.log(`🔍 Checking services (attempt ${attempts}):`, services);
                    
                    const allAvailable = Object.values(services).every(available => available);
                    
                    if (allAvailable) {
                        console.log('✅ All required services are available');
                        resolve();
                    } else if (attempts >= maxAttempts) {
                        console.error('❌ Timeout waiting for services');
                        reject(new Error('Services timeout'));
                    } else {
                        setTimeout(checkServices, 100);
                    }
                };
                
                checkServices();
            });
        }
        
        // Setup form event listeners
        function setupFormEventListeners() {
            const form = document.getElementById('product-request-form');
            const categorySelect = document.getElementById('request-category');
            
            // Form submission
            form.addEventListener('submit', submitProductRequest);
            
            // Category change
            categorySelect.addEventListener('change', handleCategoryChange);
            
            // Setup validation event listeners
            setupValidationEventListeners();
        }
        
        // Setup validation event listeners
        function setupValidationEventListeners() {
            // Clear errors when user starts typing/selecting
            const descriptionField = document.getElementById('request-description');
            const categoryField = document.getElementById('request-category');
            const whatsappField = document.getElementById('request-whatsapp');
            const facebookField = document.getElementById('request-facebook');
            const instagramField = document.getElementById('request-instagram');
            
            descriptionField.addEventListener('input', () => clearFieldError('request-description'));
            categoryField.addEventListener('change', () => clearFieldError('request-category'));
            whatsappField.addEventListener('input', () => {
                clearFieldError('request-whatsapp');
                validateSocialMediaFields();
            });
            facebookField.addEventListener('input', () => {
                clearFieldError('request-facebook');
                validateSocialMediaFields();
            });
            instagramField.addEventListener('input', () => {
                clearFieldError('request-instagram');
                validateSocialMediaFields();
            });
            
            // Clear governorate error when selection changes
            const governorateCheckboxes = document.querySelectorAll('.governorate-checkbox');
            governorateCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', () => {
                    // Clear error after a short delay to allow the selection to update
                    setTimeout(() => {
                        if (currentGovernorates.length > 0) {
                            clearFieldError('request-governorate');
                        }
                    }, 100);
                });
            });
            
            // Clear subcategory error when selection changes
            document.addEventListener('change', (e) => {
                if (e.target.closest('#request-subcategory-options')) {
                    // Clear error after a short delay to allow the selection to update
                    setTimeout(() => {
                        const selectedSubcategories = document.querySelectorAll('#request-subcategory-options input[type="checkbox"]:checked');
                        if (selectedSubcategories.length > 0) {
                            clearFieldError('request-subcategory');
                        }
                    }, 100);
                }
            });
        }
        
        // Validate social media fields in real-time
        function validateSocialMediaFields() {
            const whatsapp = document.getElementById('request-whatsapp').value.trim();
            const facebook = document.getElementById('request-facebook').value.trim();
            const instagram = document.getElementById('request-instagram').value.trim();
            
            // Clear social media error if at least one is filled
            if (whatsapp || facebook || instagram) {
                clearFieldError('social-media');
            }
            
            // Validate individual fields if they are filled
            if (whatsapp && !isValidWhatsAppNumber(whatsapp)) {
                showFieldError('request-whatsapp', 'يرجى إدخال رقم واتساب صحيح');
            } else if (whatsapp) {
                clearFieldError('request-whatsapp');
            }
            
                            if (facebook && !isValidFacebookUrl(facebook)) {
                    showFieldError('request-facebook', 'يرجى إدخال رابط فيسبوك صحيح (يقبل جميع أنواع الروابط: صفحات، مجموعات، أحداث، منشورات، صور، فيديوهات، hashtags، روابط قصيرة)');
                } else if (facebook) {
                    clearFieldError('request-facebook');
                }
            
            if (instagram && !isValidInstagramUsername(instagram)) {
                showFieldError('request-instagram', 'يرجى إدخال اسم مستخدم إنستجرام صحيح');
            } else if (instagram) {
                clearFieldError('request-instagram');
            }
        }
        
        // Global Error Banner Functions
        function showGlobalErrorBanner() {
            const banner = document.getElementById('global-error-banner');
            if (banner) {
                banner.classList.remove('hidden');
                // Use setTimeout to ensure the element is visible before animating
                setTimeout(() => {
                    banner.classList.add('show');
                }, 10);
                
                // Scroll to the banner smoothly
                banner.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'center' 
                });
            }
        }
        
        function hideGlobalErrorBanner() {
            const banner = document.getElementById('global-error-banner');
            if (banner) {
                banner.classList.remove('show');
                setTimeout(() => {
                    banner.classList.add('hidden');
                }, 300);
            }
        }
        
        // Handle category change
        function handleCategoryChange() {
            const selectedCategory = this.value;
            const subcategoryGroup = document.getElementById('request-subcategory-group');
            const subcategoryOptions = document.getElementById('request-subcategory-options');
            
            // Clear subcategory options
            subcategoryOptions.innerHTML = '';
            
            // Clear any existing subcategory errors
            clearFieldError('request-subcategory');
            
            if (selectedCategory && subcategories[selectedCategory]) {
                // Add subcategory options as checkboxes
                subcategories[selectedCategory].forEach(sub => {
                    const checkboxDiv = document.createElement('div');
                    checkboxDiv.className = 'flex items-center';
                    checkboxDiv.innerHTML = `
                        <input type="checkbox" 
                               id="sub-${sub.value}" 
                               value="${sub.value}" 
                               class="w-4 h-4 text-yellow-600 bg-gray-100 border-gray-300 rounded focus:ring-yellow-500 focus:ring-2">
                        <label for="sub-${sub.value}" class="mr-2 text-sm text-gray-700 cursor-pointer">
                            ${sub.label}
                        </label>
                    `;
                    subcategoryOptions.appendChild(checkboxDiv);
                });
                
                // Show subcategory group
                subcategoryGroup.style.display = 'block';
            } else {
                // Hide subcategory group
                subcategoryGroup.style.display = 'none';
            }
        }
        
        // Subcategory definitions - Updated to match category page filters
        const subcategories = {
            'koshat': [
                { value: 'koshat-wedding', label: 'كوشات زفاف' },
                { value: 'koshat-engagement', label: 'كوشات خطوبة' }
            ],
            'mirr': [
                { value: 'mirror-wedding', label: 'مرآة زفاف' },
                { value: 'mirror-engagement', label: 'مرآة خطوبة' },
                { value: 'mirror-decorative', label: 'مرآة ديكور' }
            ],
            'cake': [
                { value: 'cake-wedding', label: 'تورتة زفاف' },
                { value: 'cake-engagement', label: 'تورتة خطوبة' },
                { value: 'cake-birthday', label: 'تورتة عيد ميلاد' },
                { value: 'cake-chocolate', label: 'تورتة شوكولاتة' },
                { value: 'cake-fruit', label: 'تورتة فواكه' },
                { value: 'cake-chocolate-tray', label: 'صينية شكولاتات' }
            ],
            'other': [
                { value: 'other-birthday', label: 'ديكور عيد ميلاد' },
                { value: 'other-hospital', label: 'استقبال المولود بالمستشفى' },
                { value: 'other-bride', label: 'ديكور استقبال عروسة' },
                { value: 'other-party', label: 'ديكور حفلات بسيطة' }
            ],
            'invitations': [
                { value: 'invitation-wedding', label: 'دعوة زفاف' },
                { value: 'invitation-engagement', label: 'دعوة خطوبة' },
                { value: 'invitation-chocolate', label: 'توزيعات بالشوكولاتة' },
                { value: 'invitation-perfumed', label: 'توزيعات بالبرفان' },
                { value: 'invitation-gift', label: 'توزيعات مع هدية صغيرة' },
                { value: 'invitation-digital', label: 'دعوة رقمية' },
                { value: 'invitation-innovative', label: 'دعوة مبتكرة' }
            ]
        };
        

        
        // Setup Global Error Banner Event Listeners
        function setupGlobalErrorBanner() {
            // Close button event listener
            const closeBtn = document.getElementById('close-error-banner');
            if (closeBtn) {
                closeBtn.addEventListener('click', hideGlobalErrorBanner);
            }
        }
        
        // Setup Advanced Governorate Filter
        function setupAdvancedGovernorateFilter() {
            console.log('🔍 setupAdvancedGovernorateFilter called');
            console.log('🔍 Stack trace:', new Error().stack);
            
            const dropdownBtn = document.getElementById('request-governorate-dropdown-btn');
            const dropdownContent = document.getElementById('request-governorate-dropdown-content');
            const checkboxes = document.querySelectorAll('.governorate-checkbox');
            const selectAllBtn = document.getElementById('request-select-all-governorates');
            const clearAllBtn = document.getElementById('request-clear-all-governorates');
            const selectedContainer = document.getElementById('request-selected-governorates');

            console.log('🔍 Setting up Advanced Governorate Filter...');
            console.log('📱 Elements found:', {
                dropdownBtn: !!dropdownBtn,
                dropdownBtnId: dropdownBtn?.id,
                dropdownContent: !!dropdownContent,
                dropdownContentId: dropdownContent?.id,
                checkboxes: checkboxes.length,
                selectAllBtn: !!selectAllBtn,
                clearAllBtn: !!clearAllBtn,
                selectedContainer: !!selectedContainer
            });

            // Toggle dropdown
            dropdownBtn.addEventListener('click', function() {
                dropdownContent.classList.toggle('hidden');
                dropdownBtn.classList.toggle('active');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function(event) {
                if (!dropdownBtn.contains(event.target) && !dropdownContent.contains(event.target)) {
                    dropdownContent.classList.add('hidden');
                    dropdownBtn.classList.remove('active');
                }
            });
            
            // Hover event removed - no validation needed

            // Handle checkbox changes
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    updateSelectedGovernorates();
                    updatePlaceholder();
                    updateCitiesFilter(currentGovernorates);
                });
            });

            // Select all
            selectAllBtn.addEventListener('click', function() {
                checkboxes.forEach(checkbox => {
                    checkbox.checked = true;
                });
                updateSelectedGovernorates();
                updatePlaceholder();
                updateCitiesFilter(currentGovernorates);
            });

            // Clear all
            clearAllBtn.addEventListener('click', function() {
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
                updateSelectedGovernorates();
                updatePlaceholder();
                updateCitiesFilter(currentGovernorates);
            });

            function updateSelectedGovernorates() {
                const selected = [];
                checkboxes.forEach(checkbox => {
                    if (checkbox.checked) {
                        selected.push(checkbox.value);
                    }
                });
                currentGovernorates = selected;
                displaySelectedGovernorates();
                
                // Clear governorate error if governorates are selected
                if (selected.length > 0) {
                    clearFieldError('request-governorate');
                }
            }

            function updatePlaceholder() {
                const placeholder = document.getElementById('request-governorate-placeholder');
                if (currentGovernorates.length === 0) {
                    placeholder.textContent = 'اختر المحافظات';
                } else if (currentGovernorates.length === 1) {
                    placeholder.textContent = currentGovernorates[0];
                } else {
                    placeholder.textContent = `${currentGovernorates.length} محافظة مختارة`;
                }
            }

            function displaySelectedGovernorates() {
                if (currentGovernorates.length === 0) {
                    selectedContainer.innerHTML = '';
                    return;
                }

                selectedContainer.innerHTML = currentGovernorates.map(gov => `
                    <div class="selected-governorate-tag">
                        ${gov}
                        <button class="remove-governorate" onclick="removeRequestGovernorate('${gov}')">×</button>
                    </div>
                `).join('');
            }
        }

        // Remove specific governorate from request form
        function removeRequestGovernorate(governorate) {
            const checkbox = document.querySelector(`.governorate-checkbox[value="${governorate}"]`);
            if (checkbox) {
                checkbox.checked = false;
                currentGovernorates = currentGovernorates.filter(g => g !== governorate);
                
                const placeholder = document.getElementById('request-governorate-placeholder');
                placeholder.textContent = currentGovernorates.length === 0 ? 'اختر المحافظات' : 
                    currentGovernorates.length === 1 ? currentGovernorates[0] :
                    `${currentGovernorates.length} محافظة مختارة`;
                
                displaySelectedGovernorates();
                updateCitiesFilter(currentGovernorates);
            }
        }

        // Initialize Cities Filter
        function initializeCitiesFilter() {
            try {
                // Wait for CitiesService to be available
                if (typeof CitiesService === 'undefined') {
                    console.log('⏳ Waiting for CitiesService to load...');
                    setTimeout(() => initializeCitiesFilter(), 100);
                    return;
                }
                
                // Initialize CitiesService
                citiesService = new CitiesService();
                console.log('✅ CitiesService initialized successfully');
                
                // Setup cities filter functionality
                setupCitiesFilter();
            } catch (error) {
                console.error('❌ Error initializing CitiesService:', error);
                // Retry after a delay
                setTimeout(() => initializeCitiesFilter(), 500);
            }
        }
        
        // Setup Cities Filter
        function setupCitiesFilter() {
            const citiesTrigger = document.getElementById('request-cities-trigger');
            const citiesDropdown = document.getElementById('request-cities-dropdown');
            const citiesSearch = document.getElementById('request-cities-search');
            const selectAllCitiesBtn = document.getElementById('request-select-all-cities-btn');
            const clearAllCitiesBtn = document.getElementById('request-clear-all-cities-btn');
            const applyCitiesFilterBtn = document.getElementById('request-apply-cities-filter');

            // Toggle dropdown
            citiesTrigger.addEventListener('click', function() {
                citiesDropdown.classList.toggle('show');
                citiesTrigger.classList.toggle('active');
            });

            // Close dropdown when clicking outside
            document.addEventListener('click', function(event) {
                if (!citiesTrigger.contains(event.target) && !citiesDropdown.contains(event.target)) {
                    citiesDropdown.classList.remove('show');
                    citiesTrigger.classList.remove('active');
                }
            });

            // Search functionality
            citiesSearch.addEventListener('input', function() {
                filterCities(this.value);
            });

            // Select all cities
            selectAllCitiesBtn.addEventListener('click', function() {
                const checkboxes = document.querySelectorAll('.city-input');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = true;
                    selectedCities.add(checkbox.value);
                });
                updateCitiesDisplay();
            });

            // Clear all cities
            clearAllCitiesBtn.addEventListener('click', function() {
                const checkboxes = document.querySelectorAll('.city-input');
                checkboxes.forEach(checkbox => {
                    checkbox.checked = false;
                });
                selectedCities.clear();
                updateCitiesDisplay();
            });

            // Apply filter
            applyCitiesFilterBtn.addEventListener('click', function() {
                citiesDropdown.classList.remove('show');
                citiesTrigger.classList.remove('active');
            });
        }
        

        
        // Update Cities Filter based on selected governorates
        function updateCitiesFilter(selectedGovernorates) {
            console.log('🔄 Updating Cities Filter for governorates:', selectedGovernorates);
            
            const citiesGroup = document.getElementById('request-cities-group');
            const citiesList = document.getElementById('request-cities-list');
            const citiesTrigger = document.getElementById('request-cities-trigger');
            const citiesSearch = document.getElementById('request-cities-search');

            if (selectedGovernorates.length === 0) {
                // Hide cities filter if no governorates selected
                citiesGroup.style.display = 'none';
                selectedCities.clear();
                updateCitiesDisplay();
                return;
            }

            // Show cities filter
            citiesGroup.style.display = 'block';

            // Check if citiesService is available
            if (!citiesService) {
                console.error('❌ CitiesService not available');
                console.log('🔍 Current citiesService:', citiesService);
                console.log('🔍 Window CitiesService:', typeof window.CitiesService);
                return;
            }

            // Get all cities for selected governorates
            let allCities = [];
            selectedGovernorates.forEach(governorate => {
                try {
                    const cities = citiesService.getCitiesForGovernorate(governorate);
                    if (cities && cities.length > 0) {
                        allCities = allCities.concat(cities);
                    }
                } catch (error) {
                    console.error(`Error getting cities for ${governorate}:`, error);
                }
            });

            // Remove duplicates
            allCities = [...new Set(allCities)];

            console.log('Available cities for selected governorates:', allCities);

            // Populate cities list
            citiesList.innerHTML = allCities.map(city => `
                <div class="city-item">
                    <label class="city-checkbox">
                        <input type="checkbox" value="${city}" class="city-input">
                        <span class="city-name">${city}</span>
                    </label>
                </div>
            `).join('');

            // Add event listeners to new checkboxes
            const cityCheckboxes = document.querySelectorAll('.city-input');
            cityCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    if (this.checked) {
                        selectedCities.add(this.value);
                    } else {
                        selectedCities.delete(this.value);
                    }
                    updateCitiesDisplay();
                });
            });

            // Clear search
            citiesSearch.value = '';
            
            // Update display
            updateCitiesDisplay();
        }
        
        // Filter cities based on search term
        function filterCities(searchTerm) {
            const cityItems = document.querySelectorAll('.city-item');
            
            cityItems.forEach(item => {
                const cityName = item.querySelector('.city-name').textContent.toLowerCase();
                const matches = cityName.includes(searchTerm.toLowerCase());
                item.style.display = matches ? 'block' : 'none';
            });
        }
        
        // Update cities display
        function updateCitiesDisplay() {
            const selectedCount = document.getElementById('request-cities-selected-count');
            const selectedCitiesContainer = document.getElementById('request-selected-cities');
            const triggerText = document.querySelector('#request-cities-trigger .trigger-text');

            // Update count
            if (selectedCities.size === 0) {
                selectedCount.style.display = 'none';
                triggerText.textContent = 'اختر المناطق/المدن (اختياري)';
            } else {
                selectedCount.style.display = 'inline-block';
                selectedCount.textContent = selectedCities.size;
                triggerText.textContent = `${selectedCities.size} منطقة مختارة`;
            }

            // Update selected cities tags
            if (selectedCities.size === 0) {
                selectedCitiesContainer.innerHTML = '';
            } else {
                selectedCitiesContainer.innerHTML = Array.from(selectedCities).map(city => `
                    <div class="selected-city-tag">
                        ${city}
                        <button class="remove-city" onclick="removeCity('${city}')">×</button>
                    </div>
                `).join('');
            }
        }
        
        // Remove specific city
        function removeCity(city) {
            selectedCities.delete(city);
            
            // Uncheck the corresponding checkbox
            const checkbox = document.querySelector(`.city-input[value="${city}"]`);
            if (checkbox) {
                checkbox.checked = false;
            }
            
            updateCitiesDisplay();
        }
        
        // Get selected cities for form submission
        function getSelectedCities() {
            return Array.from(selectedCities);
        }
        
        // Setup image upload
        function setupImageUpload() {
            const uploadArea = document.getElementById('request-upload-area');
            const imageUpload = document.getElementById('request-image-upload');
            const imagePreview = document.getElementById('request-image-preview');
            
            // Initialize image counter
            updateImageCounter();
            
            // Click to upload
            uploadArea.addEventListener('click', () => {
                // Check if already at limit
                if (uploadedImages.length >= 3) {
                    showNotification('يمكنك تحميل 3 صور كحد أقصى فقط', 'error');
                    return;
                }
                imageUpload.click();
            });
            
            // Drag and drop functionality
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });

            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });

            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                // Check if adding files would exceed limit
                if (uploadedImages.length >= 3) {
                    showNotification('يمكنك تحميل 3 صور كحد أقصى فقط', 'error');
                    return;
                }
                
                const files = e.dataTransfer.files;
                handleImageFiles(files);
            });
            
            // File input change
            imageUpload.addEventListener('change', (e) => {
                handleImageFiles(e.target.files);
                // Clear input to allow selecting same file again
                e.target.value = '';
            });
        }
        
        // Handle image files
        function handleImageFiles(files) {
            // Check if adding these files would exceed the limit
            const currentCount = uploadedImages.length;
            const newFiles = Array.from(files).filter(file => file.type.startsWith('image/'));
            
            if (currentCount + newFiles.length > 3) {
                showNotification('يمكنك تحميل 3 صور كحد أقصى فقط', 'error');
                return;
            }
            
            // Process each image file
            newFiles.forEach(file => {
                processAndAddImage(file);
            });
        }
        
        // Process image: compress and add preview
        async function processAndAddImage(file) {
            try {
                // Compress image before adding
                const compressedFile = await compressImage(file);
                addImagePreview(compressedFile);
            } catch (error) {
                console.error('Error processing image:', error);
                // Fallback to original file if compression fails
                addImagePreview(file);
            }
        }
        
        // Compress image to reduce quality and size
        async function compressImage(file) {
            return new Promise((resolve) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                img.onload = () => {
                    // Calculate new dimensions (max width: 800px, maintain aspect ratio)
                    const maxWidth = 800;
                    let { width, height } = img;
                    
                    if (width > maxWidth) {
                        height = (height * maxWidth) / width;
                        width = maxWidth;
                    }
                    
                    // Set canvas dimensions
                    canvas.width = width;
                    canvas.height = height;
                    
                    // Draw and compress image
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // Convert to blob with reduced quality (0.7 = 70% quality)
                    canvas.toBlob((blob) => {
                        const compressedFile = new File([blob], file.name, {
                            type: 'image/jpeg',
                            lastModified: Date.now()
                        });
                        resolve(compressedFile);
                    }, 'image/jpeg', 0.7);
                };
                
                img.src = URL.createObjectURL(file);
            });
        }
        
        // Add image preview with drag and drop functionality
        function addImagePreview(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const imageItem = document.createElement('div');
                imageItem.className = 'image-item sortable-image';
                imageItem.draggable = true;
                imageItem.setAttribute('data-index', uploadedImages.length);
                
                // Calculate file size in KB
                const fileSizeKB = (file.size / 1024).toFixed(1);
                
                imageItem.innerHTML = `
                    <div class="image-drag-handle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16" />
                        </svg>
                    </div>
                    <img src="${e.target.result}" alt="${file.name}" class="w-full h-32 object-cover rounded-lg">
                    <div class="image-number">${uploadedImages.length + 1}</div>
                    <div class="image-info text-xs text-gray-500 mt-1 text-center">
                        ${fileSizeKB} KB
                    </div>
                    <button type="button" class="image-remove" onclick="removeImage(this)">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                `;
                
                // Add drag and drop event listeners
                imageItem.addEventListener('dragstart', handleDragStart);
                imageItem.addEventListener('dragover', handleDragOver);
                imageItem.addEventListener('drop', handleDrop);
                imageItem.addEventListener('dragenter', handleDragEnter);
                imageItem.addEventListener('dragleave', handleDragLeave);
                
                const imagePreview = document.getElementById('request-image-preview');
                if (imagePreview) {
                    imagePreview.appendChild(imageItem);
                }
                uploadedImages.push({ src: e.target.result, name: file.name, file: file });
                
                // Hide instructions after first image
                const instructions = document.querySelector('.image-sort-instructions');
                if (instructions) {
                    instructions.style.display = 'none';
                }
                
                // Update image counter
                updateImageCounter();
            };
            reader.readAsDataURL(file);
        }
        
        // Drag and drop functions for image sorting
        function handleDragStart(e) {
            draggedElement = this;
            draggedIndex = parseInt(this.getAttribute('data-index'));
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDragEnter(e) {
            e.preventDefault();
            this.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            this.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            this.classList.remove('drag-over');
            
            if (draggedElement !== this) {
                const dropIndex = parseInt(this.getAttribute('data-index'));
                
                // Reorder the uploadedImages array
                const draggedImage = uploadedImages[draggedIndex];
                uploadedImages.splice(draggedIndex, 1);
                uploadedImages.splice(dropIndex, 0, draggedImage);
                
                // Reorder the DOM elements
                const imagePreview = document.getElementById('request-image-preview');
                if (imagePreview) {
                    const allImages = Array.from(imagePreview.querySelectorAll('.sortable-image'));
                    const draggedDOM = allImages[draggedIndex];
                    
                    if (draggedIndex < dropIndex) {
                        imagePreview.insertBefore(draggedDOM, allImages[dropIndex].nextSibling);
                    } else {
                        imagePreview.insertBefore(draggedDOM, allImages[dropIndex]);
                    }
                }
                
                // Update order
                updateImageOrder();
                
                // Show success message
                showSortSuccess();
            }
            
            draggedElement.classList.remove('dragging');
            draggedElement = null;
            draggedIndex = null;
        }

        function showSortSuccess() {
            const message = document.createElement('div');
            message.className = 'fixed top-4 right-4 bg-green-500 text-white px-4 py-2 rounded-lg shadow-lg z-50 flex items-center';
            message.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                تم تغيير ترتيب الصور بنجاح
            `;
            
            document.body.appendChild(message);
            
            // Remove message after 3 seconds
            setTimeout(() => {
                message.remove();
            }, 3000);
        }

        function updateImageOrder() {
            const imagePreview = document.getElementById('request-image-preview');
            if (!imagePreview) return;
            
            const imageItems = imagePreview.querySelectorAll('.sortable-image');
            imageItems.forEach((item, index) => {
                item.setAttribute('data-index', index);
                const numberElement = item.querySelector('.image-number');
                if (numberElement) {
                    numberElement.textContent = index + 1;
                }
            });
            
            // Update image counter after reordering
            updateImageCounter();
        }
        
        // Remove image
        function removeImage(button) {
            const imagePreview = document.getElementById('request-image-preview');
            if (!imagePreview) return;
            
            const imageItem = button.parentElement;
            const index = Array.from(imagePreview.children).indexOf(imageItem);
            uploadedImages.splice(index, 1);
            imageItem.remove();
            
            // Update image numbers and data-index attributes
            updateImageOrder();
            
            // Update image counter
            updateImageCounter();
            
            // Show instructions if no images left
            if (uploadedImages.length === 0) {
                const instructions = document.querySelector('.image-sort-instructions');
                if (instructions) {
                    instructions.style.display = 'block';
                }
            }
        }
        
        // Update image counter display
        function updateImageCounter() {
            const counter = document.getElementById('image-counter');
            if (counter) {
                counter.textContent = `${uploadedImages.length}/3`;
                
                // Change color based on count
                if (uploadedImages.length >= 3) {
                    counter.classList.add('text-red-500');
                    counter.classList.remove('text-green-500', 'text-yellow-500');
                } else if (uploadedImages.length >= 2) {
                    counter.classList.add('text-yellow-500');
                    counter.classList.remove('text-green-500', 'text-red-500');
                } else {
                    counter.classList.add('text-green-500');
                    counter.classList.remove('text-yellow-500', 'text-red-500');
                }
            }
        }



        // إرسال طلب المنتج
        async function submitProductRequest(e) {
            e.preventDefault();
            
            // Clear all previous errors
            clearAllFieldErrors();
            
            // Validate form before submission
            if (!validateForm()) {
                return; // Stop submission if validation fails
            }
            
            // Check image count
            if (uploadedImages.length === 0) {
                showNotification('يجب رفع صورة واحدة على الأقل للمنتج', 'error');
                return;
            }
            
            // Get form data after validation
            const description = document.getElementById('request-description').value.trim();
            const price = document.getElementById('request-price').value;
            const category = document.getElementById('request-category').value;
            
            // Get selected subcategories
            const selectedSubcategories = [];
            const subcategoryCheckboxes = document.querySelectorAll('#request-subcategory-options input[type="checkbox"]:checked');
            subcategoryCheckboxes.forEach(checkbox => {
                selectedSubcategories.push(checkbox.value);
            });
            
            const selectedGovernorates = currentGovernorates;
            const whatsapp = document.getElementById('request-whatsapp').value;
            const facebook = document.getElementById('request-facebook').value;
            const instagram = document.getElementById('request-instagram').value;
            
            const submitBtn = this.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            showLoading(submitBtn);
            
            try {
                // Get selected cities
                const selectedCitiesArray = getSelectedCities();
                
                // Prepare request data
                const requestData = {
                    description: description,
                    price: price || null,
                    category: category,
                    subcategory: selectedSubcategories.length > 0 ? selectedSubcategories : null,
                    governorate: selectedGovernorates.join(', '),
                    cities: selectedCitiesArray.length > 0 ? selectedCitiesArray.join(', ') : null,
                    whatsapp: whatsapp,
                    facebook: facebook || null,
                    instagram: instagram || null
                };
                
                // Convert uploaded images to File objects
                const imageFiles = [];
                for (let i = 0; i < uploadedImages.length; i++) {
                    if (uploadedImages[i].file) {
                        imageFiles.push(uploadedImages[i].file);
                    } else {
                        // Convert data URL to File object
                        const response = await fetch(uploadedImages[i].src);
                        const blob = await response.blob();
                        const file = new File([blob], uploadedImages[i].name, { type: blob.type });
                        imageFiles.push(file);
                    }
                }
                
                // Submit request
                const productRequestsService = new ProductRequestsService();
                const result = await productRequestsService.submitProductRequest(requestData, imageFiles);
                
                if (result.success) {
                    // Show success message
                    showSuccessMessage('تم إرسال طلبك بنجاح! سنقوم بمراجعته وإضافته للموقع قريباً.');
                    
                    // Clear form
                    e.target.reset();
                    uploadedImages.length = 0;
                    const imagePreview = document.getElementById('request-image-preview');
                    imagePreview.innerHTML = '';
                    
                    // Clear cities filter
                    selectedCities.clear();
                    updateCitiesDisplay();
                    
                    // Hide subcategory group
                    document.getElementById('request-subcategory-group').style.display = 'none';
                    document.getElementById('request-cities-group').style.display = 'none';
                    
                    // Show instructions again
                    const instructions = document.createElement('div');
                    instructions.className = 'image-sort-instructions mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg col-span-2 md:col-span-4';
                    instructions.innerHTML = `
                        <div class="flex items-center text-blue-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                            </svg>
                            <span class="text-sm font-medium">اسحب الصور لترتيبها - الصورة الأولى ستكون الصورة الرئيسية</span>
                        </div>
                    `;
                    imagePreview.appendChild(instructions);
                    
                    // Reset governorate selection
                    currentGovernorates = [];
                    // Reset governorate dropdown
                    const governorateCheckboxes = document.querySelectorAll('.governorate-checkbox');
                    governorateCheckboxes.forEach(checkbox => {
                        checkbox.checked = false;
                    });
                    
                    // Update placeholder
                    const placeholder = document.getElementById('request-governorate-placeholder');
                    if (placeholder) {
                        placeholder.textContent = 'اختر المحافظات';
                    }
                    
                    // Clear selected governorates display
                    const selectedContainer = document.getElementById('request-selected-governorates');
                    if (selectedContainer) {
                        selectedContainer.innerHTML = '';
                    }
                    
                    // Refresh the page after successful submission
                    setTimeout(() => {
                        location.reload();
                    }, 2000); // انتظار ثانيتين لعرض رسالة النجاح
                } else {
                    submitBtn.innerHTML = originalText;
                    showErrorMessage('حدث خطأ في إرسال الطلب. يرجى المحاولة مرة أخرى.');
                }
            } catch (error) {
                submitBtn.innerHTML = originalText;
                showErrorMessage('حدث خطأ في إرسال الطلب. يرجى المحاولة مرة أخرى.');
                console.error('Error:', error);
            }
        }
        
                // Form validation function
        function validateForm() {
            let isValid = true;
            
            // Validate description
            const description = document.getElementById('request-description').value.trim();
            if (!description) {
                showFieldError('request-description', 'هذا الحقل مطلوب');
                isValid = false;
            }
            
            // Validate category
            const category = document.getElementById('request-category').value;
            if (!category) {
                showFieldError('request-category', 'يرجى اختيار التصنيف الرئيسي');
                isValid = false;
            }
            
            // Validate subcategory (only if category is selected)
            if (category) {
                const subcategoryCheckboxes = document.querySelectorAll('#request-subcategory-options input[type="checkbox"]:checked');
                if (subcategoryCheckboxes.length === 0) {
                    showFieldError('request-subcategory', 'يرجى اختيار التصنيف الفرعي');
                    isValid = false;
                }
            }
            
            // Validate governorate
            if (currentGovernorates.length === 0) {
                showFieldError('request-governorate', 'يرجى اختيار محافظة واحدة على الأقل');
                isValid = false;
            }
            
            // Validate social media - at least one must be filled
            const whatsapp = document.getElementById('request-whatsapp').value.trim();
            const facebook = document.getElementById('request-facebook').value.trim();
            const instagram = document.getElementById('request-instagram').value.trim();
            
            if (!whatsapp && !facebook && !instagram) {
                showFieldError('social-media', 'يجب ملء حقل واحد على الأقل من وسائل التواصل الاجتماعي');
                isValid = false;
            } else {
                // Clear social media error if at least one is filled
                clearFieldError('social-media');
            }
            
            // Validate individual social media fields if they are filled
            if (whatsapp && !isValidWhatsAppNumber(whatsapp)) {
                showFieldError('request-whatsapp', 'يرجى إدخال رقم واتساب صحيح');
                isValid = false;
            }
            
            if (facebook && !isValidFacebookUrl(facebook)) {
                showFieldError('request-facebook', 'يرجى إدخال رابط فيسبوك صحيح (يقبل جميع أنواع الروابط: صفحات، مجموعات، أحداث، منشورات، صور، فيديوهات، hashtags، روابط قصيرة)');
                isValid = false;
            }
            
            if (instagram && !isValidInstagramUsername(instagram)) {
                showFieldError('request-instagram', 'يرجى إدخال اسم مستخدم إنستجرام صحيح');
                isValid = false;
            }
            
            // Show global error banner if validation fails
            if (!isValid) {
                showGlobalErrorBanner();
            } else {
                hideGlobalErrorBanner();
            }
            
            return isValid;
        }
        
        // Validate WhatsApp number format
        function isValidWhatsAppNumber(phone) {
            // Remove all non-digit characters
            const cleanPhone = phone.replace(/\D/g, '');
            
            // Check if it's a valid Egyptian phone number
            // Egyptian numbers start with 01 and are 11 digits long
            if (cleanPhone.length === 11 && cleanPhone.startsWith('01')) {
                return true;
            }
            
            // Check if it's a valid international format
            if (cleanPhone.length === 12 && cleanPhone.startsWith('20')) {
                return true;
            }
            
            // Check if it's a valid international format with +
            if (phone.startsWith('+') && (cleanPhone.length === 12 || cleanPhone.length === 11)) {
                return true;
            }
            
            return false;
        }
        
        // Validate Facebook URL format - يقبل جميع أنواع روابط الفيس بوك
        function isValidFacebookUrl(url) {
            // تنظيف الرابط من المسافات
            url = url.trim();
            
            // إذا كان الرابط فارغاً، يعتبر صحيحاً (حقل اختياري)
            if (!url) {
                return true;
            }
            
            // نمط مبسط وشامل لجميع أنواع روابط فيسبوك
            // يقبل أي رابط يحتوي على facebook.com أو fb.me
            const facebookRegex = /^https?:\/\/(www\.)?(facebook\.com|fb\.me)\/.+/;
            
            return facebookRegex.test(url);
        }
        
        // Validate Instagram username format
        function isValidInstagramUsername(username) {
            const instagramRegex = /^[a-zA-Z0-9._]{1,30}$/;
            return instagramRegex.test(username);
        }
        
        // Show field error
        function showFieldError(fieldId, message) {
            const errorElement = document.getElementById(`${fieldId}-error`);
            let fieldElement = document.getElementById(fieldId);
            
            if (errorElement) {
                errorElement.textContent = message;
                errorElement.classList.remove('hidden');
                errorElement.classList.add('show');
                
                // Add error styling to field
                if (fieldElement) {
                    fieldElement.classList.add('field-error');
                }
                
                // Special handling for governorate and subcategory
                if (fieldId === 'request-governorate') {
                    const dropdownBtn = document.getElementById('request-governorate-dropdown-btn');
                    if (dropdownBtn) {
                        dropdownBtn.classList.add('field-error');
                        // Also add error styling to the entire governorate section
                        const governorateSection = dropdownBtn.closest('.simple-governorate-filter');
                        if (governorateSection) {
                            governorateSection.classList.add('field-error');
                        }
                    }
                } else if (fieldId === 'request-subcategory') {
                    const subcategoryGroup = document.getElementById('request-subcategory-group');
                    if (subcategoryGroup) {
                        subcategoryGroup.classList.add('field-error');
                        // Add error styling to the subcategory options container
                        const subcategoryOptions = document.getElementById('request-subcategory-options');
                        if (subcategoryOptions) {
                            subcategoryOptions.classList.add('field-error');
                        }
                    }
                }
            }
        }
        
        // Clear field error
        function clearFieldError(fieldId) {
            const errorElement = document.getElementById(`${fieldId}-error`);
            let fieldElement = document.getElementById(fieldId);
            
            if (errorElement) {
                errorElement.classList.add('hidden');
                errorElement.classList.remove('show');
                
                // Remove error styling from field
                if (fieldElement) {
                    fieldElement.classList.remove('field-error');
                }
                
                // Special handling for governorate and subcategory
                if (fieldId === 'request-governorate') {
                    const dropdownBtn = document.getElementById('request-governorate-dropdown-btn');
                    if (dropdownBtn) {
                        dropdownBtn.classList.remove('field-error');
                        // Also remove error styling from the entire governorate section
                        const governorateSection = dropdownBtn.closest('.simple-governorate-filter');
                        if (governorateSection) {
                            governorateSection.classList.remove('field-error');
                        }
                    }
                } else if (fieldId === 'request-subcategory') {
                    const subcategoryGroup = document.getElementById('request-subcategory-group');
                    if (subcategoryGroup) {
                        subcategoryGroup.classList.remove('field-error');
                        // Remove error styling from the subcategory options container
                        const subcategoryOptions = document.getElementById('request-subcategory-options');
                        if (subcategoryOptions) {
                            subcategoryOptions.classList.remove('field-error');
                        }
                    }
                }
            }
        }
        
        // Clear all field errors
        function clearAllFieldErrors() {
            const errorElements = document.querySelectorAll('.validation-error');
            const fieldElements = document.querySelectorAll('.field-error');
            
            errorElements.forEach(element => {
                element.classList.add('hidden');
                element.classList.remove('show');
            });
            
            fieldElements.forEach(element => {
                element.classList.remove('field-error');
            });
            
            // Also clear any special error styling
            const governorateSection = document.querySelector('.simple-governorate-filter.field-error');
            if (governorateSection) {
                governorateSection.classList.remove('field-error');
            }
            
            const subcategoryGroup = document.getElementById('request-subcategory-group');
            if (subcategoryGroup && subcategoryGroup.classList.contains('field-error')) {
                subcategoryGroup.classList.remove('field-error');
            }
            
            const subcategoryOptions = document.getElementById('request-subcategory-options');
            if (subcategoryOptions && subcategoryOptions.classList.contains('field-error')) {
                subcategoryOptions.classList.remove('field-error');
            }
        }
        
        // Show loading state
        function showLoading(button) {
            button.innerHTML = `
                <svg class="animate-spin h-5 w-5 inline ml-2" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                جاري الإرسال...
            `;
            button.disabled = true;
        }
        
        // Show success message
        function showSuccessMessage(message) {
            // Show success notification
            showNotification(message, 'success');
        }
        
        // Show error message
        function showErrorMessage(message, fieldId = null) {
            if (fieldId) {
                showFieldError(fieldId, message);
            } else {
                showNotification(message, 'error');
            }
        }
    </script>
</body>
</html> 