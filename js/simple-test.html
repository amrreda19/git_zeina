<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø³ÙŠØ· Ù„Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../js/supabase-config.js"></script>
    <script src="../js/advanced-image-upload-service.js"></script>
</head>
<body>
    <h1>Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø³ÙŠØ·</h1>
    <input type="file" id="fileInput" accept="image/*">
    <button onclick="uploadFile()">Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©</button>
    <div id="result"></div>

    <script>
        async function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const result = document.getElementById('result');

            if (!fileInput.files[0]) {
                result.innerHTML = 'âŒ ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹';
                return;
            }

            result.innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø±ÙØ¹...';

            try {
                const service = new AdvancedImageUploadService();
                await service.ensureInitialized();

                const uploadResult = await service.uploadImage(fileInput.files[0]);

                if (uploadResult.success) {
                    result.innerHTML = `
                        âœ… ØªÙ… Ø§Ù„Ø±ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­!<br>
                        ğŸ“ Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø£ØµÙ„ÙŠ: ${formatBytes(uploadResult.data.originalSize)}<br>
                        ğŸ—œï¸ Ø§Ù„Ø­Ø¬Ù… Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©: ${formatBytes(uploadResult.data.processedSize)}<br>
                        ğŸ“‰ Ù†Ø³Ø¨Ø© Ø§Ù„ØªÙ‚Ù„ÙŠÙ„: ${uploadResult.data.compressionRatio}%<br>
                        ğŸ”— <a href="${uploadResult.data.url}" target="_blank">Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ±Ø©</a>
                    `;
                } else {
                    result.innerHTML = `âŒ ÙØ´Ù„ ÙÙŠ Ø§Ù„Ø±ÙØ¹: ${uploadResult.error}`;
                }
            } catch (error) {
                result.innerHTML = `âŒ Ø®Ø·Ø£: ${error.message}`;
                console.error(error);
            }
        }

        function formatBytes(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
    </script>
</body>
</html>

